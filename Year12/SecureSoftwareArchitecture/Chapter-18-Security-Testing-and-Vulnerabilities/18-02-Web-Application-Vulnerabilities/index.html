
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Comprehensive educational resource for NSW HSC Software Engineering syllabus">
      
      
      
        <link rel="canonical" href="https://eatham532.github.io/Software-Engineering-HSC-Textbook/Year12/SecureSoftwareArchitecture/Chapter-18-Security-Testing-and-Vulnerabilities/18-02-Web-Application-Vulnerabilities/">
      
      
        <link rel="prev" href="../18-01-Security-Testing-Fundamentals/quiz/">
      
      
        <link rel="next" href="quiz/">
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>18.2 Web Application Vulnerabilities - Software Engineering Textbook HSC</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../assets/diagram-modal.css">
    
      <link rel="stylesheet" href="../../../../assets/quiz.css">
    
      <link rel="stylesheet" href="../../../../assets/common.css">
    
      <link rel="stylesheet" href="../../../../assets/diagram-fix.css">
    
      <link rel="stylesheet" href="../../../../assets/cross-reference.css">
    
      <link rel="stylesheet" href="../../../../assets/site-banner.css">
    
      <link rel="stylesheet" href="../../../../assets/code-runner.css">
    
      <link rel="stylesheet" href="../../../../assets/code-editor.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-58275RL1P9"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-58275RL1P9",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-58275RL1P9",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>if("undefined"!=typeof __md_analytics){var consent=__md_get("__consent");consent&&consent.analytics&&__md_analytics()}</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#182-web-application-vulnerabilities" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
  
  
    
    
    
    <div class="site-banner site-banner--warning" data-banner data-banner-version="1" role="status" aria-live="polite">
      <div class="site-banner__inner">
        <span class="site-banner__icon" aria-hidden="true">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            
              <path d="M12 9v4"/><path d="M12 17h.01"/><path d="M10.29 3.86 1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0Z"/>
            
          </svg>
        </span>
        <p class="site-banner__text">
          This textbook is in <strong>beta</strong> – content is actively being refined.
          
            <a class="site-banner__link" href="https://github.com/Eatham532/Software-Engineering-HSC-Textbook/issues/new/choose" target="_blank" rel="noopener">Report issues or suggestions</a>
          
        </p>
        <button type="button" class="site-banner__close" aria-label="Dismiss banner" title="Dismiss" data-banner-dismiss>&times;</button>
      </div>
    </div>
    <script>
      (function(){
        var banner=document.querySelector('[data-banner]');
        if(!banner) return;
        var version=banner.getAttribute('data-banner-version')||'1';
        var KEY='site_banner_dismissed_v'+version;
        try{ if(localStorage.getItem(KEY)){ banner.remove(); return;} }catch(e){}
        var btn=banner.querySelector('[data-banner-dismiss]');
        if(btn){ btn.addEventListener('click',function(){
          banner.classList.add('is-hiding');
          setTimeout(function(){ banner && banner.remove(); },200);
          try{ localStorage.setItem(KEY,'1'); }catch(e){}
        }); }
      })();
    </script>
  
  
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="Software Engineering Textbook HSC" class="md-header__button md-logo" aria-label="Software Engineering Textbook HSC" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Software Engineering Textbook HSC
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              18.2 Web Application Vulnerabilities
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/Eatham532/Software-Engineering-HSC-Textbook/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Eatham532/Software-Engineering-HSC-Textbook
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    

    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../Year11/ProgrammingFundamentals/" class="md-tabs__link">
          
  
  
  Year 11

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../../ProgrammingForTheWeb/" class="md-tabs__link">
          
  
  
  Year 12

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../code-editor/" class="md-tabs__link">
        
  
  
    
  
  Code Editor

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="Software Engineering Textbook HSC" class="md-nav__button md-logo" aria-label="Software Engineering Textbook HSC" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Software Engineering Textbook HSC
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Eatham532/Software-Engineering-HSC-Textbook/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Eatham532/Software-Engineering-HSC-Textbook
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    
  
  
  
    <a href="../../../../Year11/ProgrammingFundamentals/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Year 11
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Year 12
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Year 12
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../ProgrammingForTheWeb/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Programming For The Web
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" checked>
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Secure Software Architecture
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Secure Software Architecture
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    
  
  
  
    <a href="../../Chapter-14-Security-Foundations/14-01-The-Business-Case-for-Security/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Chapter 14 — Security Foundations
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    
  
  
  
    <a href="../../Chapter-15-Core-Security-Principles/15-01-Security-Fundamentals-CIA-Triad-and-AAA/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Chapter 15 — Core Security Principles
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    
  
  
  
    <a href="../../Chapter-16-Input-Security-and-Data-Protection/16-01-Input-Validation-and-Sanitization/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Chapter 16 — Input Security and Data Protection
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    
  
  
  
    <a href="../../Chapter-17-System-Security-and-APIs/17-01-Secure-API-Design/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Chapter 17 — System Security and APIs
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_6" checked>
        
          
          <label class="md-nav__link" for="__nav_3_2_6" id="__nav_3_2_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Chapter 18 — Security Testing & Vulnerabilities
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_2_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_2_6">
            <span class="md-nav__icon md-icon"></span>
            Chapter 18 — Security Testing & Vulnerabilities
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../18-01-Security-Testing-Fundamentals/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    18.1 Security Testing Fundamentals
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_6_2" checked>
        
          
          <label class="md-nav__link" for="__nav_3_2_6_2" id="__nav_3_2_6_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    18.2 Web Application Vulnerabilities
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_2_6_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_2_6_2">
            <span class="md-nav__icon md-icon"></span>
            18.2 Web Application Vulnerabilities
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cross-site-request-forgery-csrf-prevention" class="md-nav__link">
    <span class="md-ellipsis">
      Cross-Site Request Forgery (CSRF) Prevention
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cross-Site Request Forgery (CSRF) Prevention">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#understanding-csrf-attacks" class="md-nav__link">
    <span class="md-ellipsis">
      Understanding CSRF Attacks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-csrf-works" class="md-nav__link">
    <span class="md-ellipsis">
      How CSRF Works
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#csrf-prevention-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      CSRF Prevention Implementation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#samesite-cookie-protection" class="md-nav__link">
    <span class="md-ellipsis">
      SameSite Cookie Protection
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#broken-authentication-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      Broken Authentication Patterns
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Broken Authentication Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#common-authentication-vulnerabilities" class="md-nav__link">
    <span class="md-ellipsis">
      Common Authentication Vulnerabilities
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-misconfigurations" class="md-nav__link">
    <span class="md-ellipsis">
      Security Misconfigurations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Security Misconfigurations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#common-configuration-vulnerabilities" class="md-nav__link">
    <span class="md-ellipsis">
      Common Configuration Vulnerabilities
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#environment-specific-security" class="md-nav__link">
    <span class="md-ellipsis">
      Environment-Specific Security
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#race-conditions-and-concurrency-issues" class="md-nav__link">
    <span class="md-ellipsis">
      Race Conditions and Concurrency Issues
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Race Conditions and Concurrency Issues">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#understanding-race-conditions" class="md-nav__link">
    <span class="md-ellipsis">
      Understanding Race Conditions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#database-level-race-condition-prevention" class="md-nav__link">
    <span class="md-ellipsis">
      Database-Level Race Condition Prevention
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#side-channel-attacks" class="md-nav__link">
    <span class="md-ellipsis">
      Side-Channel Attacks
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Side-Channel Attacks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#understanding-side-channel-attacks" class="md-nav__link">
    <span class="md-ellipsis">
      Understanding Side-Channel Attacks
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#comprehensive-web-security-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Comprehensive Web Security Implementation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#key-takeaways" class="md-nav__link">
    <span class="md-ellipsis">
      Key Takeaways
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Key Takeaways">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#web-application-security-principles" class="md-nav__link">
    <span class="md-ellipsis">
      Web Application Security Principles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#best-practices-summary" class="md-nav__link">
    <span class="md-ellipsis">
      Best Practices Summary
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    
  
  
  
    <a href="../../Chapter-19-Security-in-Context/19-01-Security-in-Development-Teams/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Chapter 19 — Security in Context
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../SoftwareAutomation/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Software Automation
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../SoftwareEngineeringProject/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Software Engineering Project
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../code-editor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Code Editor
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#introduction" class="md-nav__link">
    <span class="md-ellipsis">
      Introduction
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cross-site-request-forgery-csrf-prevention" class="md-nav__link">
    <span class="md-ellipsis">
      Cross-Site Request Forgery (CSRF) Prevention
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cross-Site Request Forgery (CSRF) Prevention">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#understanding-csrf-attacks" class="md-nav__link">
    <span class="md-ellipsis">
      Understanding CSRF Attacks
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#how-csrf-works" class="md-nav__link">
    <span class="md-ellipsis">
      How CSRF Works
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#csrf-prevention-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      CSRF Prevention Implementation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#samesite-cookie-protection" class="md-nav__link">
    <span class="md-ellipsis">
      SameSite Cookie Protection
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#broken-authentication-patterns" class="md-nav__link">
    <span class="md-ellipsis">
      Broken Authentication Patterns
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Broken Authentication Patterns">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#common-authentication-vulnerabilities" class="md-nav__link">
    <span class="md-ellipsis">
      Common Authentication Vulnerabilities
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#security-misconfigurations" class="md-nav__link">
    <span class="md-ellipsis">
      Security Misconfigurations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Security Misconfigurations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#common-configuration-vulnerabilities" class="md-nav__link">
    <span class="md-ellipsis">
      Common Configuration Vulnerabilities
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#environment-specific-security" class="md-nav__link">
    <span class="md-ellipsis">
      Environment-Specific Security
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#race-conditions-and-concurrency-issues" class="md-nav__link">
    <span class="md-ellipsis">
      Race Conditions and Concurrency Issues
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Race Conditions and Concurrency Issues">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#understanding-race-conditions" class="md-nav__link">
    <span class="md-ellipsis">
      Understanding Race Conditions
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#database-level-race-condition-prevention" class="md-nav__link">
    <span class="md-ellipsis">
      Database-Level Race Condition Prevention
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#side-channel-attacks" class="md-nav__link">
    <span class="md-ellipsis">
      Side-Channel Attacks
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Side-Channel Attacks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#understanding-side-channel-attacks" class="md-nav__link">
    <span class="md-ellipsis">
      Understanding Side-Channel Attacks
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#comprehensive-web-security-implementation" class="md-nav__link">
    <span class="md-ellipsis">
      Comprehensive Web Security Implementation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#key-takeaways" class="md-nav__link">
    <span class="md-ellipsis">
      Key Takeaways
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Key Takeaways">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#web-application-security-principles" class="md-nav__link">
    <span class="md-ellipsis">
      Web Application Security Principles
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#best-practices-summary" class="md-nav__link">
    <span class="md-ellipsis">
      Best Practices Summary
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/Eatham532/Software-Engineering-HSC-Textbook/edit/main/docs/Year12/SecureSoftwareArchitecture/Chapter-18-Security-Testing-and-Vulnerabilities/18-02-Web-Application-Vulnerabilities/index.md" title="Edit this page" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/Eatham532/Software-Engineering-HSC-Textbook/raw/main/docs/Year12/SecureSoftwareArchitecture/Chapter-18-Security-Testing-and-Vulnerabilities/18-02-Web-Application-Vulnerabilities/index.md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg>
    </a>
  


<h1 id="182-web-application-vulnerabilities">18.2 Web Application Vulnerabilities<a class="headerlink" href="#182-web-application-vulnerabilities" title="Permanent link">&para;</a></h1>
<div class="admonition abstract">
<p class="admonition-title">Learning Objectives</p>
<p>By the end of this section, you will be able to:</p>
<ul>
<li>Understand and prevent Cross-Site Request Forgery (CSRF) attacks</li>
<li>Identify and fix broken authentication patterns</li>
<li>Recognize and remediate security misconfigurations</li>
<li>Detect and prevent race conditions and concurrency issues</li>
<li>Understand and mitigate side-channel attacks</li>
</ul>
</div>
<h2 id="introduction">Introduction<a class="headerlink" href="#introduction" title="Permanent link">&para;</a></h2>
<p><strong>Web application vulnerabilities</strong> are security weaknesses that can be exploited by attackers to compromise web applications and their users. These vulnerabilities often arise from common coding mistakes, misconfigurations, or design flaws that create opportunities for unauthorized access, data theft, or system compromise.</p>
<p>Understanding these vulnerabilities is crucial because:</p>
<ul>
<li>
<p>Web applications are increasingly the primary attack vector</p>
</li>
<li>
<p>Many vulnerabilities are preventable with proper coding practices</p>
</li>
<li>
<p>The impact of successful attacks can be devastating for businesses and users</p>
</li>
<li>
<p>Security must be considered throughout the development lifecycle</p>
</li>
</ul>
<p>This section focuses on advanced web vulnerabilities that go beyond basic injection attacks, covering sophisticated attack vectors and their prevention.</p>
<h2 id="cross-site-request-forgery-csrf-prevention">Cross-Site Request Forgery (CSRF) Prevention<a class="headerlink" href="#cross-site-request-forgery-csrf-prevention" title="Permanent link">&para;</a></h2>
<h3 id="understanding-csrf-attacks">Understanding CSRF Attacks<a class="headerlink" href="#understanding-csrf-attacks" title="Permanent link">&para;</a></h3>
<p><strong>Cross-Site Request Forgery (CSRF)</strong> tricks users into performing unintended actions on web applications where they&rsquo;re authenticated. The attacker crafts a malicious request that appears to come from a trusted user.</p>
<p>Think of CSRF like someone forging your signature on a check while you&rsquo;re not looking, using your identity to perform actions you never intended.</p>
<h3 id="how-csrf-works">How CSRF Works<a class="headerlink" href="#how-csrf-works" title="Permanent link">&para;</a></h3>
<div class="language-python highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="c1"># Example vulnerable web application (using Flask)</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">render_template_string</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="n">app</span><span class="o">.</span><span class="n">secret_key</span> <span class="o">=</span> <span class="s1">&#39;vulnerable_secret&#39;</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="c1"># Vulnerable endpoint - no CSRF protection</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/transfer&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="k">def</span><span class="w"> </span><span class="nf">transfer_money</span><span class="p">():</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a>    <span class="k">if</span> <span class="s1">&#39;user_id&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">session</span><span class="p">:</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a>        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">)</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a>    <span class="c1"># Vulnerable: directly processes POST data without CSRF token</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a>    <span class="n">to_account</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;to_account&#39;</span><span class="p">]</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a>    <span class="n">amount</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;amount&#39;</span><span class="p">]</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a>    <span class="c1"># Process transfer (simplified)</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a>    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Transferring $</span><span class="si">{</span><span class="n">amount</span><span class="si">}</span><span class="s2"> to account </span><span class="si">{</span><span class="n">to_account</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a>    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Transferred $</span><span class="si">{</span><span class="n">amount</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">to_account</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a><span class="c1"># Malicious page that exploits CSRF vulnerability</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a><span class="n">malicious_html</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a><span class="s1">&lt;html&gt;</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a><span class="s1">&lt;body&gt;</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a><span class="s1">    &lt;h1&gt;You&#39;ve won a prize! Click here to claim:&lt;/h1&gt;</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a><span class="s1">    &lt;!-- Hidden form that submits automatically --&gt;</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27" href="#__codelineno-0-27"></a><span class="s1">    &lt;form id=&quot;malicious&quot; action=&quot;http://vulnerable-bank.com/transfer&quot; method=&quot;POST&quot;&gt;</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28" href="#__codelineno-0-28"></a><span class="s1">        &lt;input type=&quot;hidden&quot; name=&quot;to_account&quot; value=&quot;attacker_account&quot;&gt;</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29" href="#__codelineno-0-29"></a><span class="s1">        &lt;input type=&quot;hidden&quot; name=&quot;amount&quot; value=&quot;1000&quot;&gt;</span>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30" href="#__codelineno-0-30"></a><span class="s1">    &lt;/form&gt;</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31" href="#__codelineno-0-31"></a>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32" href="#__codelineno-0-32"></a><span class="s1">    &lt;script&gt;</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33" href="#__codelineno-0-33"></a><span class="s1">        // Automatically submit the form when page loads</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34" href="#__codelineno-0-34"></a><span class="s1">        document.getElementById(&#39;malicious&#39;).submit();</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35" href="#__codelineno-0-35"></a><span class="s1">    &lt;/script&gt;</span>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36" href="#__codelineno-0-36"></a><span class="s1">&lt;/body&gt;</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37" href="#__codelineno-0-37"></a><span class="s1">&lt;/html&gt;</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38" href="#__codelineno-0-38"></a><span class="s1">&#39;&#39;&#39;</span>
</span></code></pre></div>
<h3 id="csrf-prevention-implementation">CSRF Prevention Implementation<a class="headerlink" href="#csrf-prevention-implementation" title="Permanent link">&para;</a></h3>
<div class="highlight python-template" data-fence-type="template" data-language="python">
<pre><code class="language-python"><span class="kn">import</span><span class="w"> </span><span class="nn">secrets</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">hmac</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">abort</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">wraps</span>

<span class="k">class</span><span class="w"> </span><span class="nc">CSRFProtection</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">app</span>
        <span class="k">if</span> <span class="n">app</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">init_app</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">init_app</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">):</span>
        <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">&#39;CSRF_SECRET_KEY&#39;</span><span class="p">,</span> <span class="n">secrets</span><span class="o">.</span><span class="n">token_hex</span><span class="p">(</span><span class="mi">32</span><span class="p">))</span>
        <span class="n">app</span><span class="o">.</span><span class="n">before_request</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">check_csrf</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_csrf_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session_data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate a CSRF token for the current session&quot;&quot;&quot;</span>
        <span class="n">secret_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;CSRF_SECRET_KEY&#39;</span><span class="p">]</span>
        <span class="n">user_id</span> <span class="o">=</span> <span class="n">session_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="s1">&#39;anonymous&#39;</span><span class="p">)</span>
        <span class="n">timestamp</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()))</span>

        <span class="c1"># Create token with user_id and timestamp</span>
        <span class="n">token_data</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">signature</span> <span class="o">=</span> <span class="n">hmac</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
            <span class="n">secret_key</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span>
            <span class="n">token_data</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span>
            <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span>
        <span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">token_data</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">signature</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">validate_csrf_token</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">session_data</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate a CSRF token&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">parts</span> <span class="o">=</span> <span class="n">token</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parts</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">3</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="n">user_id</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">,</span> <span class="n">signature</span> <span class="o">=</span> <span class="n">parts</span>
            <span class="n">expected_token_data</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">:</span><span class="si">{</span><span class="n">timestamp</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="c1"># Verify signature</span>
            <span class="n">secret_key</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="p">[</span><span class="s1">&#39;CSRF_SECRET_KEY&#39;</span><span class="p">]</span>
            <span class="n">expected_signature</span> <span class="o">=</span> <span class="n">hmac</span><span class="o">.</span><span class="n">new</span><span class="p">(</span>
                <span class="n">secret_key</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span>
                <span class="n">expected_token_data</span><span class="o">.</span><span class="n">encode</span><span class="p">(),</span>
                <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span>
            <span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">hmac</span><span class="o">.</span><span class="n">compare_digest</span><span class="p">(</span><span class="n">signature</span><span class="p">,</span> <span class="n">expected_signature</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="c1"># Check if token is for current user</span>
            <span class="k">if</span> <span class="n">user_id</span> <span class="o">!=</span> <span class="n">session_data</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="s1">&#39;anonymous&#39;</span><span class="p">):</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="c1"># Check token age (24 hour expiry)</span>
            <span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
            <span class="n">token_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">timestamp</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">token_time</span> <span class="o">&gt;</span> <span class="mi">86400</span><span class="p">:</span>  <span class="c1"># 24 hours</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="k">return</span> <span class="kc">True</span>

        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check_csrf</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check CSRF token on state-changing requests&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="s1">&#39;PUT&#39;</span><span class="p">,</span> <span class="s1">&#39;DELETE&#39;</span><span class="p">,</span> <span class="s1">&#39;PATCH&#39;</span><span class="p">]:</span>
            <span class="c1"># Skip CSRF check for API endpoints with proper authentication</span>
            <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;/api/&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_api_authenticated</span><span class="p">():</span>
                <span class="k">return</span>

            <span class="n">token</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;csrf_token&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;X-CSRF-Token&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">token</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_csrf_token</span><span class="p">(</span><span class="n">token</span><span class="p">,</span> <span class="n">session</span><span class="p">):</span>
                <span class="n">abort</span><span class="p">(</span><span class="mi">403</span><span class="p">,</span> <span class="s2">&quot;CSRF token validation failed&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_api_authenticated</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if request has proper API authentication&quot;&quot;&quot;</span>
        <span class="c1"># Implement API key or JWT validation</span>
        <span class="n">api_key</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;X-API-Key&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">api_key</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_api_key</span><span class="p">(</span><span class="n">api_key</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">validate_api_key</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">api_key</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate API key (simplified)&quot;&quot;&quot;</span>
        <span class="c1"># In real implementation, check against database</span>
        <span class="n">valid_keys</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;api_key_1&#39;</span><span class="p">,</span> <span class="s1">&#39;api_key_2&#39;</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">api_key</span> <span class="ow">in</span> <span class="n">valid_keys</span>

<span class="c1"># Secure web application with CSRF protection</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">secret_key</span> <span class="o">=</span> <span class="s1">&#39;secure_secret_key&#39;</span>
<span class="n">csrf</span> <span class="o">=</span> <span class="n">CSRFProtection</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/transfer&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">secure_transfer</span><span class="p">():</span>
    <span class="k">if</span> <span class="s1">&#39;user_id&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">session</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">)</span>

    <span class="c1"># CSRF protection is automatically applied by middleware</span>
    <span class="n">to_account</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;to_account&#39;</span><span class="p">]</span>
    <span class="n">amount</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">form</span><span class="p">[</span><span class="s1">&#39;amount&#39;</span><span class="p">]</span>

    <span class="c1"># Additional validation</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">validate_account_number</span><span class="p">(</span><span class="n">to_account</span><span class="p">):</span>
        <span class="n">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="s2">&quot;Invalid account number&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">validate_amount</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
        <span class="n">abort</span><span class="p">(</span><span class="mi">400</span><span class="p">,</span> <span class="s2">&quot;Invalid amount&quot;</span><span class="p">)</span>

    <span class="c1"># Process transfer</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Secure transfer: $</span><span class="si">{</span><span class="n">amount</span><span class="si">}</span><span class="s2"> to account </span><span class="si">{</span><span class="n">to_account</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;Transferred $</span><span class="si">{</span><span class="n">amount</span><span class="si">}</span><span class="s2"> to </span><span class="si">{</span><span class="n">to_account</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="k">def</span><span class="w"> </span><span class="nf">validate_account_number</span><span class="p">(</span><span class="n">account</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate account number format&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">account</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">account</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">8</span>

<span class="k">def</span><span class="w"> </span><span class="nf">validate_amount</span><span class="p">(</span><span class="n">amount</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validate transfer amount&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">amt</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">amount</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">0</span> <span class="o">&lt;</span> <span class="n">amt</span> <span class="o">&lt;=</span> <span class="mi">10000</span>  <span class="c1"># Reasonable limits</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">False</span>

<span class="c1"># Template helper for CSRF tokens</span>
<span class="nd">@app</span><span class="o">.</span><span class="n">context_processor</span>
<span class="k">def</span><span class="w"> </span><span class="nf">inject_csrf_token</span><span class="p">():</span>
    <span class="k">if</span> <span class="s1">&#39;user_id&#39;</span> <span class="ow">in</span> <span class="n">session</span><span class="p">:</span>
        <span class="n">token</span> <span class="o">=</span> <span class="n">csrf</span><span class="o">.</span><span class="n">generate_csrf_token</span><span class="p">(</span><span class="n">session</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;csrf_token&#39;</span><span class="p">:</span> <span class="n">token</span><span class="p">}</span>
    <span class="k">return</span> <span class="p">{}</span>

<span class="c1"># Secure form template</span>
<span class="n">secure_form_template</span> <span class="o">=</span> <span class="s1">&#39;&#39;&#39;</span>
<span class="s1">&lt;form method=&quot;POST&quot; action=&quot;/transfer&quot;&gt;</span>
<span class="s1">    &lt;input type=&quot;hidden&quot; name=&quot;csrf_token&quot; value=&quot;{{ csrf_token }}&quot;&gt;</span>
<span class="s1">    &lt;label&gt;To Account: &lt;input type=&quot;text&quot; name=&quot;to_account&quot; required&gt;&lt;/label&gt;</span>
<span class="s1">    &lt;label&gt;Amount: &lt;input type=&quot;number&quot; name=&quot;amount&quot; step=&quot;0.01&quot; required&gt;&lt;/label&gt;</span>
<span class="s1">    &lt;button type=&quot;submit&quot;&gt;Transfer&lt;/button&gt;</span>
<span class="s1">&lt;/form&gt;</span>
<span class="s1">&#39;&#39;&#39;</span>
</code></pre>
</div>
<h3 id="samesite-cookie-protection">SameSite Cookie Protection<a class="headerlink" href="#samesite-cookie-protection" title="Permanent link">&para;</a></h3>
<div class="language-python highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="c1"># Enhanced session configuration for CSRF protection</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="nd">@app</span><span class="o">.</span><span class="n">after_request</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="k">def</span><span class="w"> </span><span class="nf">set_secure_headers</span><span class="p">(</span><span class="n">response</span><span class="p">):</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a>    <span class="c1"># Set secure session cookie attributes</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a>    <span class="k">if</span> <span class="s1">&#39;Set-Cookie&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">:</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a>        <span class="n">cookies</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">getlist</span><span class="p">(</span><span class="s1">&#39;Set-Cookie&#39;</span><span class="p">)</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a>        <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;Set-Cookie&#39;</span><span class="p">)</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a>        <span class="k">for</span> <span class="n">cookie</span> <span class="ow">in</span> <span class="n">cookies</span><span class="p">:</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a>            <span class="k">if</span> <span class="s1">&#39;session=&#39;</span> <span class="ow">in</span> <span class="n">cookie</span><span class="p">:</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a>                <span class="c1"># Add SameSite protection</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a>                <span class="k">if</span> <span class="s1">&#39;SameSite=&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cookie</span><span class="p">:</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a>                    <span class="n">cookie</span> <span class="o">+=</span> <span class="s1">&#39;; SameSite=Strict&#39;</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a>                <span class="c1"># Ensure Secure flag for HTTPS</span>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a>                <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">is_secure</span> <span class="ow">and</span> <span class="s1">&#39;Secure&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cookie</span><span class="p">:</span>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a>                    <span class="n">cookie</span> <span class="o">+=</span> <span class="s1">&#39;; Secure&#39;</span>
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a>
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a>                <span class="c1"># Add HttpOnly flag</span>
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a>                <span class="k">if</span> <span class="s1">&#39;HttpOnly&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cookie</span><span class="p">:</span>
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a>                    <span class="n">cookie</span> <span class="o">+=</span> <span class="s1">&#39;; HttpOnly&#39;</span>
</span><span id="__span-1-22"><a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a>
</span><span id="__span-1-23"><a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a>            <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s1">&#39;Set-Cookie&#39;</span><span class="p">,</span> <span class="n">cookie</span><span class="p">)</span>
</span><span id="__span-1-24"><a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a>
</span><span id="__span-1-25"><a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a>    <span class="k">return</span> <span class="n">response</span>
</span></code></pre></div>
<h2 id="broken-authentication-patterns">Broken Authentication Patterns<a class="headerlink" href="#broken-authentication-patterns" title="Permanent link">&para;</a></h2>
<h3 id="common-authentication-vulnerabilities">Common Authentication Vulnerabilities<a class="headerlink" href="#common-authentication-vulnerabilities" title="Permanent link">&para;</a></h3>
<p>Broken authentication encompasses various vulnerabilities that compromise user identity verification and session management.</p>
<div class="highlight python-template" data-fence-type="template" data-language="python">
<pre><code class="language-python"><span class="kn">import</span><span class="w"> </span><span class="nn">bcrypt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jwt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">secrets</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">defaultdict</span><span class="p">,</span> <span class="n">deque</span>

<span class="k">class</span><span class="w"> </span><span class="nc">VulnerableAuthenticator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Example of common authentication vulnerabilities&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">users</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;admin&#39;</span><span class="p">:</span> <span class="s1">&#39;admin123&#39;</span><span class="p">,</span>  <span class="c1"># Vulnerable: weak password</span>
            <span class="s1">&#39;user1&#39;</span><span class="p">:</span> <span class="s1">&#39;password&#39;</span>   <span class="c1"># Vulnerable: common password</span>
        <span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sessions</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">login_vulnerable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Vulnerable login implementation&quot;&quot;&quot;</span>
        <span class="c1"># Vulnerable: no rate limiting</span>
        <span class="c1"># Vulnerable: timing attack possible</span>
        <span class="k">if</span> <span class="n">username</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">username</span><span class="p">]</span> <span class="o">==</span> <span class="n">password</span><span class="p">:</span>
            <span class="c1"># Vulnerable: predictable session ID</span>
            <span class="n">session_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sessions</span><span class="p">[</span><span class="n">session_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">username</span>
            <span class="k">return</span> <span class="n">session_id</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check_session_vulnerable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Vulnerable session validation&quot;&quot;&quot;</span>
        <span class="c1"># Vulnerable: no session timeout</span>
        <span class="c1"># Vulnerable: no session invalidation</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">sessions</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">session_id</span><span class="p">)</span>

<span class="k">class</span><span class="w"> </span><span class="nc">SecureAuthenticator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Secure authentication implementation&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">users</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sessions</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">failed_attempts</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">deque</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">locked_accounts</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">session_timeout</span> <span class="o">=</span> <span class="mi">3600</span>  <span class="c1"># 1 hour</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">max_failed_attempts</span> <span class="o">=</span> <span class="mi">5</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lockout_duration</span> <span class="o">=</span> <span class="mi">900</span>  <span class="c1"># 15 minutes</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">register_user</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Secure user registration&quot;&quot;&quot;</span>
        <span class="c1"># Validate password strength</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_strong_password</span><span class="p">(</span><span class="n">password</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Password does not meet security requirements&quot;</span><span class="p">)</span>

        <span class="c1"># Hash password with salt</span>
        <span class="n">password_hash</span> <span class="o">=</span> <span class="n">bcrypt</span><span class="o">.</span><span class="n">hashpw</span><span class="p">(</span><span class="n">password</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span> <span class="n">bcrypt</span><span class="o">.</span><span class="n">gensalt</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">username</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;password_hash&#39;</span><span class="p">:</span> <span class="n">password_hash</span><span class="p">,</span>
            <span class="s1">&#39;created_at&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
            <span class="s1">&#39;last_login&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
            <span class="s1">&#39;failed_login_count&#39;</span><span class="p">:</span> <span class="mi">0</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_strong_password</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate password strength&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">password</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">12</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">has_upper</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">isupper</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">password</span><span class="p">)</span>
        <span class="n">has_lower</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">islower</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">password</span><span class="p">)</span>
        <span class="n">has_digit</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">isdigit</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">password</span><span class="p">)</span>
        <span class="n">has_special</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">c</span> <span class="ow">in</span> <span class="s1">&#39;!@#$%^&amp;*()_+-=[]</span><span class="si">{}</span><span class="s1">|;:,.&lt;&gt;?&#39;</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">password</span><span class="p">)</span>

        <span class="c1"># Common password check (simplified)</span>
        <span class="n">common_passwords</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">,</span> <span class="s1">&#39;123456&#39;</span><span class="p">,</span> <span class="s1">&#39;admin123&#39;</span><span class="p">,</span> <span class="s1">&#39;qwerty&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">password</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">common_passwords</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="n">has_upper</span> <span class="ow">and</span> <span class="n">has_lower</span> <span class="ow">and</span> <span class="n">has_digit</span> <span class="ow">and</span> <span class="n">has_special</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">login</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">client_ip</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Secure login with rate limiting and proper validation&quot;&quot;&quot;</span>
        <span class="n">current_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="c1"># Check if account is locked</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_account_locked</span><span class="p">(</span><span class="n">username</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Account temporarily locked due to failed login attempts&quot;</span><span class="p">)</span>

        <span class="c1"># Check rate limiting per IP</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_ip_rate_limited</span><span class="p">(</span><span class="n">client_ip</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Too many login attempts from this IP&quot;</span><span class="p">)</span>

        <span class="c1"># Validate user exists</span>
        <span class="k">if</span> <span class="n">username</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">record_failed_attempt</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">client_ip</span><span class="p">)</span>
            <span class="c1"># Use constant time to prevent username enumeration</span>
            <span class="n">bcrypt</span><span class="o">.</span><span class="n">hashpw</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;dummy&#39;</span><span class="p">,</span> <span class="n">bcrypt</span><span class="o">.</span><span class="n">gensalt</span><span class="p">())</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid credentials&quot;</span><span class="p">)</span>

        <span class="n">user_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">username</span><span class="p">]</span>

        <span class="c1"># Verify password (constant time comparison)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">bcrypt</span><span class="o">.</span><span class="n">checkpw</span><span class="p">(</span><span class="n">password</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span> <span class="n">user_data</span><span class="p">[</span><span class="s1">&#39;password_hash&#39;</span><span class="p">]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">record_failed_attempt</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">client_ip</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Invalid credentials&quot;</span><span class="p">)</span>

        <span class="c1"># Reset failed attempts on successful login</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reset_failed_attempts</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">client_ip</span><span class="p">)</span>

        <span class="c1"># Create secure session</span>
        <span class="n">session_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_session</span><span class="p">(</span><span class="n">username</span><span class="p">)</span>

        <span class="c1"># Update last login</span>
        <span class="n">user_data</span><span class="p">[</span><span class="s1">&#39;last_login&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">session_id</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_session</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create cryptographically secure session&quot;&quot;&quot;</span>
        <span class="n">session_id</span> <span class="o">=</span> <span class="n">secrets</span><span class="o">.</span><span class="n">token_urlsafe</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sessions</span><span class="p">[</span><span class="n">session_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span>
            <span class="s1">&#39;created_at&#39;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span>
            <span class="s1">&#39;last_activity&#39;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span>
            <span class="s1">&#39;ip_address&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>  <span class="c1"># Set by calling code</span>
            <span class="s1">&#39;user_agent&#39;</span><span class="p">:</span> <span class="kc">None</span>   <span class="c1"># Set by calling code</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">session_id</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">validate_session</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session_id</span><span class="p">,</span> <span class="n">client_ip</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">user_agent</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate session with security checks&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">session_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sessions</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="n">session</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">sessions</span><span class="p">[</span><span class="n">session_id</span><span class="p">]</span>
        <span class="n">current_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="c1"># Check session timeout</span>
        <span class="k">if</span> <span class="n">current_time</span> <span class="o">-</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;last_activity&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">session_timeout</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">invalidate_session</span><span class="p">(</span><span class="n">session_id</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>

        <span class="c1"># Check for session hijacking (simplified)</span>
        <span class="k">if</span> <span class="n">client_ip</span> <span class="ow">and</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;ip_address&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;ip_address&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">client_ip</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">invalidate_session</span><span class="p">(</span><span class="n">session_id</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Session security violation detected&quot;</span><span class="p">)</span>

        <span class="c1"># Update last activity</span>
        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;last_activity&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_time</span>

        <span class="k">return</span> <span class="n">session</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">invalidate_session</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">session_id</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Securely invalidate session&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">session_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sessions</span><span class="p">:</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">sessions</span><span class="p">[</span><span class="n">session_id</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_account_locked</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if account is temporarily locked&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">username</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">locked_accounts</span><span class="p">:</span>
            <span class="n">lock_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">locked_accounts</span><span class="p">[</span><span class="n">username</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">lock_time</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">lockout_duration</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">locked_accounts</span><span class="p">[</span><span class="n">username</span><span class="p">]</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_ip_rate_limited</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_ip</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if IP is rate limited&quot;&quot;&quot;</span>
        <span class="n">current_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="c1"># Clean old attempts (older than 15 minutes)</span>
        <span class="k">while</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">failed_attempts</span><span class="p">[</span><span class="n">client_ip</span><span class="p">]</span> <span class="ow">and</span> 
               <span class="n">current_time</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">failed_attempts</span><span class="p">[</span><span class="n">client_ip</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">900</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">failed_attempts</span><span class="p">[</span><span class="n">client_ip</span><span class="p">]</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>

        <span class="c1"># Check if too many attempts</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">failed_attempts</span><span class="p">[</span><span class="n">client_ip</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_failed_attempts</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">record_failed_attempt</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">client_ip</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Record failed login attempt&quot;&quot;&quot;</span>
        <span class="n">current_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="c1"># Record IP-based attempt</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">failed_attempts</span><span class="p">[</span><span class="n">client_ip</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_time</span><span class="p">)</span>

        <span class="c1"># Update user failed count</span>
        <span class="k">if</span> <span class="n">username</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">username</span><span class="p">][</span><span class="s1">&#39;failed_login_count&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># Lock account if too many failures</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">username</span><span class="p">][</span><span class="s1">&#39;failed_login_count&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_failed_attempts</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">locked_accounts</span><span class="p">[</span><span class="n">username</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_time</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">reset_failed_attempts</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">client_ip</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Reset failed attempts on successful login&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">username</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">users</span><span class="p">[</span><span class="n">username</span><span class="p">][</span><span class="s1">&#39;failed_login_count&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">client_ip</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">failed_attempts</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">failed_attempts</span><span class="p">[</span><span class="n">client_ip</span><span class="p">]</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

<span class="c1"># Example usage with Flask</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">jsonify</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
<span class="n">app</span><span class="o">.</span><span class="n">secret_key</span> <span class="o">=</span> <span class="n">secrets</span><span class="o">.</span><span class="n">token_hex</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span>
<span class="n">auth</span> <span class="o">=</span> <span class="n">SecureAuthenticator</span><span class="p">()</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/register&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">register</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span>
        <span class="n">auth</span><span class="o">.</span><span class="n">register_user</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;success&#39;</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;User registered&#39;</span><span class="p">})</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}),</span> <span class="mi">400</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
<span class="k">def</span><span class="w"> </span><span class="nf">login</span><span class="p">():</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span>
        <span class="n">session_id</span> <span class="o">=</span> <span class="n">auth</span><span class="o">.</span><span class="n">login</span><span class="p">(</span>
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">],</span> 
            <span class="n">data</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">],</span> 
            <span class="n">request</span><span class="o">.</span><span class="n">remote_addr</span>
        <span class="p">)</span>

        <span class="n">session</span><span class="p">[</span><span class="s1">&#39;session_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">session_id</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;success&#39;</span><span class="p">,</span> <span class="s1">&#39;session_id&#39;</span><span class="p">:</span> <span class="n">session_id</span><span class="p">})</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}),</span> <span class="mi">401</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/protected&#39;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">protected_resource</span><span class="p">():</span>
    <span class="n">session_id</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;session_id&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">session_id</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Not authenticated&#39;</span><span class="p">}),</span> <span class="mi">401</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">username</span> <span class="o">=</span> <span class="n">auth</span><span class="o">.</span><span class="n">validate_session</span><span class="p">(</span>
            <span class="n">session_id</span><span class="p">,</span> 
            <span class="n">request</span><span class="o">.</span><span class="n">remote_addr</span><span class="p">,</span> 
            <span class="n">request</span><span class="o">.</span><span class="n">user_agent</span><span class="o">.</span><span class="n">string</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Hello </span><span class="si">{</span><span class="n">username</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">:</span> <span class="s1">&#39;protected content&#39;</span><span class="p">})</span>

    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}),</span> <span class="mi">401</span>
</code></pre>
</div>
<h2 id="security-misconfigurations">Security Misconfigurations<a class="headerlink" href="#security-misconfigurations" title="Permanent link">&para;</a></h2>
<h3 id="common-configuration-vulnerabilities">Common Configuration Vulnerabilities<a class="headerlink" href="#common-configuration-vulnerabilities" title="Permanent link">&para;</a></h3>
<p>Security misconfigurations are among the most common vulnerabilities, often resulting from default settings, incomplete configurations, or overly permissive setups.</p>
<div class="highlight python-template" data-fence-type="template" data-language="python">
<pre><code class="language-python"><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flask_talisman</span><span class="w"> </span><span class="kn">import</span> <span class="n">Talisman</span>

<span class="k">class</span><span class="w"> </span><span class="nc">SecurityConfigurationManager</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Manages secure application configuration&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">security_headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;Content-Security-Policy&#39;</span><span class="p">:</span> <span class="s2">&quot;default-src &#39;self&#39;; script-src &#39;self&#39; &#39;unsafe-inline&#39;; style-src &#39;self&#39; &#39;unsafe-inline&#39;&quot;</span><span class="p">,</span>
            <span class="s1">&#39;X-Content-Type-Options&#39;</span><span class="p">:</span> <span class="s1">&#39;nosniff&#39;</span><span class="p">,</span>
            <span class="s1">&#39;X-Frame-Options&#39;</span><span class="p">:</span> <span class="s1">&#39;DENY&#39;</span><span class="p">,</span>
            <span class="s1">&#39;X-XSS-Protection&#39;</span><span class="p">:</span> <span class="s1">&#39;1; mode=block&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Strict-Transport-Security&#39;</span><span class="p">:</span> <span class="s1">&#39;max-age=31536000; includeSubDomains&#39;</span><span class="p">,</span>
            <span class="s1">&#39;Referrer-Policy&#39;</span><span class="p">:</span> <span class="s1">&#39;strict-origin-when-cross-origin&#39;</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">configure_secure_flask_app</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Configure Flask app with security best practices&quot;&quot;&quot;</span>

        <span class="c1"># Secure configuration</span>
        <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
            <span class="c1"># Session security</span>
            <span class="s1">&#39;SESSION_COOKIE_SECURE&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>  <span class="c1"># HTTPS only</span>
            <span class="s1">&#39;SESSION_COOKIE_HTTPONLY&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>  <span class="c1"># No JavaScript access</span>
            <span class="s1">&#39;SESSION_COOKIE_SAMESITE&#39;</span><span class="p">:</span> <span class="s1">&#39;Strict&#39;</span><span class="p">,</span>  <span class="c1"># CSRF protection</span>
            <span class="s1">&#39;PERMANENT_SESSION_LIFETIME&#39;</span><span class="p">:</span> <span class="mi">3600</span><span class="p">,</span>  <span class="c1"># 1 hour timeout</span>

            <span class="c1"># General security</span>
            <span class="s1">&#39;SECRET_KEY&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SECRET_KEY&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">urandom</span><span class="p">(</span><span class="mi">32</span><span class="p">)),</span>
            <span class="s1">&#39;WTF_CSRF_ENABLED&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;DEBUG&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>  <span class="c1"># Never enable in production</span>
            <span class="s1">&#39;TESTING&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>

            <span class="c1"># File upload security</span>
            <span class="s1">&#39;MAX_CONTENT_LENGTH&#39;</span><span class="p">:</span> <span class="mi">16</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">,</span>  <span class="c1"># 16MB max file size</span>
            <span class="s1">&#39;UPLOAD_FOLDER&#39;</span><span class="p">:</span> <span class="s1">&#39;/secure/uploads&#39;</span><span class="p">,</span>

            <span class="c1"># Database security</span>
            <span class="s1">&#39;SQLALCHEMY_DATABASE_URI&#39;</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DATABASE_URL&#39;</span><span class="p">,</span> <span class="s1">&#39;sqlite:///secure_app.db&#39;</span><span class="p">),</span>
            <span class="s1">&#39;SQLALCHEMY_TRACK_MODIFICATIONS&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;SQLALCHEMY_ENGINE_OPTIONS&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;pool_pre_ping&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s1">&#39;pool_recycle&#39;</span><span class="p">:</span> <span class="mi">300</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">})</span>

        <span class="c1"># Apply security headers</span>
        <span class="n">Talisman</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> 
                <span class="n">force_https</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">strict_transport_security</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">content_security_policy</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">security_headers</span><span class="p">[</span><span class="s1">&#39;Content-Security-Policy&#39;</span><span class="p">])</span>

        <span class="k">return</span> <span class="n">app</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check_configuration_security</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Audit application configuration for security issues&quot;&quot;&quot;</span>
        <span class="n">issues</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Check debug mode</span>
        <span class="k">if</span> <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DEBUG&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">issues</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;severity&#39;</span><span class="p">:</span> <span class="s1">&#39;critical&#39;</span><span class="p">,</span>
                <span class="s1">&#39;issue&#39;</span><span class="p">:</span> <span class="s1">&#39;Debug mode enabled in production&#39;</span><span class="p">,</span>
                <span class="s1">&#39;recommendation&#39;</span><span class="p">:</span> <span class="s1">&#39;Set DEBUG=False&#39;</span>
            <span class="p">})</span>

        <span class="c1"># Check secret key</span>
        <span class="n">secret_key</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SECRET_KEY&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">secret_key</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">secret_key</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mi">32</span><span class="p">:</span>
            <span class="n">issues</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;severity&#39;</span><span class="p">:</span> <span class="s1">&#39;critical&#39;</span><span class="p">,</span>
                <span class="s1">&#39;issue&#39;</span><span class="p">:</span> <span class="s1">&#39;Weak or missing secret key&#39;</span><span class="p">,</span>
                <span class="s1">&#39;recommendation&#39;</span><span class="p">:</span> <span class="s1">&#39;Use a strong, randomly generated secret key&#39;</span>
            <span class="p">})</span>

        <span class="c1"># Check session security</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SESSION_COOKIE_SECURE&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">issues</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;severity&#39;</span><span class="p">:</span> <span class="s1">&#39;high&#39;</span><span class="p">,</span>
                <span class="s1">&#39;issue&#39;</span><span class="p">:</span> <span class="s1">&#39;Session cookies not marked as secure&#39;</span><span class="p">,</span>
                <span class="s1">&#39;recommendation&#39;</span><span class="p">:</span> <span class="s1">&#39;Set SESSION_COOKIE_SECURE=True&#39;</span>
            <span class="p">})</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;SESSION_COOKIE_HTTPONLY&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">issues</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;severity&#39;</span><span class="p">:</span> <span class="s1">&#39;high&#39;</span><span class="p">,</span>
                <span class="s1">&#39;issue&#39;</span><span class="p">:</span> <span class="s1">&#39;Session cookies accessible to JavaScript&#39;</span><span class="p">,</span>
                <span class="s1">&#39;recommendation&#39;</span><span class="p">:</span> <span class="s1">&#39;Set SESSION_COOKIE_HTTPONLY=True&#39;</span>
            <span class="p">})</span>

        <span class="c1"># Check HTTPS enforcement</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;PREFERRED_URL_SCHEME&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="s1">&#39;https&#39;</span><span class="p">:</span>
            <span class="n">issues</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;severity&#39;</span><span class="p">:</span> <span class="s1">&#39;medium&#39;</span><span class="p">,</span>
                <span class="s1">&#39;issue&#39;</span><span class="p">:</span> <span class="s1">&#39;HTTPS not enforced&#39;</span><span class="p">,</span>
                <span class="s1">&#39;recommendation&#39;</span><span class="p">:</span> <span class="s1">&#39;Set PREFERRED_URL_SCHEME=https&#39;</span>
            <span class="p">})</span>

        <span class="k">return</span> <span class="n">issues</span>

<span class="c1"># Example of secure vs insecure configuration</span>
<span class="k">def</span><span class="w"> </span><span class="nf">create_vulnerable_app</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Example of insecure Flask configuration&quot;&quot;&quot;</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="c1"># Vulnerable configurations</span>
    <span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
        <span class="s1">&#39;DEBUG&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>  <span class="c1"># Exposes sensitive information</span>
        <span class="s1">&#39;SECRET_KEY&#39;</span><span class="p">:</span> <span class="s1">&#39;easy_to_guess&#39;</span><span class="p">,</span>  <span class="c1"># Weak secret</span>
        <span class="s1">&#39;SESSION_COOKIE_SECURE&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>  <span class="c1"># Allows HTTP transmission</span>
        <span class="s1">&#39;SESSION_COOKIE_HTTPONLY&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>  <span class="c1"># XSS vulnerable</span>
        <span class="s1">&#39;WTF_CSRF_ENABLED&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>  <span class="c1"># CSRF vulnerable</span>
    <span class="p">})</span>

    <span class="k">return</span> <span class="n">app</span>

<span class="k">def</span><span class="w"> </span><span class="nf">create_secure_app</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Example of secure Flask configuration&quot;&quot;&quot;</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="n">config_manager</span> <span class="o">=</span> <span class="n">SecurityConfigurationManager</span><span class="p">()</span>

    <span class="c1"># Apply secure configuration</span>
    <span class="n">secure_app</span> <span class="o">=</span> <span class="n">config_manager</span><span class="o">.</span><span class="n">configure_secure_flask_app</span><span class="p">(</span><span class="n">app</span><span class="p">)</span>

    <span class="c1"># Additional security middleware</span>
    <span class="nd">@secure_app</span><span class="o">.</span><span class="n">before_request</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">security_headers</span><span class="p">():</span>
        <span class="c1"># Custom security headers if needed</span>
        <span class="k">pass</span>

    <span class="nd">@secure_app</span><span class="o">.</span><span class="n">after_request</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">apply_caching</span><span class="p">(</span><span class="n">response</span><span class="p">):</span>
        <span class="c1"># Prevent caching of sensitive pages</span>
        <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">endpoint</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;login&#39;</span><span class="p">,</span> <span class="s1">&#39;admin&#39;</span><span class="p">,</span> <span class="s1">&#39;profile&#39;</span><span class="p">]:</span>
            <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Cache-Control&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;no-cache, no-store, must-revalidate&#39;</span>
            <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Pragma&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;no-cache&#39;</span>
            <span class="n">response</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="s1">&#39;Expires&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;0&#39;</span>

        <span class="k">return</span> <span class="n">response</span>

    <span class="k">return</span> <span class="n">secure_app</span>
</code></pre>
</div>
<h3 id="environment-specific-security">Environment-Specific Security<a class="headerlink" href="#environment-specific-security" title="Permanent link">&para;</a></h3>
<div class="highlight python-template" data-fence-type="template" data-language="python">
<pre><code class="language-python"><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">pathlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">Path</span>

<span class="k">class</span><span class="w"> </span><span class="nc">EnvironmentSecurityValidator</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Validates security configurations across environments&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">required_env_vars</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;SECRET_KEY&#39;</span><span class="p">,</span>
            <span class="s1">&#39;DATABASE_URL&#39;</span><span class="p">,</span>
            <span class="s1">&#39;API_KEY_ENCRYPTION_KEY&#39;</span>
        <span class="p">]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">sensitive_patterns</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;password&#39;</span><span class="p">,</span>
            <span class="s1">&#39;secret&#39;</span><span class="p">,</span>
            <span class="s1">&#39;key&#39;</span><span class="p">,</span>
            <span class="s1">&#39;token&#39;</span><span class="p">,</span>
            <span class="s1">&#39;credential&#39;</span>
        <span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">validate_environment</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate current environment security&quot;&quot;&quot;</span>
        <span class="n">issues</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Check required environment variables</span>
        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">required_env_vars</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">var</span><span class="p">):</span>
                <span class="n">issues</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;missing_env_var&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;severity&#39;</span><span class="p">:</span> <span class="s1">&#39;critical&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Required environment variable </span><span class="si">{</span><span class="n">var</span><span class="si">}</span><span class="s1"> not set&#39;</span>
                <span class="p">})</span>

        <span class="c1"># Check for hardcoded secrets in environment</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">pattern</span> <span class="ow">in</span> <span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">pattern</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">sensitive_patterns</span><span class="p">):</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">16</span><span class="p">:</span>  <span class="c1"># Suspiciously short for a secret</span>
                    <span class="n">issues</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;weak_secret&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;severity&#39;</span><span class="p">:</span> <span class="s1">&#39;high&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Environment variable </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s1"> appears to contain a weak secret&#39;</span>
                    <span class="p">})</span>

        <span class="c1"># Check file permissions on sensitive files</span>
        <span class="n">sensitive_files</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;.env&#39;</span><span class="p">,</span> <span class="s1">&#39;config.py&#39;</span><span class="p">,</span> <span class="s1">&#39;secrets.json&#39;</span><span class="p">]</span>
        <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">sensitive_files</span><span class="p">:</span>
            <span class="n">filepath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">filepath</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="n">stat</span> <span class="o">=</span> <span class="n">filepath</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span>
                <span class="c1"># Check if file is readable by others (Unix-like systems)</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">stat</span><span class="p">,</span> <span class="s1">&#39;st_mode&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">stat</span><span class="o">.</span><span class="n">st_mode</span> <span class="o">&amp;</span> <span class="mo">0o044</span><span class="p">):</span>
                    <span class="n">issues</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;file_permissions&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;severity&#39;</span><span class="p">:</span> <span class="s1">&#39;medium&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Sensitive file </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1"> is readable by others&#39;</span>
                    <span class="p">})</span>

        <span class="k">return</span> <span class="n">issues</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">secure_config_loader</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config_file</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Securely load configuration from file&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">config_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">config_file</span><span class="p">)</span>

            <span class="c1"># Verify file permissions</span>
            <span class="k">if</span> <span class="n">config_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
                <span class="n">stat</span> <span class="o">=</span> <span class="n">config_path</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">stat</span><span class="p">,</span> <span class="s1">&#39;st_mode&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">stat</span><span class="o">.</span><span class="n">st_mode</span> <span class="o">&amp;</span> <span class="mo">0o044</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">PermissionError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Config file </span><span class="si">{</span><span class="n">config_file</span><span class="si">}</span><span class="s2"> has insecure permissions&quot;</span><span class="p">)</span>

            <span class="c1"># Load and validate configuration</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">config_path</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">config</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>

            <span class="c1"># Validate configuration structure</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validate_config_structure</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">config</span>

        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to load secure configuration: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">validate_config_structure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate configuration structure and values&quot;&quot;&quot;</span>
        <span class="c1"># Check for required security settings</span>
        <span class="n">security_settings</span> <span class="o">=</span> <span class="n">config</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;security&#39;</span><span class="p">,</span> <span class="p">{})</span>

        <span class="n">required_security_keys</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;session_timeout&#39;</span><span class="p">,</span>
            <span class="s1">&#39;max_login_attempts&#39;</span><span class="p">,</span>
            <span class="s1">&#39;password_policy&#39;</span>
        <span class="p">]</span>

        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">required_security_keys</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">security_settings</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Missing required security setting: </span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Validate password policy</span>
        <span class="n">password_policy</span> <span class="o">=</span> <span class="n">security_settings</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;password_policy&#39;</span><span class="p">,</span> <span class="p">{})</span>
        <span class="k">if</span> <span class="n">password_policy</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;min_length&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">12</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Password minimum length should be at least 12 characters&quot;</span><span class="p">)</span>
</code></pre>
</div>
<h2 id="race-conditions-and-concurrency-issues">Race Conditions and Concurrency Issues<a class="headerlink" href="#race-conditions-and-concurrency-issues" title="Permanent link">&para;</a></h2>
<h3 id="understanding-race-conditions">Understanding Race Conditions<a class="headerlink" href="#understanding-race-conditions" title="Permanent link">&para;</a></h3>
<p><strong>Race conditions</strong> occur when the behavior of software depends on the relative timing of events, such as the order in which threads execute. In web applications, this can lead to data corruption, privilege escalation, or business logic bypasses.</p>
<div class="highlight python-template" data-fence-type="template" data-language="python">
<pre><code class="language-python"><span class="kn">import</span><span class="w"> </span><span class="nn">threading</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">collections</span><span class="w"> </span><span class="kn">import</span> <span class="n">defaultdict</span>

<span class="k">class</span><span class="w"> </span><span class="nc">VulnerableWallet</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Example of race condition vulnerability&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">balances</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transactions</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">deposit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Vulnerable deposit method&quot;&quot;&quot;</span>
        <span class="c1"># Race condition: non-atomic read-modify-write</span>
        <span class="n">current_balance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">balances</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)</span>  <span class="c1"># Simulate processing delay</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">balances</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_balance</span> <span class="o">+</span> <span class="n">amount</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">transactions</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;deposit&#39;</span><span class="p">,</span>
            <span class="s1">&#39;user_id&#39;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
            <span class="s1">&#39;amount&#39;</span><span class="p">:</span> <span class="n">amount</span><span class="p">,</span>
            <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="p">})</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">withdraw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Vulnerable withdrawal method&quot;&quot;&quot;</span>
        <span class="c1"># Race condition: check-then-use vulnerability</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">balances</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">amount</span><span class="p">:</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.001</span><span class="p">)</span>  <span class="c1"># Simulate processing delay</span>
            <span class="n">current_balance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">balances</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">balances</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_balance</span> <span class="o">-</span> <span class="n">amount</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">transactions</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;withdraw&#39;</span><span class="p">,</span>
                <span class="s1">&#39;user_id&#39;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
                <span class="s1">&#39;amount&#39;</span><span class="p">:</span> <span class="n">amount</span><span class="p">,</span>
                <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="p">})</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

<span class="k">class</span><span class="w"> </span><span class="nc">SecureWallet</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Secure implementation with proper concurrency control&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">balances</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">transactions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">locks</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">threading</span><span class="o">.</span><span class="n">RLock</span><span class="p">)</span>  <span class="c1"># Per-user locks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">global_lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">RLock</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">deposit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Thread-safe deposit method&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">amount</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Deposit amount must be positive&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">locks</span><span class="p">[</span><span class="n">user_id</span><span class="p">]:</span>
            <span class="c1"># Atomic operation within lock</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">balances</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span> <span class="o">+=</span> <span class="n">amount</span>

            <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_lock</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">transactions</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()),</span>
                    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;deposit&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;user_id&#39;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
                    <span class="s1">&#39;amount&#39;</span><span class="p">:</span> <span class="n">amount</span><span class="p">,</span>
                    <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span>
                    <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;completed&#39;</span>
                <span class="p">})</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">withdraw</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Thread-safe withdrawal method&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">amount</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Withdrawal amount must be positive&quot;</span><span class="p">)</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">locks</span><span class="p">[</span><span class="n">user_id</span><span class="p">]:</span>
            <span class="c1"># Atomic check and update</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">balances</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">amount</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">balances</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span> <span class="o">-=</span> <span class="n">amount</span>

                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_lock</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">transactions</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()),</span>
                        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;withdraw&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;user_id&#39;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
                        <span class="s1">&#39;amount&#39;</span><span class="p">:</span> <span class="n">amount</span><span class="p">,</span>
                        <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span>
                        <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;completed&#39;</span>
                    <span class="p">})</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_lock</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">transactions</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()),</span>
                        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;withdraw_failed&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;user_id&#39;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
                        <span class="s1">&#39;amount&#39;</span><span class="p">:</span> <span class="n">amount</span><span class="p">,</span>
                        <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span>
                        <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;insufficient_funds&#39;</span>
                    <span class="p">})</span>
                <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">transfer</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">from_user_id</span><span class="p">,</span> <span class="n">to_user_id</span><span class="p">,</span> <span class="n">amount</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Thread-safe transfer between users&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">amount</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Transfer amount must be positive&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">from_user_id</span> <span class="o">==</span> <span class="n">to_user_id</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Cannot transfer to same user&quot;</span><span class="p">)</span>

        <span class="c1"># Always acquire locks in consistent order to prevent deadlock</span>
        <span class="n">user_ids</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">from_user_id</span><span class="p">,</span> <span class="n">to_user_id</span><span class="p">])</span>

        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">locks</span><span class="p">[</span><span class="n">user_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="bp">self</span><span class="o">.</span><span class="n">locks</span><span class="p">[</span><span class="n">user_ids</span><span class="p">[</span><span class="mi">1</span><span class="p">]]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">balances</span><span class="p">[</span><span class="n">from_user_id</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">amount</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">balances</span><span class="p">[</span><span class="n">from_user_id</span><span class="p">]</span> <span class="o">-=</span> <span class="n">amount</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">balances</span><span class="p">[</span><span class="n">to_user_id</span><span class="p">]</span> <span class="o">+=</span> <span class="n">amount</span>

                <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_lock</span><span class="p">:</span>
                    <span class="n">transaction_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>

                    <span class="c1"># Record as single atomic transaction</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">transactions</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s1">&#39;id&#39;</span><span class="p">:</span> <span class="n">transaction_id</span><span class="p">,</span>
                        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;transfer&#39;</span><span class="p">,</span>
                        <span class="s1">&#39;from_user_id&#39;</span><span class="p">:</span> <span class="n">from_user_id</span><span class="p">,</span>
                        <span class="s1">&#39;to_user_id&#39;</span><span class="p">:</span> <span class="n">to_user_id</span><span class="p">,</span>
                        <span class="s1">&#39;amount&#39;</span><span class="p">:</span> <span class="n">amount</span><span class="p">,</span>
                        <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">(),</span>
                        <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;completed&#39;</span>
                    <span class="p">})</span>

                <span class="k">return</span> <span class="n">transaction_id</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Insufficient funds for transfer&quot;</span><span class="p">)</span>

<span class="c1"># Demonstration of race condition</span>
<span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_race_condition</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Demonstrate race condition vulnerability&quot;&quot;&quot;</span>
    <span class="n">vulnerable_wallet</span> <span class="o">=</span> <span class="n">VulnerableWallet</span><span class="p">()</span>
    <span class="n">secure_wallet</span> <span class="o">=</span> <span class="n">SecureWallet</span><span class="p">()</span>

    <span class="c1"># Add initial balance</span>
    <span class="n">vulnerable_wallet</span><span class="o">.</span><span class="n">balances</span><span class="p">[</span><span class="s1">&#39;user1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">secure_wallet</span><span class="o">.</span><span class="n">balances</span><span class="p">[</span><span class="s1">&#39;user1&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">100</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">attempt_concurrent_withdrawals</span><span class="p">(</span><span class="n">wallet</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">amount</span><span class="p">,</span> <span class="n">attempts</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Attempt multiple concurrent withdrawals&quot;&quot;&quot;</span>
        <span class="n">threads</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">withdraw_worker</span><span class="p">():</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">wallet</span><span class="o">.</span><span class="n">withdraw</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">amount</span><span class="p">)</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

        <span class="c1"># Start multiple threads simultaneously</span>
        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">attempts</span><span class="p">):</span>
            <span class="n">thread</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">withdraw_worker</span><span class="p">)</span>
            <span class="n">threads</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thread</span><span class="p">)</span>
            <span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

        <span class="c1"># Wait for all threads to complete</span>
        <span class="k">for</span> <span class="n">thread</span> <span class="ow">in</span> <span class="n">threads</span><span class="p">:</span>
            <span class="n">thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">results</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Testing vulnerable wallet...&quot;</span><span class="p">)</span>
    <span class="n">vulnerable_results</span> <span class="o">=</span> <span class="n">attempt_concurrent_withdrawals</span><span class="p">(</span><span class="n">vulnerable_wallet</span><span class="p">,</span> <span class="s1">&#39;user1&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Vulnerable wallet successful withdrawals: </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">vulnerable_results</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Vulnerable wallet final balance: </span><span class="si">{</span><span class="n">vulnerable_wallet</span><span class="o">.</span><span class="n">balances</span><span class="p">[</span><span class="s1">&#39;user1&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Testing secure wallet...&quot;</span><span class="p">)</span>
    <span class="n">secure_results</span> <span class="o">=</span> <span class="n">attempt_concurrent_withdrawals</span><span class="p">(</span><span class="n">secure_wallet</span><span class="p">,</span> <span class="s1">&#39;user1&#39;</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Secure wallet successful withdrawals: </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">secure_results</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Secure wallet final balance: </span><span class="si">{</span><span class="n">secure_wallet</span><span class="o">.</span><span class="n">balances</span><span class="p">[</span><span class="s1">&#39;user1&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">demonstrate_race_condition</span><span class="p">()</span>
</code></pre>
</div>
<h3 id="database-level-race-condition-prevention">Database-Level Race Condition Prevention<a class="headerlink" href="#database-level-race-condition-prevention" title="Permanent link">&para;</a></h3>
<div class="highlight python-template" data-fence-type="template" data-language="python">
<pre><code class="language-python"><span class="kn">import</span><span class="w"> </span><span class="nn">sqlite3</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">threading</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">contextlib</span><span class="w"> </span><span class="kn">import</span> <span class="n">contextmanager</span>

<span class="k">class</span><span class="w"> </span><span class="nc">DatabaseTransactionManager</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Manages database transactions to prevent race conditions&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">db_path</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">db_path</span> <span class="o">=</span> <span class="n">db_path</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">local</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">local</span><span class="p">()</span>

    <span class="nd">@contextmanager</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">get_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get database connection with proper isolation&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">local</span><span class="p">,</span> <span class="s1">&#39;connection&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">local</span><span class="o">.</span><span class="n">connection</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">db_path</span><span class="p">,</span>
                <span class="n">isolation_level</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>  <span class="c1"># Manual transaction control</span>
                <span class="n">check_same_thread</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">local</span><span class="o">.</span><span class="n">connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;PRAGMA foreign_keys = ON&#39;</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">yield</span> <span class="bp">self</span><span class="o">.</span><span class="n">local</span><span class="o">.</span><span class="n">connection</span>
        <span class="k">finally</span><span class="p">:</span>
            <span class="c1"># Connection cleanup handled by thread-local storage</span>
            <span class="k">pass</span>

    <span class="nd">@contextmanager</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">transaction</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Database transaction context manager&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_connection</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;BEGIN IMMEDIATE&#39;</span><span class="p">)</span>  <span class="c1"># Exclusive lock</span>
                <span class="k">yield</span> <span class="n">conn</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;COMMIT&#39;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;ROLLBACK&#39;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">e</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">secure_balance_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">amount_change</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Update balance with proper locking&quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="bp">self</span><span class="o">.</span><span class="n">transaction</span><span class="p">()</span> <span class="k">as</span> <span class="n">conn</span><span class="p">:</span>
            <span class="c1"># Use SELECT FOR UPDATE equivalent (IMMEDIATE transaction)</span>
            <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="s1">&#39;SELECT balance FROM users WHERE id = ?&#39;</span><span class="p">,</span>
                <span class="p">(</span><span class="n">user_id</span><span class="p">,)</span>
            <span class="p">)</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">row</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;User not found&quot;</span><span class="p">)</span>

            <span class="n">current_balance</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">new_balance</span> <span class="o">=</span> <span class="n">current_balance</span> <span class="o">+</span> <span class="n">amount_change</span>

            <span class="k">if</span> <span class="n">new_balance</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Insufficient funds&quot;</span><span class="p">)</span>

            <span class="c1"># Update with WHERE clause to ensure row hasn&#39;t changed</span>
            <span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span>
                <span class="s1">&#39;UPDATE users SET balance = ? WHERE id = ? AND balance = ?&#39;</span><span class="p">,</span>
                <span class="p">(</span><span class="n">new_balance</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">current_balance</span><span class="p">)</span>
            <span class="p">)</span>

            <span class="k">if</span> <span class="n">cursor</span><span class="o">.</span><span class="n">rowcount</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;Balance update failed - concurrent modification detected&quot;</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">new_balance</span>
</code></pre>
</div>
<h2 id="side-channel-attacks">Side-Channel Attacks<a class="headerlink" href="#side-channel-attacks" title="Permanent link">&para;</a></h2>
<h3 id="understanding-side-channel-attacks">Understanding Side-Channel Attacks<a class="headerlink" href="#understanding-side-channel-attacks" title="Permanent link">&para;</a></h3>
<p><strong>Side-channel attacks</strong> exploit information leaked through implementation details rather than vulnerabilities in the algorithm itself. Common side-channels include timing, power consumption, and electromagnetic radiation.</p>
<div class="highlight python-template" data-fence-type="template" data-language="python">
<pre><code class="language-python"><span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">hmac</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">hashlib</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">secrets</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span>

<span class="k">class</span><span class="w"> </span><span class="nc">VulnerableComparison</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Example of timing attack vulnerability&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">valid_tokens</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;user1&#39;</span><span class="p">:</span> <span class="s1">&#39;secret_token_123&#39;</span><span class="p">,</span>
            <span class="s1">&#39;user2&#39;</span><span class="p">:</span> <span class="s1">&#39;another_secret_456&#39;</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">vulnerable_token_check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">provided_token</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Vulnerable to timing attacks&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">username</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid_tokens</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">valid_token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid_tokens</span><span class="p">[</span><span class="n">username</span><span class="p">]</span>

        <span class="c1"># Vulnerable: early return on first character mismatch</span>
        <span class="c1"># Attacker can measure response time to guess characters</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">provided_token</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">valid_token</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">valid_token</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">provided_token</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">valid_token</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="k">return</span> <span class="kc">False</span>  <span class="c1"># Early return leaks timing information</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">vulnerable_login</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Vulnerable login with timing side-channel&quot;&quot;&quot;</span>
        <span class="c1"># User enumeration via timing</span>
        <span class="k">if</span> <span class="n">username</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">valid_tokens</span><span class="p">:</span>
            <span class="c1"># Fast path: no password hashing for invalid users</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Slow path: password hashing for valid users</span>
        <span class="c1"># This timing difference allows username enumeration</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>  <span class="c1"># Simulate password hashing</span>
        <span class="k">return</span> <span class="n">password</span> <span class="o">==</span> <span class="s2">&quot;correct_password&quot;</span>

<span class="k">class</span><span class="w"> </span><span class="nc">SecureComparison</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Secure implementation resistant to timing attacks&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Store hashed tokens instead of plaintext</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_token_hashes</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;user1&#39;</span><span class="p">:</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;secret_token_123&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">(),</span>
            <span class="s1">&#39;user2&#39;</span><span class="p">:</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;another_secret_456&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">dummy_user_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;password_hash&#39;</span><span class="p">:</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;dummy_password&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">secure_token_check</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">provided_token</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Timing-safe token verification&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">username</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_token_hashes</span><span class="p">:</span>
            <span class="c1"># Use dummy comparison to maintain constant time</span>
            <span class="n">dummy_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;dummy_token&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
            <span class="n">hmac</span><span class="o">.</span><span class="n">compare_digest</span><span class="p">(</span><span class="n">dummy_hash</span><span class="p">,</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">provided_token</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">())</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="c1"># Always perform hash comparison in constant time</span>
        <span class="n">provided_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">provided_token</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>
        <span class="n">valid_hash</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_token_hashes</span><span class="p">[</span><span class="n">username</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">hmac</span><span class="o">.</span><span class="n">compare_digest</span><span class="p">(</span><span class="n">valid_hash</span><span class="p">,</span> <span class="n">provided_hash</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">secure_login</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Constant-time login to prevent user enumeration&quot;&quot;&quot;</span>
        <span class="c1"># Always perform the same operations regardless of user existence</span>
        <span class="k">if</span> <span class="n">username</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_token_hashes</span><span class="p">:</span>
            <span class="n">user_data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;password_hash&#39;</span><span class="p">:</span> <span class="s1">&#39;actual_hash&#39;</span><span class="p">}</span>  <span class="c1"># From database</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">user_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dummy_user_data</span>  <span class="c1"># Dummy data for timing consistency</span>

        <span class="c1"># Always perform password hashing (constant time)</span>
        <span class="n">password_hash</span> <span class="o">=</span> <span class="n">hashlib</span><span class="o">.</span><span class="n">sha256</span><span class="p">(</span><span class="n">password</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span><span class="o">.</span><span class="n">hexdigest</span><span class="p">()</span>

        <span class="c1"># Constant-time comparison</span>
        <span class="n">is_valid</span> <span class="o">=</span> <span class="n">hmac</span><span class="o">.</span><span class="n">compare_digest</span><span class="p">(</span><span class="n">user_data</span><span class="p">[</span><span class="s1">&#39;password_hash&#39;</span><span class="p">],</span> <span class="n">password_hash</span><span class="p">)</span>

        <span class="c1"># Only return True if user exists AND password matches</span>
        <span class="k">return</span> <span class="n">username</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_token_hashes</span> <span class="ow">and</span> <span class="n">is_valid</span>

<span class="k">class</span><span class="w"> </span><span class="nc">TimingAttackDetector</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Detect potential timing attack attempts&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">request_times</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">suspicious_patterns</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">record_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_ip</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">,</span> <span class="n">duration</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Record request timing information&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">client_ip</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_times</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">request_times</span><span class="p">[</span><span class="n">client_ip</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">request_times</span><span class="p">[</span><span class="n">client_ip</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;endpoint&#39;</span><span class="p">:</span> <span class="n">endpoint</span><span class="p">,</span>
            <span class="s1">&#39;duration&#39;</span><span class="p">:</span> <span class="n">duration</span><span class="p">,</span>
            <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="p">})</span>

        <span class="c1"># Analyze for suspicious patterns</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">analyze_timing_patterns</span><span class="p">(</span><span class="n">client_ip</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">analyze_timing_patterns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_ip</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Analyze request patterns for timing attacks&quot;&quot;&quot;</span>
        <span class="n">requests</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">request_times</span><span class="p">[</span><span class="n">client_ip</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">requests</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>  <span class="c1"># Need sufficient data</span>
            <span class="k">return</span>

        <span class="c1"># Check for rapid sequential requests to same endpoint</span>
        <span class="n">recent_requests</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">requests</span> <span class="k">if</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">60</span><span class="p">]</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">recent_requests</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">:</span>  <span class="c1"># Many requests in short time</span>
            <span class="n">endpoint_counts</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">req</span> <span class="ow">in</span> <span class="n">recent_requests</span><span class="p">:</span>
                <span class="n">endpoint</span> <span class="o">=</span> <span class="n">req</span><span class="p">[</span><span class="s1">&#39;endpoint&#39;</span><span class="p">]</span>
                <span class="n">endpoint_counts</span><span class="p">[</span><span class="n">endpoint</span><span class="p">]</span> <span class="o">=</span> <span class="n">endpoint_counts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>

            <span class="c1"># Check if focusing on authentication endpoints</span>
            <span class="n">auth_endpoints</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;/login&#39;</span><span class="p">,</span> <span class="s1">&#39;/verify_token&#39;</span><span class="p">,</span> <span class="s1">&#39;/reset_password&#39;</span><span class="p">]</span>
            <span class="n">auth_requests</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">endpoint_counts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">ep</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="k">for</span> <span class="n">ep</span> <span class="ow">in</span> <span class="n">auth_endpoints</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">auth_requests</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">:</span>  <span class="c1"># Suspicious authentication activity</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">suspicious_patterns</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;client_ip&#39;</span><span class="p">:</span> <span class="n">client_ip</span><span class="p">,</span>
                    <span class="s1">&#39;pattern&#39;</span><span class="p">:</span> <span class="s1">&#39;potential_timing_attack&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;auth_requests&#39;</span><span class="p">:</span> <span class="n">auth_requests</span><span class="p">,</span>
                    <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
                <span class="p">})</span>

<span class="c1"># Secure implementation with monitoring</span>
<span class="k">class</span><span class="w"> </span><span class="nc">SecureAuthenticationService</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Complete secure authentication service&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">secure_comparison</span> <span class="o">=</span> <span class="n">SecureComparison</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timing_detector</span> <span class="o">=</span> <span class="n">TimingAttackDetector</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rate_limiter</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Simple rate limiting</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">authenticate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">username</span><span class="p">,</span> <span class="n">token</span><span class="p">,</span> <span class="n">client_ip</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Secure authentication with monitoring&quot;&quot;&quot;</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Rate limiting</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_rate_limited</span><span class="p">(</span><span class="n">client_ip</span><span class="p">):</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>  <span class="c1"># Constant delay</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="c1"># Perform authentication</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">secure_comparison</span><span class="o">.</span><span class="n">secure_token_check</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">token</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">result</span>

        <span class="k">finally</span><span class="p">:</span>
            <span class="c1"># Record timing information</span>
            <span class="n">duration</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timing_detector</span><span class="o">.</span><span class="n">record_request</span><span class="p">(</span><span class="n">client_ip</span><span class="p">,</span> <span class="s1">&#39;/authenticate&#39;</span><span class="p">,</span> <span class="n">duration</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_rate_limited</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_ip</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Simple rate limiting implementation&quot;&quot;&quot;</span>
        <span class="n">current_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">client_ip</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rate_limiter</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rate_limiter</span><span class="p">[</span><span class="n">client_ip</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Clean old requests</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rate_limiter</span><span class="p">[</span><span class="n">client_ip</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">req_time</span> <span class="k">for</span> <span class="n">req_time</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rate_limiter</span><span class="p">[</span><span class="n">client_ip</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">current_time</span> <span class="o">-</span> <span class="n">req_time</span> <span class="o">&lt;</span> <span class="mi">60</span>  <span class="c1"># Last minute</span>
        <span class="p">]</span>

        <span class="c1"># Check limit</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">rate_limiter</span><span class="p">[</span><span class="n">client_ip</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">10</span><span class="p">:</span>  <span class="c1"># 10 requests per minute</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">rate_limiter</span><span class="p">[</span><span class="n">client_ip</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">current_time</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">False</span>

<span class="c1"># Example usage and demonstration</span>
<span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_timing_attack</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Demonstrate timing attack vulnerability and mitigation&quot;&quot;&quot;</span>
    <span class="n">vulnerable</span> <span class="o">=</span> <span class="n">VulnerableComparison</span><span class="p">()</span>
    <span class="n">secure</span> <span class="o">=</span> <span class="n">SecureComparison</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Demonstrating timing attack vulnerability...&quot;</span><span class="p">)</span>

    <span class="c1"># Measure timing for correct vs incorrect tokens</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">measure_timing</span><span class="p">(</span><span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="n">end</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">result</span><span class="p">,</span> <span class="n">end</span> <span class="o">-</span> <span class="n">start</span>

    <span class="c1"># Test with vulnerable implementation</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Vulnerable implementation:&quot;</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">time1</span> <span class="o">=</span> <span class="n">measure_timing</span><span class="p">(</span><span class="n">vulnerable</span><span class="o">.</span><span class="n">vulnerable_token_check</span><span class="p">,</span> <span class="s1">&#39;user1&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">time2</span> <span class="o">=</span> <span class="n">measure_timing</span><span class="p">(</span><span class="n">vulnerable</span><span class="o">.</span><span class="n">vulnerable_token_check</span><span class="p">,</span> <span class="s1">&#39;user1&#39;</span><span class="p">,</span> <span class="s1">&#39;secret_token_123&#39;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Wrong token timing: </span><span class="si">{</span><span class="n">time1</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Correct token timing: </span><span class="si">{</span><span class="n">time2</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Timing difference: </span><span class="si">{</span><span class="nb">abs</span><span class="p">(</span><span class="n">time2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">time1</span><span class="p">)</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>

    <span class="c1"># Test with secure implementation</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Secure implementation:&quot;</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">time3</span> <span class="o">=</span> <span class="n">measure_timing</span><span class="p">(</span><span class="n">secure</span><span class="o">.</span><span class="n">secure_token_check</span><span class="p">,</span> <span class="s1">&#39;user1&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">time4</span> <span class="o">=</span> <span class="n">measure_timing</span><span class="p">(</span><span class="n">secure</span><span class="o">.</span><span class="n">secure_token_check</span><span class="p">,</span> <span class="s1">&#39;user1&#39;</span><span class="p">,</span> <span class="s1">&#39;secret_token_123&#39;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Wrong token timing: </span><span class="si">{</span><span class="n">time3</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Correct token timing: </span><span class="si">{</span><span class="n">time4</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Timing difference: </span><span class="si">{</span><span class="nb">abs</span><span class="p">(</span><span class="n">time4</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">time3</span><span class="p">)</span><span class="si">:</span><span class="s2">.6f</span><span class="si">}</span><span class="s2">s&quot;</span><span class="p">)</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">demonstrate_timing_attack</span><span class="p">()</span>
</code></pre>
</div>
<h2 id="comprehensive-web-security-implementation">Comprehensive Web Security Implementation<a class="headerlink" href="#comprehensive-web-security-implementation" title="Permanent link">&para;</a></h2>
<p>Let&rsquo;s create a complete secure web application that addresses all the vulnerabilities discussed:</p>
<div class="highlight python-template" data-fence-type="template" data-language="python">
<pre><code class="language-python"><span class="kn">from</span><span class="w"> </span><span class="nn">flask</span><span class="w"> </span><span class="kn">import</span> <span class="n">Flask</span><span class="p">,</span> <span class="n">request</span><span class="p">,</span> <span class="n">session</span><span class="p">,</span> <span class="n">jsonify</span><span class="p">,</span> <span class="n">render_template_string</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">flask_talisman</span><span class="w"> </span><span class="kn">import</span> <span class="n">Talisman</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">secrets</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">threading</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">wraps</span>

<span class="k">class</span><span class="w"> </span><span class="nc">SecureWebApplication</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Complete secure web application implementation&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup_security</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setup_routes</span><span class="p">()</span>

        <span class="c1"># Security components</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">csrf_protection</span> <span class="o">=</span> <span class="n">CSRFProtection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">authenticator</span> <span class="o">=</span> <span class="n">SecureAuthenticator</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config_manager</span> <span class="o">=</span> <span class="n">SecurityConfigurationManager</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">wallet</span> <span class="o">=</span> <span class="n">SecureWallet</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timing_detector</span> <span class="o">=</span> <span class="n">TimingAttackDetector</span><span class="p">()</span>

        <span class="c1"># Apply security configuration</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">config_manager</span><span class="o">.</span><span class="n">configure_secure_flask_app</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">setup_security</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Configure application security&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
            <span class="s1">&#39;SECRET_KEY&#39;</span><span class="p">:</span> <span class="n">secrets</span><span class="o">.</span><span class="n">token_hex</span><span class="p">(</span><span class="mi">32</span><span class="p">),</span>
            <span class="s1">&#39;SESSION_TIMEOUT&#39;</span><span class="p">:</span> <span class="mi">1800</span><span class="p">,</span>  <span class="c1"># 30 minutes</span>
            <span class="s1">&#39;MAX_CONTENT_LENGTH&#39;</span><span class="p">:</span> <span class="mi">16</span> <span class="o">*</span> <span class="mi">1024</span> <span class="o">*</span> <span class="mi">1024</span><span class="p">,</span>  <span class="c1"># 16MB</span>
        <span class="p">})</span>

        <span class="c1"># Security headers</span>
        <span class="n">Talisman</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="p">,</span> <span class="n">force_https</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>  <span class="c1"># Set to True in production</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">require_auth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">f</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Authentication decorator&quot;&quot;&quot;</span>
        <span class="nd">@wraps</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">decorated</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="n">session_id</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;session_id&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">session_id</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Authentication required&#39;</span><span class="p">}),</span> <span class="mi">401</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">username</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">authenticator</span><span class="o">.</span><span class="n">validate_session</span><span class="p">(</span>
                    <span class="n">session_id</span><span class="p">,</span> 
                    <span class="n">request</span><span class="o">.</span><span class="n">remote_addr</span><span class="p">,</span>
                    <span class="n">request</span><span class="o">.</span><span class="n">user_agent</span><span class="o">.</span><span class="n">string</span>
                <span class="p">)</span>
                <span class="n">request</span><span class="o">.</span><span class="n">current_user</span> <span class="o">=</span> <span class="n">username</span>
                <span class="k">return</span> <span class="n">f</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Invalid session&#39;</span><span class="p">}),</span> <span class="mi">401</span>
        <span class="k">return</span> <span class="n">decorated</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">setup_routes</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Setup secure application routes&quot;&quot;&quot;</span>

        <span class="nd">@self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/register&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">register</span><span class="p">():</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span> <span class="ow">or</span> <span class="s1">&#39;username&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span> <span class="ow">or</span> <span class="s1">&#39;password&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Username and password required&#39;</span><span class="p">}),</span> <span class="mi">400</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">authenticator</span><span class="o">.</span><span class="n">register_user</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">])</span>
                <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;success&#39;</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;User registered&#39;</span><span class="p">})</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}),</span> <span class="mi">400</span>

            <span class="k">finally</span><span class="p">:</span>
                <span class="n">duration</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">timing_detector</span><span class="o">.</span><span class="n">record_request</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">remote_addr</span><span class="p">,</span> <span class="s1">&#39;/register&#39;</span><span class="p">,</span> <span class="n">duration</span><span class="p">)</span>

        <span class="nd">@self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/login&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">login</span><span class="p">():</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">data</span> <span class="ow">or</span> <span class="s1">&#39;username&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span> <span class="ow">or</span> <span class="s1">&#39;password&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Username and password required&#39;</span><span class="p">}),</span> <span class="mi">400</span>

                <span class="n">session_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">authenticator</span><span class="o">.</span><span class="n">login</span><span class="p">(</span>
                    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">],</span>
                    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">],</span>
                    <span class="n">request</span><span class="o">.</span><span class="n">remote_addr</span>
                <span class="p">)</span>

                <span class="n">session</span><span class="p">[</span><span class="s1">&#39;session_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">session_id</span>
                <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;success&#39;</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;Login successful&#39;</span><span class="p">})</span>

            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}),</span> <span class="mi">401</span>

            <span class="k">finally</span><span class="p">:</span>
                <span class="n">duration</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_time</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">timing_detector</span><span class="o">.</span><span class="n">record_request</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">remote_addr</span><span class="p">,</span> <span class="s1">&#39;/login&#39;</span><span class="p">,</span> <span class="n">duration</span><span class="p">)</span>

        <span class="nd">@self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/logout&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
        <span class="nd">@self</span><span class="o">.</span><span class="n">require_auth</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">logout</span><span class="p">():</span>
            <span class="n">session_id</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;session_id&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">session_id</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">authenticator</span><span class="o">.</span><span class="n">invalidate_session</span><span class="p">(</span><span class="n">session_id</span><span class="p">)</span>
            <span class="n">session</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;success&#39;</span><span class="p">,</span> <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;Logged out&#39;</span><span class="p">})</span>

        <span class="nd">@self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/profile&#39;</span><span class="p">)</span>
        <span class="nd">@self</span><span class="o">.</span><span class="n">require_auth</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">profile</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
                <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="n">request</span><span class="o">.</span><span class="n">current_user</span><span class="p">,</span>
                <span class="s1">&#39;balance&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">wallet</span><span class="o">.</span><span class="n">balances</span><span class="p">[</span><span class="n">request</span><span class="o">.</span><span class="n">current_user</span><span class="p">]</span>
            <span class="p">})</span>

        <span class="nd">@self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/transfer&#39;</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;POST&#39;</span><span class="p">])</span>
        <span class="nd">@self</span><span class="o">.</span><span class="n">require_auth</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">transfer</span><span class="p">():</span>
            <span class="c1"># CSRF protection automatically applied</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span>
                <span class="n">transaction_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wallet</span><span class="o">.</span><span class="n">transfer</span><span class="p">(</span>
                    <span class="n">request</span><span class="o">.</span><span class="n">current_user</span><span class="p">,</span>
                    <span class="n">data</span><span class="p">[</span><span class="s1">&#39;to_user&#39;</span><span class="p">],</span>
                    <span class="nb">float</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;amount&#39;</span><span class="p">])</span>
                <span class="p">)</span>
                <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
                    <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;success&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;transaction_id&#39;</span><span class="p">:</span> <span class="n">transaction_id</span>
                <span class="p">})</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}),</span> <span class="mi">400</span>

        <span class="nd">@self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="s1">&#39;/security_audit&#39;</span><span class="p">)</span>
        <span class="nd">@self</span><span class="o">.</span><span class="n">require_auth</span>  
        <span class="k">def</span><span class="w"> </span><span class="nf">security_audit</span><span class="p">():</span>
            <span class="c1"># Only allow admin users</span>
            <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">current_user</span> <span class="o">!=</span> <span class="s1">&#39;admin&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Admin access required&#39;</span><span class="p">}),</span> <span class="mi">403</span>

            <span class="n">issues</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">config_manager</span><span class="o">.</span><span class="n">check_configuration_security</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="p">)</span>
            <span class="n">suspicious_patterns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timing_detector</span><span class="o">.</span><span class="n">suspicious_patterns</span>

            <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span>
                <span class="s1">&#39;configuration_issues&#39;</span><span class="p">:</span> <span class="n">issues</span><span class="p">,</span>
                <span class="s1">&#39;suspicious_patterns&#39;</span><span class="p">:</span> <span class="n">suspicious_patterns</span>
            <span class="p">})</span>

<span class="c1"># Example usage</span>
<span class="k">def</span><span class="w"> </span><span class="nf">create_app</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create and configure secure web application&quot;&quot;&quot;</span>
    <span class="n">secure_app</span> <span class="o">=</span> <span class="n">SecureWebApplication</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">secure_app</span><span class="o">.</span><span class="n">app</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">app</span> <span class="o">=</span> <span class="n">create_app</span><span class="p">()</span>
    <span class="n">app</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s1">&#39;127.0.0.1&#39;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">5000</span><span class="p">)</span>
</code></pre>
</div>
<h2 id="key-takeaways">Key Takeaways<a class="headerlink" href="#key-takeaways" title="Permanent link">&para;</a></h2>
<h3 id="web-application-security-principles">Web Application Security Principles<a class="headerlink" href="#web-application-security-principles" title="Permanent link">&para;</a></h3>
<ol>
<li>
<p><strong>CSRF Protection</strong>: Always validate state-changing requests with tokens</p>
</li>
<li>
<p><strong>Authentication Security</strong>: Use strong passwords, rate limiting, and secure sessions</p>
</li>
<li>
<p><strong>Configuration Management</strong>: Secure defaults, environment separation, regular audits</p>
</li>
<li>
<p><strong>Concurrency Safety</strong>: Proper locking, atomic operations, transaction management</p>
</li>
<li>
<p><strong>Side-Channel Resistance</strong>: Constant-time operations, timing attack detection</p>
</li>
</ol>
<h3 id="best-practices-summary">Best Practices Summary<a class="headerlink" href="#best-practices-summary" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p><strong>Defense in Depth</strong>: Layer multiple security controls</p>
</li>
<li>
<p><strong>Secure by Default</strong>: Start with secure configurations</p>
</li>
<li>
<p><strong>Constant-Time Operations</strong>: Prevent timing-based information leakage</p>
</li>
<li>
<p><strong>Proper Error Handling</strong>: Don&rsquo;t leak sensitive information</p>
</li>
<li>
<p><strong>Regular Security Audits</strong>: Continuously assess and improve security posture</p>
</li>
</ul>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="October 16, 2025 05:58:30 UTC">October 16, 2025</span>
  </span>

    
    
    
    
  </aside>


  



  <form class="md-feedback" name="feedback" hidden>
    <fieldset>
      <legend class="md-feedback__title">
        Was this page helpful?
      </legend>
      <div class="md-feedback__inner">
        <div class="md-feedback__list">
          
            <button class="md-feedback__icon md-icon" type="submit" title="This page was helpful" data-md-value="1">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81"/></svg>
            </button>
          
            <button class="md-feedback__icon md-icon" type="submit" title="This page could be improved" data-md-value="0">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14"/></svg>
            </button>
          
        </div>
        <div class="md-feedback__note">
          
            <div data-md-value="1" hidden>
              
              
                
              
              
              
                
                
              
              Thanks for your feedback!
            </div>
          
            <div data-md-value="0" hidden>
              
              
                
              
              
              
                
                
              
              Thanks for your feedback! Help us improve this page by creating an <a href="https://github.com/Eatham532/Software-Engineering-HSC-Textbook/issues/new/choose" target="_blank" rel="noopener">issue</a> on github.
            </div>
          
        </div>
      </div>
    </fieldset>
  </form>


                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        

<!-- Footer -->
<footer class="md-footer">
  
    <!-- Custom footer with left/right layout -->
    <div class="md-footer__inner md-grid">
      <!-- Left side: Copyright and cookie settings -->
      <div class="md-footer__left">
        <div class="md-footer__copyright">
          
            Copyright &copy; 2025 Eatham532 – <a href="#__consent">Change cookie settings</a>

          
        </div>
      </div>

      <!-- Right side: Page name and BETA -->
      <div class="md-footer__right">
        <div class="md-footer__page-info">
          <span class="md-footer__page-title">Content</span>
          
            <span class="md-footer__beta-badge">BETA</span>
          
        </div>
      </div>
    </div>
  
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            



<h4>Cookie consent</h4>
<p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of the textbook. With your consent, you're helping us to make software engineering education better for everyone.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
    
    
      
        
  
  
    
    
  
  <li class="task-list-item">
    <label class="task-list-control">
      <input type="checkbox" name="github" checked>
      <span class="task-list-indicator"></span>
      GitHub
    </label>
  </li>

      
    
    
      
        
  
  
    
    
  
  <li class="task-list-item">
    <label class="task-list-control">
      <input type="checkbox" name="analytics" checked>
      <span class="task-list-indicator"></span>
      Google Analytics
    </label>
  </li>

      
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Accept</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Manage settings</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script>
    
    
      
      <script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.tabs", "navigation.top", "navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.prune", "search.highlight", "search.suggest", "content.code.annotate", "content.code.copy", "content.code.select", "content.tabs.link", "content.action.edit", "content.action.view", "toc.follow"], "search": "../../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="../../../../assets/diagram-modal.js"></script>
      
        <script src="../../../../assets/quiz.js"></script>
      
        <script src="../../../../assets/ide-utils.js"></script>
      
        <script src="../../../../assets/code-blocks.js"></script>
      
    
  </body>
</html>