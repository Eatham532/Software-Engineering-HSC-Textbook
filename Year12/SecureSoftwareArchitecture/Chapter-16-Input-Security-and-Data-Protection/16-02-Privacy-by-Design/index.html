
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Comprehensive educational resource for NSW HSC Software Engineering syllabus">
      
      
      
        <link rel="canonical" href="https://eatham532.github.io/Software-Engineering-HSC-Textbook/Year12/SecureSoftwareArchitecture/Chapter-16-Input-Security-and-Data-Protection/16-02-Privacy-by-Design/">
      
      
        <link rel="prev" href="../16-01-Input-Validation-and-Sanitization/quiz/">
      
      
        <link rel="next" href="quiz/">
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>Section 16.2: Privacy by Design - Software Engineering Textbook HSC</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../assets/diagram-modal.css">
    
      <link rel="stylesheet" href="../../../../assets/quiz.css">
    
      <link rel="stylesheet" href="../../../../assets/common.css">
    
      <link rel="stylesheet" href="../../../../assets/diagram-fix.css">
    
      <link rel="stylesheet" href="../../../../assets/cross-reference.css">
    
      <link rel="stylesheet" href="../../../../assets/site-banner.css">
    
      <link rel="stylesheet" href="../../../../assets/code-runner.css">
    
      <link rel="stylesheet" href="../../../../assets/code-editor.css">
    
      <link rel="stylesheet" href="../../../../assets/glossary.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-58275RL1P9"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-58275RL1P9",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-58275RL1P9",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script>
  
    <script>if("undefined"!=typeof __md_analytics){var consent=__md_get("__consent");consent&&consent.analytics&&__md_analytics()}</script>
  

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#section-162-privacy-by-design" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
  
  
    
    
    
    <div class="site-banner site-banner--warning" data-banner data-banner-version="1" role="status" aria-live="polite">
      <div class="site-banner__inner">
        <span class="site-banner__icon" aria-hidden="true">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            
              <path d="M12 9v4"/><path d="M12 17h.01"/><path d="M10.29 3.86 1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0Z"/>
            
          </svg>
        </span>
        <p class="site-banner__text">
          This textbook is in <strong>beta</strong> – content is actively being refined.
          
            <a class="site-banner__link" href="https://github.com/Eatham532/Software-Engineering-HSC-Textbook/issues/new/choose" target="_blank" rel="noopener">Report issues or suggestions</a>
          
        </p>
        <button type="button" class="site-banner__close" aria-label="Dismiss banner" title="Dismiss" data-banner-dismiss>&times;</button>
      </div>
    </div>
    <script>
      (function(){
        var banner=document.querySelector('[data-banner]');
        if(!banner) return;
        var version=banner.getAttribute('data-banner-version')||'1';
        var KEY='site_banner_dismissed_v'+version;
        try{ if(localStorage.getItem(KEY)){ banner.remove(); return;} }catch(e){}
        var btn=banner.querySelector('[data-banner-dismiss]');
        if(btn){ btn.addEventListener('click',function(){
          banner.classList.add('is-hiding');
          setTimeout(function(){ banner && banner.remove(); },200);
          try{ localStorage.setItem(KEY,'1'); }catch(e){}
        }); }
      })();
    </script>
  
  
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="Software Engineering Textbook HSC" class="md-header__button md-logo" aria-label="Software Engineering Textbook HSC" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Software Engineering Textbook HSC
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Section 16.2: Privacy by Design
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m14.3 16-.7-2h-3.2l-.7 2H7.8L11 7h2l3.2 9zM20 8.69V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12zm-9.15 3.96h2.3L12 9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="indigo"  aria-label="Switch to system preference"  type="radio" name="__palette" id="__palette_2">
    
      <label class="md-header__button md-icon" title="Switch to system preference" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/Eatham532/Software-Engineering-HSC-Textbook/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Eatham532/Software-Engineering-HSC-Textbook
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    

    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../../Year11/ProgrammingFundamentals/" class="md-tabs__link">
          
  
  
  Year 11

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
  
  
    
    
      
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../../ProgrammingForTheWeb/" class="md-tabs__link">
          
  
  
  Year 12

        </a>
      </li>
    
  

    
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../code-editor/" class="md-tabs__link">
        
  
  
    
  
  Code Editor

      </a>
    </li>
  

      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../../../glossary/" class="md-tabs__link">
        
  
  
    
  
  Glossary

      </a>
    </li>
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="Software Engineering Textbook HSC" class="md-nav__button md-logo" aria-label="Software Engineering Textbook HSC" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Software Engineering Textbook HSC
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Eatham532/Software-Engineering-HSC-Textbook/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    Eatham532/Software-Engineering-HSC-Textbook
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    
  
  
  
    <a href="../../../../Year11/ProgrammingFundamentals/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Year 11
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Year 12
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Year 12
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../ProgrammingForTheWeb/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Programming For The Web
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" checked>
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Secure Software Architecture
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Secure Software Architecture
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Overview
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    
  
  
  
    <a href="../../Chapter-14-Security-Foundations/14-01-The-Business-Case-for-Security/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Chapter 14 — Security Foundations
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    
  
  
  
    <a href="../../Chapter-15-Core-Security-Principles/15-01-Security-Fundamentals-CIA-Triad-and-AAA/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Chapter 15 — Core Security Principles
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_4" checked>
        
          
          <label class="md-nav__link" for="__nav_3_2_4" id="__nav_3_2_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Chapter 16 — Input Security and Data Protection
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_3_2_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_2_4">
            <span class="md-nav__icon md-icon"></span>
            Chapter 16 — Input Security and Data Protection
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../16-01-Input-Validation-and-Sanitization/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    16.1 Input Validation and Sanitization
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
    
    
      
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2_4_2" checked>
        
          
          <label class="md-nav__link" for="__nav_3_2_4_2" id="__nav_3_2_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    16.2 Privacy by Design
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_3_2_4_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_2_4_2">
            <span class="md-nav__icon md-icon"></span>
            16.2 Privacy by Design
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Content
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#learning-objectives" class="md-nav__link">
    <span class="md-ellipsis">
      Learning Objectives
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-privacy-by-design-matters" class="md-nav__link">
    <span class="md-ellipsis">
      Why Privacy by Design Matters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-privacy-principles" class="md-nav__link">
    <span class="md-ellipsis">
      Core Privacy Principles
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Core Privacy Principles">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-data-minimization" class="md-nav__link">
    <span class="md-ellipsis">
      1. Data Minimization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-consent-management" class="md-nav__link">
    <span class="md-ellipsis">
      2. Consent Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-purpose-limitation-and-data-retention" class="md-nav__link">
    <span class="md-ellipsis">
      3. Purpose Limitation and Data Retention
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-privacy-impact-assessments" class="md-nav__link">
    <span class="md-ellipsis">
      4. Privacy Impact Assessments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gdpr-and-privacy-law-fundamentals" class="md-nav__link">
    <span class="md-ellipsis">
      GDPR and Privacy Law Fundamentals
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="quiz/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Quiz
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    
  
  
  
    <a href="../../Chapter-17-System-Security-and-APIs/17-01-Secure-API-Design/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Chapter 17 — System Security and APIs
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    
  
  
  
    <a href="../../Chapter-18-Security-Testing-and-Vulnerabilities/18-01-Security-Testing-Fundamentals/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Chapter 18 — Security Testing & Vulnerabilities
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    
  
  
  
    <a href="../../Chapter-19-Security-in-Context/19-01-Security-in-Development-Teams/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Chapter 19 — Security in Context
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

  

      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../SoftwareAutomation/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Software Automation
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href="../../../SoftwareEngineeringProject/" class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    Software Engineering Project
    
  </span>
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../code-editor/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Code Editor
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../../glossary/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Glossary
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#learning-objectives" class="md-nav__link">
    <span class="md-ellipsis">
      Learning Objectives
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#why-privacy-by-design-matters" class="md-nav__link">
    <span class="md-ellipsis">
      Why Privacy by Design Matters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#core-privacy-principles" class="md-nav__link">
    <span class="md-ellipsis">
      Core Privacy Principles
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Core Privacy Principles">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#1-data-minimization" class="md-nav__link">
    <span class="md-ellipsis">
      1. Data Minimization
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#2-consent-management" class="md-nav__link">
    <span class="md-ellipsis">
      2. Consent Management
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#3-purpose-limitation-and-data-retention" class="md-nav__link">
    <span class="md-ellipsis">
      3. Purpose Limitation and Data Retention
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#4-privacy-impact-assessments" class="md-nav__link">
    <span class="md-ellipsis">
      4. Privacy Impact Assessments
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gdpr-and-privacy-law-fundamentals" class="md-nav__link">
    <span class="md-ellipsis">
      GDPR and Privacy Law Fundamentals
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#summary" class="md-nav__link">
    <span class="md-ellipsis">
      Summary
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
    <a href="https://github.com/Eatham532/Software-Engineering-HSC-Textbook/edit/main/docs/Year12/SecureSoftwareArchitecture/Chapter-16-Input-Security-and-Data-Protection/16-02-Privacy-by-Design/index.md" title="Edit this page" class="md-content__button md-icon" rel="edit">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M10 20H6V4h7v5h5v3.1l2-2V8l-6-6H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h4zm10.2-7c.1 0 .3.1.4.2l1.3 1.3c.2.2.2.6 0 .8l-1 1-2.1-2.1 1-1c.1-.1.2-.2.4-.2m0 3.9L14.1 23H12v-2.1l6.1-6.1z"/></svg>
    </a>
  
  
    
      
    
    <a href="https://github.com/Eatham532/Software-Engineering-HSC-Textbook/raw/main/docs/Year12/SecureSoftwareArchitecture/Chapter-16-Input-Security-and-Data-Protection/16-02-Privacy-by-Design/index.md" title="View source of this page" class="md-content__button md-icon">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 18c.56 0 1 .44 1 1s-.44 1-1 1-1-.44-1-1 .44-1 1-1m0-3c-2.73 0-5.06 1.66-6 4 .94 2.34 3.27 4 6 4s5.06-1.66 6-4c-.94-2.34-3.27-4-6-4m0 6.5a2.5 2.5 0 0 1-2.5-2.5 2.5 2.5 0 0 1 2.5-2.5 2.5 2.5 0 0 1 2.5 2.5 2.5 2.5 0 0 1-2.5 2.5M9.27 20H6V4h7v5h5v4.07c.7.08 1.36.25 2 .49V8l-6-6H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h4.5a8.2 8.2 0 0 1-1.23-2"/></svg>
    </a>
  


<h1 id="section-162-privacy-by-design">Section 16.2: Privacy by Design<a class="headerlink" href="#section-162-privacy-by-design" title="Permanent link">&para;</a></h1>
<h2 id="learning-objectives">Learning Objectives<a class="headerlink" href="#learning-objectives" title="Permanent link">&para;</a></h2>
<p>By the end of this section, you will be able to:</p>
<ul>
<li>
<p><strong>Apply data minimization principles</strong> to collect only necessary personal information</p>
</li>
<li>
<p><strong>Implement consent management systems</strong> that respect user choices and legal requirements</p>
</li>
<li>
<p><strong>Design purpose limitation and data retention</strong> policies that protect user privacy</p>
</li>
<li>
<p><strong>Conduct privacy impact assessments</strong> to identify and mitigate privacy risks</p>
</li>
<li>
<p><strong>Understand GDPR and privacy law fundamentals</strong> and their implications for software design</p>
</li>
</ul>
<h2 id="why-privacy-by-design-matters">Why Privacy by Design Matters<a class="headerlink" href="#why-privacy-by-design-matters" title="Permanent link">&para;</a></h2>
<p>Privacy by Design is a <span class="glossary-term" data-glossary-category="Web Development" data-glossary-definition="A pre-built structure providing a foundation and tools for developing software applications more efficiently." data-glossary-term="Framework">framework</span> that embeds privacy considerations into the design and operation of systems from the ground up. It&rsquo;s not just about compliance with regulations like GDPR—it&rsquo;s about building trust with users and creating sustainable, ethical software systems.</p>
<p><strong>Without Privacy by Design:</strong></p>
<ul>
<li>
<p>User data is collected unnecessarily, creating privacy risks and compliance burdens</p>
</li>
<li>
<p>Data breaches expose more personal information than required for business operations</p>
</li>
<li>
<p>Users lose trust when they discover unexpected data collection or usage</p>
</li>
<li>
<p>Organizations face significant penalties under privacy regulations</p>
</li>
<li>
<p>Technical debt accumulates as privacy requirements are retrofitted</p>
</li>
</ul>
<h2 id="core-privacy-principles">Core Privacy Principles<a class="headerlink" href="#core-privacy-principles" title="Permanent link">&para;</a></h2>
<h3 id="1-data-minimization">1. Data Minimization<a class="headerlink" href="#1-data-minimization" title="Permanent link">&para;</a></h3>
<p><strong>Data minimization</strong> means collecting, processing, and storing only the personal data that is necessary for the specific purpose.</p>
<div class="highlight python-template" data-fence-type="template" data-language="python">
<pre><code class="language-python"><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Set</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">enum</span><span class="w"> </span><span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="k">class</span><span class="w"> </span><span class="nc">DataCategory</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">ESSENTIAL</span> <span class="o">=</span> <span class="s2">&quot;essential&quot;</span>  <span class="c1"># Required for core functionality</span>
    <span class="n">FUNCTIONAL</span> <span class="o">=</span> <span class="s2">&quot;functional&quot;</span>  <span class="c1"># Enhances user experience</span>
    <span class="n">ANALYTICS</span> <span class="o">=</span> <span class="s2">&quot;analytics&quot;</span>  <span class="c1"># For improving services</span>
    <span class="n">MARKETING</span> <span class="o">=</span> <span class="s2">&quot;marketing&quot;</span>  <span class="c1"># For promotional purposes</span>

<span class="k">class</span><span class="w"> </span><span class="nc">PurposeLimitation</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">ACCOUNT_MANAGEMENT</span> <span class="o">=</span> <span class="s2">&quot;account_management&quot;</span>
    <span class="n">SERVICE_DELIVERY</span> <span class="o">=</span> <span class="s2">&quot;service_delivery&quot;</span>
    <span class="n">SECURITY</span> <span class="o">=</span> <span class="s2">&quot;security&quot;</span>
    <span class="n">ANALYTICS</span> <span class="o">=</span> <span class="s2">&quot;analytics&quot;</span>
    <span class="n">MARKETING</span> <span class="o">=</span> <span class="s2">&quot;marketing&quot;</span>
    <span class="n">LEGAL_COMPLIANCE</span> <span class="o">=</span> <span class="s2">&quot;legal_compliance&quot;</span>

<span class="k">class</span><span class="w"> </span><span class="nc">DataMinimizationManager</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Define what data is necessary for each purpose</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">purpose_data_mapping</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">PurposeLimitation</span><span class="o">.</span><span class="n">ACCOUNT_MANAGEMENT</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="s1">&#39;password_hash&#39;</span><span class="p">],</span>
                <span class="s1">&#39;optional&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;display_name&#39;</span><span class="p">,</span> <span class="s1">&#39;timezone&#39;</span><span class="p">]</span>
            <span class="p">},</span>
            <span class="n">PurposeLimitation</span><span class="o">.</span><span class="n">SERVICE_DELIVERY</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">,</span> <span class="s1">&#39;service_preferences&#39;</span><span class="p">],</span>
                <span class="s1">&#39;optional&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;usage_history&#39;</span><span class="p">,</span> <span class="s1">&#39;personalization_settings&#39;</span><span class="p">]</span>
            <span class="p">},</span>
            <span class="n">PurposeLimitation</span><span class="o">.</span><span class="n">SECURITY</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;login_attempts&#39;</span><span class="p">,</span> <span class="s1">&#39;ip_address&#39;</span><span class="p">,</span> <span class="s1">&#39;session_data&#39;</span><span class="p">],</span>
                <span class="s1">&#39;optional&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;device_fingerprint&#39;</span><span class="p">,</span> <span class="s1">&#39;security_questions&#39;</span><span class="p">]</span>
            <span class="p">},</span>
            <span class="n">PurposeLimitation</span><span class="o">.</span><span class="n">ANALYTICS</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s1">&#39;optional&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;page_views&#39;</span><span class="p">,</span> <span class="s1">&#39;feature_usage&#39;</span><span class="p">,</span> <span class="s1">&#39;performance_metrics&#39;</span><span class="p">]</span>
            <span class="p">},</span>
            <span class="n">PurposeLimitation</span><span class="o">.</span><span class="n">MARKETING</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;required&#39;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s1">&#39;optional&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;communication_preferences&#39;</span><span class="p">,</span> <span class="s1">&#39;interest_categories&#39;</span><span class="p">]</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1"># Define data retention periods</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">retention_periods</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">DataCategory</span><span class="o">.</span><span class="n">ESSENTIAL</span><span class="p">:</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">2555</span><span class="p">),</span>  <span class="c1"># 7 years (legal requirement)</span>
            <span class="n">DataCategory</span><span class="o">.</span><span class="n">FUNCTIONAL</span><span class="p">:</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">365</span><span class="p">),</span>  <span class="c1"># 1 year</span>
            <span class="n">DataCategory</span><span class="o">.</span><span class="n">ANALYTICS</span><span class="p">:</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">90</span><span class="p">),</span>    <span class="c1"># 3 months</span>
            <span class="n">DataCategory</span><span class="o">.</span><span class="n">MARKETING</span><span class="p">:</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">730</span><span class="p">)</span>    <span class="c1"># 2 years</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">validate_data_collection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">requested_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">],</span> 
                                <span class="n">purpose</span><span class="p">:</span> <span class="n">PurposeLimitation</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Validate that data collection adheres to minimization principles&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">purpose</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">purpose_data_mapping</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;is_valid&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Unknown purpose: </span><span class="si">{</span><span class="n">purpose</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s1">&#39;allowed_data&#39;</span><span class="p">:</span> <span class="p">{},</span>
                <span class="s1">&#39;rejected_data&#39;</span><span class="p">:</span> <span class="n">requested_data</span>
            <span class="p">}</span>

        <span class="n">allowed_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">purpose_data_mapping</span><span class="p">[</span><span class="n">purpose</span><span class="p">]</span>
        <span class="n">required_fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">allowed_fields</span><span class="p">[</span><span class="s1">&#39;required&#39;</span><span class="p">])</span>
        <span class="n">optional_fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">allowed_fields</span><span class="p">[</span><span class="s1">&#39;optional&#39;</span><span class="p">])</span>
        <span class="n">all_allowed</span> <span class="o">=</span> <span class="n">required_fields</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">optional_fields</span><span class="p">)</span>

        <span class="c1"># Separate allowed and rejected data</span>
        <span class="n">allowed_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">rejected_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">missing_required</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">field</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">requested_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">all_allowed</span><span class="p">:</span>
                <span class="n">allowed_data</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">rejected_data</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="c1"># Check for missing required fields</span>
        <span class="k">for</span> <span class="n">required_field</span> <span class="ow">in</span> <span class="n">required_fields</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">required_field</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">requested_data</span><span class="p">:</span>
                <span class="n">missing_required</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">required_field</span><span class="p">)</span>

        <span class="n">is_valid</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">rejected_data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">missing_required</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;is_valid&#39;</span><span class="p">:</span> <span class="n">is_valid</span><span class="p">,</span>
            <span class="s1">&#39;allowed_data&#39;</span><span class="p">:</span> <span class="n">allowed_data</span><span class="p">,</span>
            <span class="s1">&#39;rejected_data&#39;</span><span class="p">:</span> <span class="n">rejected_data</span><span class="p">,</span>
            <span class="s1">&#39;missing_required&#39;</span><span class="p">:</span> <span class="n">missing_required</span><span class="p">,</span>
            <span class="s1">&#39;purpose&#39;</span><span class="p">:</span> <span class="n">purpose</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="s1">&#39;minimization_applied&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">rejected_data</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">create_privacy_compliant_user_profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">],</span> 
                                            <span class="n">purposes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">PurposeLimitation</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Create user profile that only includes data needed for specified purposes&quot;&quot;&quot;</span>

        <span class="n">all_allowed_data</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">collection_log</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">purpose</span> <span class="ow">in</span> <span class="n">purposes</span><span class="p">:</span>
            <span class="n">validation_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_data_collection</span><span class="p">(</span><span class="n">user_data</span><span class="p">,</span> <span class="n">purpose</span><span class="p">)</span>

            <span class="c1"># Merge allowed data</span>
            <span class="n">all_allowed_data</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">validation_result</span><span class="p">[</span><span class="s1">&#39;allowed_data&#39;</span><span class="p">])</span>

            <span class="c1"># Log collection rationale</span>
            <span class="n">collection_log</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;purpose&#39;</span><span class="p">:</span> <span class="n">purpose</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="s1">&#39;fields_collected&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">validation_result</span><span class="p">[</span><span class="s1">&#39;allowed_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
                <span class="s1">&#39;fields_rejected&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">validation_result</span><span class="p">[</span><span class="s1">&#39;rejected_data&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
                <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
            <span class="p">})</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;user_profile&#39;</span><span class="p">:</span> <span class="n">all_allowed_data</span><span class="p">,</span>
            <span class="s1">&#39;collection_rationale&#39;</span><span class="p">:</span> <span class="n">collection_log</span><span class="p">,</span>
            <span class="s1">&#39;data_categories&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_categorize_collected_data</span><span class="p">(</span><span class="n">all_allowed_data</span><span class="p">),</span>
            <span class="s1">&#39;retention_schedule&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_retention_schedule</span><span class="p">(</span><span class="n">all_allowed_data</span><span class="p">)</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_categorize_collected_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collected_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Categorize collected data by privacy impact&quot;&quot;&quot;</span>

        <span class="c1"># Define data categories based on privacy sensitivity</span>
        <span class="n">categorization</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">DataCategory</span><span class="o">.</span><span class="n">ESSENTIAL</span><span class="o">.</span><span class="n">value</span><span class="p">:</span> <span class="p">[],</span>
            <span class="n">DataCategory</span><span class="o">.</span><span class="n">FUNCTIONAL</span><span class="o">.</span><span class="n">value</span><span class="p">:</span> <span class="p">[],</span>
            <span class="n">DataCategory</span><span class="o">.</span><span class="n">ANALYTICS</span><span class="o">.</span><span class="n">value</span><span class="p">:</span> <span class="p">[],</span>
            <span class="n">DataCategory</span><span class="o">.</span><span class="n">MARKETING</span><span class="o">.</span><span class="n">value</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">}</span>

        <span class="n">essential_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">,</span> <span class="s1">&#39;password_hash&#39;</span><span class="p">,</span> <span class="s1">&#39;user_id&#39;</span><span class="p">]</span>
        <span class="n">functional_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;display_name&#39;</span><span class="p">,</span> <span class="s1">&#39;timezone&#39;</span><span class="p">,</span> <span class="s1">&#39;service_preferences&#39;</span><span class="p">,</span> <span class="s1">&#39;personalization_settings&#39;</span><span class="p">]</span>
        <span class="n">analytics_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;page_views&#39;</span><span class="p">,</span> <span class="s1">&#39;feature_usage&#39;</span><span class="p">,</span> <span class="s1">&#39;performance_metrics&#39;</span><span class="p">,</span> <span class="s1">&#39;usage_history&#39;</span><span class="p">]</span>
        <span class="n">marketing_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;communication_preferences&#39;</span><span class="p">,</span> <span class="s1">&#39;interest_categories&#39;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">collected_data</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">essential_fields</span><span class="p">:</span>
                <span class="n">categorization</span><span class="p">[</span><span class="n">DataCategory</span><span class="o">.</span><span class="n">ESSENTIAL</span><span class="o">.</span><span class="n">value</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">functional_fields</span><span class="p">:</span>
                <span class="n">categorization</span><span class="p">[</span><span class="n">DataCategory</span><span class="o">.</span><span class="n">FUNCTIONAL</span><span class="o">.</span><span class="n">value</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">analytics_fields</span><span class="p">:</span>
                <span class="n">categorization</span><span class="p">[</span><span class="n">DataCategory</span><span class="o">.</span><span class="n">ANALYTICS</span><span class="o">.</span><span class="n">value</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">marketing_fields</span><span class="p">:</span>
                <span class="n">categorization</span><span class="p">[</span><span class="n">DataCategory</span><span class="o">.</span><span class="n">MARKETING</span><span class="o">.</span><span class="n">value</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Default to functional if not categorized</span>
                <span class="n">categorization</span><span class="p">[</span><span class="n">DataCategory</span><span class="o">.</span><span class="n">FUNCTIONAL</span><span class="o">.</span><span class="n">value</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">field</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">categorization</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_retention_schedule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collected_data</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate when each piece of data should be deleted&quot;&quot;&quot;</span>

        <span class="n">categorized_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_categorize_collected_data</span><span class="p">(</span><span class="n">collected_data</span><span class="p">)</span>
        <span class="n">retention_schedule</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">category</span><span class="p">,</span> <span class="n">fields</span> <span class="ow">in</span> <span class="n">categorized_data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">fields</span><span class="p">:</span>  <span class="c1"># Only process non-empty categories</span>
                <span class="n">category_enum</span> <span class="o">=</span> <span class="n">DataCategory</span><span class="p">(</span><span class="n">category</span><span class="p">)</span>
                <span class="n">retention_period</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">retention_periods</span><span class="p">[</span><span class="n">category_enum</span><span class="p">]</span>
                <span class="n">deletion_date</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="n">retention_period</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>

                <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
                    <span class="n">retention_schedule</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">deletion_date</span>

        <span class="k">return</span> <span class="n">retention_schedule</span>

<span class="c1"># Demonstration of data minimization</span>
<span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_data_minimization</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Demonstrate data minimization in practice&quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Data Minimization Demo ===&quot;</span><span class="p">)</span>

    <span class="n">minimizer</span> <span class="o">=</span> <span class="n">DataMinimizationManager</span><span class="p">()</span>

    <span class="c1"># Simulate user registration form with excessive data collection</span>
    <span class="n">excessive_user_data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="s1">&#39;student123&#39;</span><span class="p">,</span>
        <span class="s1">&#39;email&#39;</span><span class="p">:</span> <span class="s1">&#39;student@school.edu&#39;</span><span class="p">,</span>
        <span class="s1">&#39;password_hash&#39;</span><span class="p">:</span> <span class="s1">&#39;hashed_password&#39;</span><span class="p">,</span>
        <span class="s1">&#39;first_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Alice&#39;</span><span class="p">,</span>
        <span class="s1">&#39;last_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Johnson&#39;</span><span class="p">,</span>
        <span class="s1">&#39;phone_number&#39;</span><span class="p">:</span> <span class="s1">&#39;+1234567890&#39;</span><span class="p">,</span>
        <span class="s1">&#39;address&#39;</span><span class="p">:</span> <span class="s1">&#39;123 Main St, City, State&#39;</span><span class="p">,</span>
        <span class="s1">&#39;date_of_birth&#39;</span><span class="p">:</span> <span class="s1">&#39;2005-01-15&#39;</span><span class="p">,</span>
        <span class="s1">&#39;social_security_number&#39;</span><span class="p">:</span> <span class="s1">&#39;123-45-6789&#39;</span><span class="p">,</span>  <span class="c1"># Excessive!</span>
        <span class="s1">&#39;emergency_contact&#39;</span><span class="p">:</span> <span class="s1">&#39;Parent Name&#39;</span><span class="p">,</span>
        <span class="s1">&#39;medical_conditions&#39;</span><span class="p">:</span> <span class="s1">&#39;None&#39;</span><span class="p">,</span>  <span class="c1"># Excessive!</span>
        <span class="s1">&#39;favorite_color&#39;</span><span class="p">:</span> <span class="s1">&#39;Blue&#39;</span><span class="p">,</span>  <span class="c1"># Excessive!</span>
        <span class="s1">&#39;display_name&#39;</span><span class="p">:</span> <span class="s1">&#39;Alice J&#39;</span><span class="p">,</span>
        <span class="s1">&#39;timezone&#39;</span><span class="p">:</span> <span class="s1">&#39;UTC-5&#39;</span>
    <span class="p">}</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Original registration data fields:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">excessive_user_data</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fields:&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">excessive_user_data</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>

    <span class="c1"># Apply data minimization for account management only</span>
    <span class="n">purposes</span> <span class="o">=</span> <span class="p">[</span><span class="n">PurposeLimitation</span><span class="o">.</span><span class="n">ACCOUNT_MANAGEMENT</span><span class="p">]</span>

    <span class="n">privacy_compliant_profile</span> <span class="o">=</span> <span class="n">minimizer</span><span class="o">.</span><span class="n">create_privacy_compliant_user_profile</span><span class="p">(</span>
        <span class="n">excessive_user_data</span><span class="p">,</span> <span class="n">purposes</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">After data minimization for </span><span class="si">{</span><span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">value</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">purposes</span><span class="p">]</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Collected fields:&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">privacy_compliant_profile</span><span class="p">[</span><span class="s1">&#39;user_profile&#39;</span><span class="p">]))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Fields:&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">privacy_compliant_profile</span><span class="p">[</span><span class="s1">&#39;user_profile&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Collection rationale:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">log_entry</span> <span class="ow">in</span> <span class="n">privacy_compliant_profile</span><span class="p">[</span><span class="s1">&#39;collection_rationale&#39;</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Purpose: </span><span class="si">{</span><span class="n">log_entry</span><span class="p">[</span><span class="s1">&#39;purpose&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Collected: </span><span class="si">{</span><span class="n">log_entry</span><span class="p">[</span><span class="s1">&#39;fields_collected&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Rejected: </span><span class="si">{</span><span class="n">log_entry</span><span class="p">[</span><span class="s1">&#39;fields_rejected&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Data categories:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">category</span><span class="p">,</span> <span class="n">fields</span> <span class="ow">in</span> <span class="n">privacy_compliant_profile</span><span class="p">[</span><span class="s1">&#39;data_categories&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">fields</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">category</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">fields</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Demonstrate adding more purposes</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">=== Adding Service Delivery Purpose ===&quot;</span><span class="p">)</span>

    <span class="n">extended_purposes</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">PurposeLimitation</span><span class="o">.</span><span class="n">ACCOUNT_MANAGEMENT</span><span class="p">,</span>
        <span class="n">PurposeLimitation</span><span class="o">.</span><span class="n">SERVICE_DELIVERY</span>
    <span class="p">]</span>

    <span class="n">extended_profile</span> <span class="o">=</span> <span class="n">minimizer</span><span class="o">.</span><span class="n">create_privacy_compliant_user_profile</span><span class="p">(</span>
        <span class="n">excessive_user_data</span><span class="p">,</span> <span class="n">extended_purposes</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Extended collection fields:&quot;</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">extended_profile</span><span class="p">[</span><span class="s1">&#39;user_profile&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Still rejected excessive fields like SSN, medical conditions, favorite color&quot;</span><span class="p">)</span>
</code></pre>
</div>
<h3 id="2-consent-management">2. Consent Management<a class="headerlink" href="#2-consent-management" title="Permanent link">&para;</a></h3>
<p><strong>Consent management</strong> ensures users have control over how their personal data is collected and used.</p>
<div class="highlight python-template" data-fence-type="template" data-language="python">
<pre><code class="language-python"><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">uuid</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ConsentType</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">NECESSARY</span> <span class="o">=</span> <span class="s2">&quot;necessary&quot;</span>  <span class="c1"># Required for service</span>
    <span class="n">FUNCTIONAL</span> <span class="o">=</span> <span class="s2">&quot;functional&quot;</span>  <span class="c1"># Enhances experience</span>
    <span class="n">ANALYTICS</span> <span class="o">=</span> <span class="s2">&quot;analytics&quot;</span>  <span class="c1"># Service improvement</span>
    <span class="n">MARKETING</span> <span class="o">=</span> <span class="s2">&quot;marketing&quot;</span>  <span class="c1"># Promotional communications</span>
    <span class="n">PERSONALIZATION</span> <span class="o">=</span> <span class="s2">&quot;personalization&quot;</span>  <span class="c1"># Customized content</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ConsentStatus</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">GRANTED</span> <span class="o">=</span> <span class="s2">&quot;granted&quot;</span>
    <span class="n">DENIED</span> <span class="o">=</span> <span class="s2">&quot;denied&quot;</span>
    <span class="n">WITHDRAWN</span> <span class="o">=</span> <span class="s2">&quot;withdrawn&quot;</span>
    <span class="n">EXPIRED</span> <span class="o">=</span> <span class="s2">&quot;expired&quot;</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ConsentRecord</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">consent_type</span><span class="p">:</span> <span class="n">ConsentType</span><span class="p">,</span> <span class="n">status</span><span class="p">:</span> <span class="n">ConsentStatus</span><span class="p">,</span> 
                 <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">ip_address</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span><span class="p">,</span> <span class="n">user_agent</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">consent_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">consent_type</span> <span class="o">=</span> <span class="n">consent_type</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">status</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_id</span> <span class="o">=</span> <span class="n">user_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ip_address</span> <span class="o">=</span> <span class="n">ip_address</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_agent</span> <span class="o">=</span> <span class="n">user_agent</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expiry_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_expiry</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">withdrawal_date</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_expiry</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate when consent expires (typically 12 months)&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">timestamp</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">365</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if consent is currently valid&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="ow">in</span> <span class="p">[</span><span class="n">ConsentStatus</span><span class="o">.</span><span class="n">DENIED</span><span class="p">,</span> <span class="n">ConsentStatus</span><span class="o">.</span><span class="n">WITHDRAWN</span><span class="p">]:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">expiry_date</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">ConsentStatus</span><span class="o">.</span><span class="n">EXPIRED</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">withdraw</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Withdraw consent&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">ConsentStatus</span><span class="o">.</span><span class="n">GRANTED</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">=</span> <span class="n">ConsentStatus</span><span class="o">.</span><span class="n">WITHDRAWN</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">withdrawal_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

<span class="k">class</span><span class="w"> </span><span class="nc">ConsentManager</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">consent_records</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">ConsentRecord</span><span class="p">]]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Define what each consent type enables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">consent_capabilities</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">ConsentType</span><span class="o">.</span><span class="n">NECESSARY</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;Essential for basic service functionality&#39;</span><span class="p">,</span>
                <span class="s1">&#39;can_opt_out&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;data_types&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;account_data&#39;</span><span class="p">,</span> <span class="s1">&#39;security_logs&#39;</span><span class="p">,</span> <span class="s1">&#39;essential_preferences&#39;</span><span class="p">],</span>
                <span class="s1">&#39;processing_activities&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;authentication&#39;</span><span class="p">,</span> <span class="s1">&#39;service_delivery&#39;</span><span class="p">,</span> <span class="s1">&#39;security&#39;</span><span class="p">]</span>
            <span class="p">},</span>
            <span class="n">ConsentType</span><span class="o">.</span><span class="n">FUNCTIONAL</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;Enhances your experience with additional features&#39;</span><span class="p">,</span>
                <span class="s1">&#39;can_opt_out&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s1">&#39;data_types&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;usage_preferences&#39;</span><span class="p">,</span> <span class="s1">&#39;ui_customizations&#39;</span><span class="p">,</span> <span class="s1">&#39;feature_settings&#39;</span><span class="p">],</span>
                <span class="s1">&#39;processing_activities&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;personalization&#39;</span><span class="p">,</span> <span class="s1">&#39;feature_enhancement&#39;</span><span class="p">]</span>
            <span class="p">},</span>
            <span class="n">ConsentType</span><span class="o">.</span><span class="n">ANALYTICS</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;Helps us improve our services through usage analysis&#39;</span><span class="p">,</span>
                <span class="s1">&#39;can_opt_out&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s1">&#39;data_types&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;page_views&#39;</span><span class="p">,</span> <span class="s1">&#39;feature_usage&#39;</span><span class="p">,</span> <span class="s1">&#39;performance_data&#39;</span><span class="p">],</span>
                <span class="s1">&#39;processing_activities&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;service_improvement&#39;</span><span class="p">,</span> <span class="s1">&#39;bug_detection&#39;</span><span class="p">,</span> <span class="s1">&#39;optimization&#39;</span><span class="p">]</span>
            <span class="p">},</span>
            <span class="n">ConsentType</span><span class="o">.</span><span class="n">MARKETING</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;Allows us to send you promotional communications&#39;</span><span class="p">,</span>
                <span class="s1">&#39;can_opt_out&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s1">&#39;data_types&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;communication_preferences&#39;</span><span class="p">,</span> <span class="s1">&#39;interest_data&#39;</span><span class="p">],</span>
                <span class="s1">&#39;processing_activities&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;email_marketing&#39;</span><span class="p">,</span> <span class="s1">&#39;targeted_communications&#39;</span><span class="p">]</span>
            <span class="p">},</span>
            <span class="n">ConsentType</span><span class="o">.</span><span class="n">PERSONALIZATION</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="s1">&#39;Enables customized content and recommendations&#39;</span><span class="p">,</span>
                <span class="s1">&#39;can_opt_out&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s1">&#39;data_types&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;behavior_patterns&#39;</span><span class="p">,</span> <span class="s1">&#39;preferences&#39;</span><span class="p">,</span> <span class="s1">&#39;interaction_history&#39;</span><span class="p">],</span>
                <span class="s1">&#39;processing_activities&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;content_customization&#39;</span><span class="p">,</span> <span class="s1">&#39;recommendations&#39;</span><span class="p">]</span>
            <span class="p">}</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">request_consent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">consent_types</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">ConsentType</span><span class="p">],</span> 
                       <span class="n">ip_address</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span><span class="p">,</span> <span class="n">user_agent</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Request consent from user with clear information&quot;&quot;&quot;</span>

        <span class="n">consent_request</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;request_id&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">uuid</span><span class="o">.</span><span class="n">uuid4</span><span class="p">()),</span>
            <span class="s1">&#39;user_id&#39;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
            <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
            <span class="s1">&#39;consent_options&#39;</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">}</span>

        <span class="k">for</span> <span class="n">consent_type</span> <span class="ow">in</span> <span class="n">consent_types</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">consent_type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">consent_capabilities</span><span class="p">:</span>
                <span class="n">capability</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">consent_capabilities</span><span class="p">[</span><span class="n">consent_type</span><span class="p">]</span>

                <span class="n">consent_option</span> <span class="o">=</span> <span class="p">{</span>
                    <span class="s1">&#39;consent_type&#39;</span><span class="p">:</span> <span class="n">consent_type</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                    <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="n">capability</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;can_opt_out&#39;</span><span class="p">:</span> <span class="n">capability</span><span class="p">[</span><span class="s1">&#39;can_opt_out&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;data_types&#39;</span><span class="p">:</span> <span class="n">capability</span><span class="p">[</span><span class="s1">&#39;data_types&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;processing_activities&#39;</span><span class="p">:</span> <span class="n">capability</span><span class="p">[</span><span class="s1">&#39;processing_activities&#39;</span><span class="p">],</span>
                    <span class="s1">&#39;is_required&#39;</span><span class="p">:</span> <span class="ow">not</span> <span class="n">capability</span><span class="p">[</span><span class="s1">&#39;can_opt_out&#39;</span><span class="p">]</span>
                <span class="p">}</span>

                <span class="n">consent_request</span><span class="p">[</span><span class="s1">&#39;consent_options&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">consent_option</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">consent_request</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">record_consent_decision</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">consent_decisions</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="n">ConsentType</span><span class="p">,</span> <span class="nb">bool</span><span class="p">],</span>
                              <span class="n">ip_address</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span><span class="p">,</span> <span class="n">user_agent</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;unknown&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Record user&#39;s consent decisions&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">user_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">consent_records</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">consent_records</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">recorded_consents</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">validation_errors</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">consent_type</span><span class="p">,</span> <span class="n">granted</span> <span class="ow">in</span> <span class="n">consent_decisions</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="c1"># Check if this is a required consent that was denied</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">granted</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">consent_capabilities</span><span class="p">[</span><span class="n">consent_type</span><span class="p">][</span><span class="s1">&#39;can_opt_out&#39;</span><span class="p">]:</span>
                <span class="n">validation_errors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cannot deny required consent: </span><span class="si">{</span><span class="n">consent_type</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">continue</span>

            <span class="c1"># Create consent record</span>
            <span class="n">status</span> <span class="o">=</span> <span class="n">ConsentStatus</span><span class="o">.</span><span class="n">GRANTED</span> <span class="k">if</span> <span class="n">granted</span> <span class="k">else</span> <span class="n">ConsentStatus</span><span class="o">.</span><span class="n">DENIED</span>
            <span class="n">consent_record</span> <span class="o">=</span> <span class="n">ConsentRecord</span><span class="p">(</span><span class="n">consent_type</span><span class="p">,</span> <span class="n">status</span><span class="p">,</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">ip_address</span><span class="p">,</span> <span class="n">user_agent</span><span class="p">)</span>

            <span class="c1"># Withdraw any previous consent for this type</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_withdraw_previous_consent</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">consent_type</span><span class="p">)</span>

            <span class="c1"># Store new consent</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">consent_records</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">consent_record</span><span class="p">)</span>
            <span class="n">recorded_consents</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                <span class="s1">&#39;consent_id&#39;</span><span class="p">:</span> <span class="n">consent_record</span><span class="o">.</span><span class="n">consent_id</span><span class="p">,</span>
                <span class="s1">&#39;consent_type&#39;</span><span class="p">:</span> <span class="n">consent_type</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="n">status</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                <span class="s1">&#39;expiry_date&#39;</span><span class="p">:</span> <span class="n">consent_record</span><span class="o">.</span><span class="n">expiry_date</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
            <span class="p">})</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">validation_errors</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span>
            <span class="s1">&#39;recorded_consents&#39;</span><span class="p">:</span> <span class="n">recorded_consents</span><span class="p">,</span>
            <span class="s1">&#39;validation_errors&#39;</span><span class="p">:</span> <span class="n">validation_errors</span><span class="p">,</span>
            <span class="s1">&#39;processing_lawful_basis&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_determine_lawful_basis</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check_consent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">consent_type</span><span class="p">:</span> <span class="n">ConsentType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if user has given valid consent for specific processing&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">user_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">consent_records</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;has_consent&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;reason&#39;</span><span class="p">:</span> <span class="s1">&#39;No consent records found&#39;</span><span class="p">,</span>
                <span class="s1">&#39;can_process&#39;</span><span class="p">:</span> <span class="kc">False</span>
            <span class="p">}</span>

        <span class="c1"># Find most recent consent for this type</span>
        <span class="n">user_consents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">consent_records</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span>
        <span class="n">relevant_consents</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">user_consents</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">consent_type</span> <span class="o">==</span> <span class="n">consent_type</span><span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">relevant_consents</span><span class="p">:</span>
            <span class="c1"># Check if this is necessary processing</span>
            <span class="k">if</span> <span class="n">consent_type</span> <span class="o">==</span> <span class="n">ConsentType</span><span class="o">.</span><span class="n">NECESSARY</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{</span>
                    <span class="s1">&#39;has_consent&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="s1">&#39;reason&#39;</span><span class="p">:</span> <span class="s1">&#39;Necessary for service delivery&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;can_process&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="s1">&#39;lawful_basis&#39;</span><span class="p">:</span> <span class="s1">&#39;legitimate_interest&#39;</span>
                <span class="p">}</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;has_consent&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;reason&#39;</span><span class="p">:</span> <span class="s1">&#39;No consent given for this type&#39;</span><span class="p">,</span>
                <span class="s1">&#39;can_process&#39;</span><span class="p">:</span> <span class="kc">False</span>
            <span class="p">}</span>

        <span class="c1"># Get most recent consent</span>
        <span class="n">latest_consent</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">relevant_consents</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">c</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">timestamp</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">latest_consent</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;has_consent&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s1">&#39;consent_id&#39;</span><span class="p">:</span> <span class="n">latest_consent</span><span class="o">.</span><span class="n">consent_id</span><span class="p">,</span>
                <span class="s1">&#39;granted_date&#39;</span><span class="p">:</span> <span class="n">latest_consent</span><span class="o">.</span><span class="n">timestamp</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
                <span class="s1">&#39;expiry_date&#39;</span><span class="p">:</span> <span class="n">latest_consent</span><span class="o">.</span><span class="n">expiry_date</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
                <span class="s1">&#39;can_process&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s1">&#39;lawful_basis&#39;</span><span class="p">:</span> <span class="s1">&#39;consent&#39;</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;has_consent&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;reason&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Consent </span><span class="si">{</span><span class="n">latest_consent</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;can_process&#39;</span><span class="p">:</span> <span class="n">consent_type</span> <span class="o">==</span> <span class="n">ConsentType</span><span class="o">.</span><span class="n">NECESSARY</span><span class="p">,</span>
                <span class="s1">&#39;lawful_basis&#39;</span><span class="p">:</span> <span class="s1">&#39;legitimate_interest&#39;</span> <span class="k">if</span> <span class="n">consent_type</span> <span class="o">==</span> <span class="n">ConsentType</span><span class="o">.</span><span class="n">NECESSARY</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">withdraw_consent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">consent_type</span><span class="p">:</span> <span class="n">ConsentType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Allow user to withdraw consent&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">consent_type</span> <span class="o">==</span> <span class="n">ConsentType</span><span class="o">.</span><span class="n">NECESSARY</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Cannot withdraw consent for necessary processing&#39;</span><span class="p">,</span>
                <span class="s1">&#39;alternative&#39;</span><span class="p">:</span> <span class="s1">&#39;You can delete your account if you wish to stop all processing&#39;</span>
            <span class="p">}</span>

        <span class="n">withdrawal_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_withdraw_previous_consent</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">consent_type</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">withdrawal_result</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Consent withdrawn for </span><span class="si">{</span><span class="n">consent_type</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="s1">&#39;data_processing_stopped&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                <span class="s1">&#39;data_deletion_scheduled&#39;</span><span class="p">:</span> <span class="kc">True</span>
            <span class="p">}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;No active consent found to withdraw&#39;</span>
            <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_consent_dashboard</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Provide user with overview of their consent status&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">user_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">consent_records</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;user_id&#39;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
                <span class="s1">&#39;consent_status&#39;</span><span class="p">:</span> <span class="p">{},</span>
                <span class="s1">&#39;data_processing_activities&#39;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s1">&#39;withdrawal_options&#39;</span><span class="p">:</span> <span class="p">[]</span>
            <span class="p">}</span>

        <span class="n">consent_status</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">processing_activities</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">withdrawal_options</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">consent_type</span> <span class="ow">in</span> <span class="n">ConsentType</span><span class="p">:</span>
            <span class="n">check_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_consent</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">consent_type</span><span class="p">)</span>
            <span class="n">consent_status</span><span class="p">[</span><span class="n">consent_type</span><span class="o">.</span><span class="n">value</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;has_consent&#39;</span><span class="p">:</span> <span class="n">check_result</span><span class="p">[</span><span class="s1">&#39;has_consent&#39;</span><span class="p">],</span>
                <span class="s1">&#39;can_process&#39;</span><span class="p">:</span> <span class="n">check_result</span><span class="p">[</span><span class="s1">&#39;can_process&#39;</span><span class="p">],</span>
                <span class="s1">&#39;reason&#39;</span><span class="p">:</span> <span class="n">check_result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;reason&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">),</span>
                <span class="s1">&#39;expiry_date&#39;</span><span class="p">:</span> <span class="n">check_result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;expiry_date&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="n">check_result</span><span class="p">[</span><span class="s1">&#39;can_process&#39;</span><span class="p">]:</span>
                <span class="n">capability</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">consent_capabilities</span><span class="p">[</span><span class="n">consent_type</span><span class="p">]</span>
                <span class="n">processing_activities</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">capability</span><span class="p">[</span><span class="s1">&#39;processing_activities&#39;</span><span class="p">])</span>

            <span class="k">if</span> <span class="n">consent_type</span> <span class="o">!=</span> <span class="n">ConsentType</span><span class="o">.</span><span class="n">NECESSARY</span> <span class="ow">and</span> <span class="n">check_result</span><span class="p">[</span><span class="s1">&#39;has_consent&#39;</span><span class="p">]:</span>
                <span class="n">withdrawal_options</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                    <span class="s1">&#39;consent_type&#39;</span><span class="p">:</span> <span class="n">consent_type</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                    <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">consent_capabilities</span><span class="p">[</span><span class="n">consent_type</span><span class="p">][</span><span class="s1">&#39;description&#39;</span><span class="p">]</span>
                <span class="p">})</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;user_id&#39;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
            <span class="s1">&#39;consent_status&#39;</span><span class="p">:</span> <span class="n">consent_status</span><span class="p">,</span>
            <span class="s1">&#39;data_processing_activities&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">processing_activities</span><span class="p">)),</span>
            <span class="s1">&#39;withdrawal_options&#39;</span><span class="p">:</span> <span class="n">withdrawal_options</span><span class="p">,</span>
            <span class="s1">&#39;last_updated&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_withdraw_previous_consent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">consent_type</span><span class="p">:</span> <span class="n">ConsentType</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Withdraw any existing consent for the specified type&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">user_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">consent_records</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="n">user_consents</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">consent_records</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span>
        <span class="n">relevant_consents</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">user_consents</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">consent_type</span> <span class="o">==</span> <span class="n">consent_type</span><span class="p">]</span>

        <span class="n">withdrawal_count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">consent</span> <span class="ow">in</span> <span class="n">relevant_consents</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">consent</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">ConsentStatus</span><span class="o">.</span><span class="n">GRANTED</span><span class="p">:</span>
                <span class="n">consent</span><span class="o">.</span><span class="n">withdraw</span><span class="p">()</span>
                <span class="n">withdrawal_count</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">return</span> <span class="n">withdrawal_count</span> <span class="o">&gt;</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_determine_lawful_basis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="n">ConsentType</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Determine lawful basis for processing under GDPR&quot;&quot;&quot;</span>

        <span class="n">lawful_basis</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">consent_type</span> <span class="ow">in</span> <span class="n">ConsentType</span><span class="p">:</span>
            <span class="n">check_result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_consent</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">consent_type</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">consent_type</span> <span class="o">==</span> <span class="n">ConsentType</span><span class="o">.</span><span class="n">NECESSARY</span><span class="p">:</span>
                <span class="n">lawful_basis</span><span class="p">[</span><span class="n">consent_type</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;legitimate_interest&quot;</span>
            <span class="k">elif</span> <span class="n">check_result</span><span class="p">[</span><span class="s1">&#39;has_consent&#39;</span><span class="p">]:</span>
                <span class="n">lawful_basis</span><span class="p">[</span><span class="n">consent_type</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;consent&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lawful_basis</span><span class="p">[</span><span class="n">consent_type</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>

        <span class="k">return</span> <span class="n">lawful_basis</span>

<span class="c1"># Demonstration of consent management</span>
<span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_consent_management</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Demonstrate comprehensive consent management&quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Consent Management Demo ===&quot;</span><span class="p">)</span>

    <span class="n">consent_manager</span> <span class="o">=</span> <span class="n">ConsentManager</span><span class="p">()</span>
    <span class="n">user_id</span> <span class="o">=</span> <span class="s2">&quot;student_12345&quot;</span>

    <span class="c1"># Step 1: Request consent from user</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;1. Requesting consent from user...&quot;</span><span class="p">)</span>

    <span class="n">consent_request</span> <span class="o">=</span> <span class="n">consent_manager</span><span class="o">.</span><span class="n">request_consent</span><span class="p">(</span>
        <span class="n">user_id</span><span class="p">,</span>
        <span class="p">[</span><span class="n">ConsentType</span><span class="o">.</span><span class="n">NECESSARY</span><span class="p">,</span> <span class="n">ConsentType</span><span class="o">.</span><span class="n">FUNCTIONAL</span><span class="p">,</span> <span class="n">ConsentType</span><span class="o">.</span><span class="n">ANALYTICS</span><span class="p">,</span> <span class="n">ConsentType</span><span class="o">.</span><span class="n">MARKETING</span><span class="p">],</span>
        <span class="s2">&quot;192.168.1.100&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Mozilla/5.0 Student Browser&quot;</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Consent request ID: </span><span class="si">{</span><span class="n">consent_request</span><span class="p">[</span><span class="s1">&#39;request_id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Available consent options:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="n">consent_request</span><span class="p">[</span><span class="s1">&#39;consent_options&#39;</span><span class="p">]:</span>
        <span class="n">required</span> <span class="o">=</span> <span class="s2">&quot; (REQUIRED)&quot;</span> <span class="k">if</span> <span class="n">option</span><span class="p">[</span><span class="s1">&#39;is_required&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="s2">&quot; (OPTIONAL)&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">option</span><span class="p">[</span><span class="s1">&#39;consent_type&#39;</span><span class="p">]</span><span class="si">}{</span><span class="n">required</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">option</span><span class="p">[</span><span class="s1">&#39;description&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Step 2: User makes consent decisions</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">2. User consent decisions...&quot;</span><span class="p">)</span>

    <span class="n">user_decisions</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">ConsentType</span><span class="o">.</span><span class="n">NECESSARY</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>    <span class="c1"># Required</span>
        <span class="n">ConsentType</span><span class="o">.</span><span class="n">FUNCTIONAL</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>   <span class="c1"># User chooses yes</span>
        <span class="n">ConsentType</span><span class="o">.</span><span class="n">ANALYTICS</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>    <span class="c1"># User chooses yes</span>
        <span class="n">ConsentType</span><span class="o">.</span><span class="n">MARKETING</span><span class="p">:</span> <span class="kc">False</span>    <span class="c1"># User chooses no</span>
    <span class="p">}</span>

    <span class="n">decision_result</span> <span class="o">=</span> <span class="n">consent_manager</span><span class="o">.</span><span class="n">record_consent_decision</span><span class="p">(</span>
        <span class="n">user_id</span><span class="p">,</span> <span class="n">user_decisions</span><span class="p">,</span> <span class="s2">&quot;192.168.1.100&quot;</span><span class="p">,</span> <span class="s2">&quot;Mozilla/5.0 Student Browser&quot;</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Consent recording successful: </span><span class="si">{</span><span class="n">decision_result</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Recorded consents:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">consent</span> <span class="ow">in</span> <span class="n">decision_result</span><span class="p">[</span><span class="s1">&#39;recorded_consents&#39;</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">consent</span><span class="p">[</span><span class="s1">&#39;consent_type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">consent</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Step 3: Check consent before processing</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">3. Checking consent before data processing...&quot;</span><span class="p">)</span>

    <span class="n">processing_scenarios</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="n">ConsentType</span><span class="o">.</span><span class="n">NECESSARY</span><span class="p">,</span> <span class="s2">&quot;User authentication&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">ConsentType</span><span class="o">.</span><span class="n">FUNCTIONAL</span><span class="p">,</span> <span class="s2">&quot;UI customization&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">ConsentType</span><span class="o">.</span><span class="n">ANALYTICS</span><span class="p">,</span> <span class="s2">&quot;Usage tracking&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">ConsentType</span><span class="o">.</span><span class="n">MARKETING</span><span class="p">,</span> <span class="s2">&quot;Promotional emails&quot;</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="k">for</span> <span class="n">consent_type</span><span class="p">,</span> <span class="n">activity</span> <span class="ow">in</span> <span class="n">processing_scenarios</span><span class="p">:</span>
        <span class="n">check_result</span> <span class="o">=</span> <span class="n">consent_manager</span><span class="o">.</span><span class="n">check_consent</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">consent_type</span><span class="p">)</span>
        <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;✅ ALLOWED&quot;</span> <span class="k">if</span> <span class="n">check_result</span><span class="p">[</span><span class="s1">&#39;can_process&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="s2">&quot;❌ BLOCKED&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">activity</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">check_result</span><span class="p">[</span><span class="s1">&#39;can_process&#39;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Reason: </span><span class="si">{</span><span class="n">check_result</span><span class="p">[</span><span class="s1">&#39;reason&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Step 4: User consent dashboard</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">4. User consent dashboard...&quot;</span><span class="p">)</span>

    <span class="n">dashboard</span> <span class="o">=</span> <span class="n">consent_manager</span><span class="o">.</span><span class="n">get_consent_dashboard</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current consent status:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">consent_type</span><span class="p">,</span> <span class="n">status</span> <span class="ow">in</span> <span class="n">dashboard</span><span class="p">[</span><span class="s1">&#39;consent_status&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">indicator</span> <span class="o">=</span> <span class="s2">&quot;✅&quot;</span> <span class="k">if</span> <span class="n">status</span><span class="p">[</span><span class="s1">&#39;has_consent&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="s2">&quot;❌&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">indicator</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">consent_type</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">status</span><span class="p">[</span><span class="s1">&#39;reason&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Active processing activities: </span><span class="si">{</span><span class="n">dashboard</span><span class="p">[</span><span class="s1">&#39;data_processing_activities&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Step 5: Withdraw consent</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">5. Withdrawing marketing consent...&quot;</span><span class="p">)</span>

    <span class="c1"># Note: User already denied marketing, but let&#39;s try withdrawing analytics</span>
    <span class="n">withdrawal_result</span> <span class="o">=</span> <span class="n">consent_manager</span><span class="o">.</span><span class="n">withdraw_consent</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">ConsentType</span><span class="o">.</span><span class="n">ANALYTICS</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Withdrawal successful: </span><span class="si">{</span><span class="n">withdrawal_result</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">withdrawal_result</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Message: </span><span class="si">{</span><span class="n">withdrawal_result</span><span class="p">[</span><span class="s1">&#39;message&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Check processing after withdrawal</span>
        <span class="n">updated_check</span> <span class="o">=</span> <span class="n">consent_manager</span><span class="o">.</span><span class="n">check_consent</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">ConsentType</span><span class="o">.</span><span class="n">ANALYTICS</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Analytics processing now allowed: </span><span class="si">{</span><span class="n">updated_check</span><span class="p">[</span><span class="s1">&#39;can_process&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre>
</div>
<h3 id="3-purpose-limitation-and-data-retention">3. Purpose Limitation and Data Retention<a class="headerlink" href="#3-purpose-limitation-and-data-retention" title="Permanent link">&para;</a></h3>
<p><strong>Purpose limitation</strong> ensures data is only used for the purposes it was collected for, and <strong>data retention</strong> policies ensure data is not kept longer than necessary.</p>
<div class="highlight python-template" data-fence-type="template" data-language="python">
<pre><code class="language-python"><span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">enum</span><span class="w"> </span><span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="k">class</span><span class="w"> </span><span class="nc">RetentionPolicy</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">policy_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data_category</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
                 <span class="n">retention_period</span><span class="p">:</span> <span class="n">timedelta</span><span class="p">,</span> <span class="n">legal_basis</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">policy_id</span> <span class="o">=</span> <span class="n">policy_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_category</span> <span class="o">=</span> <span class="n">data_category</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">retention_period</span> <span class="o">=</span> <span class="n">retention_period</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">legal_basis</span> <span class="o">=</span> <span class="n">legal_basis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">created_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">calculate_deletion_date</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection_date</span><span class="p">:</span> <span class="n">datetime</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">datetime</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate when data should be deleted&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">collection_date</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">retention_period</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">is_deletion_due</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">collection_date</span><span class="p">:</span> <span class="n">datetime</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if data should be deleted now&quot;&quot;&quot;</span>
        <span class="n">deletion_date</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calculate_deletion_date</span><span class="p">(</span><span class="n">collection_date</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">&gt;=</span> <span class="n">deletion_date</span>

<span class="k">class</span><span class="w"> </span><span class="nc">DataRetentionManager</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Define retention policies for different data types</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">retention_policies</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;account_data&#39;</span><span class="p">:</span> <span class="n">RetentionPolicy</span><span class="p">(</span>
                <span class="s1">&#39;account_001&#39;</span><span class="p">,</span>
                <span class="s1">&#39;account_data&#39;</span><span class="p">,</span>
                <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">2555</span><span class="p">),</span>  <span class="c1"># 7 years (legal requirement)</span>
                <span class="s1">&#39;Legal obligation - financial records retention&#39;</span>
            <span class="p">),</span>
            <span class="s1">&#39;usage_analytics&#39;</span><span class="p">:</span> <span class="n">RetentionPolicy</span><span class="p">(</span>
                <span class="s1">&#39;analytics_001&#39;</span><span class="p">,</span>
                <span class="s1">&#39;usage_analytics&#39;</span><span class="p">,</span>
                <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">90</span><span class="p">),</span>  <span class="c1"># 3 months</span>
                <span class="s1">&#39;Legitimate interest - service improvement&#39;</span>
            <span class="p">),</span>
            <span class="s1">&#39;marketing_data&#39;</span><span class="p">:</span> <span class="n">RetentionPolicy</span><span class="p">(</span>
                <span class="s1">&#39;marketing_001&#39;</span><span class="p">,</span>
                <span class="s1">&#39;marketing_data&#39;</span><span class="p">,</span>
                <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">730</span><span class="p">),</span>  <span class="c1"># 2 years</span>
                <span class="s1">&#39;Consent - promotional communications&#39;</span>
            <span class="p">),</span>
            <span class="s1">&#39;security_logs&#39;</span><span class="p">:</span> <span class="n">RetentionPolicy</span><span class="p">(</span>
                <span class="s1">&#39;security_001&#39;</span><span class="p">,</span>
                <span class="s1">&#39;security_logs&#39;</span><span class="p">,</span>
                <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">180</span><span class="p">),</span>  <span class="c1"># 6 months</span>
                <span class="s1">&#39;Legitimate interest - security monitoring&#39;</span>
            <span class="p">),</span>
            <span class="s1">&#39;session_data&#39;</span><span class="p">:</span> <span class="n">RetentionPolicy</span><span class="p">(</span>
                <span class="s1">&#39;session_001&#39;</span><span class="p">,</span>
                <span class="s1">&#39;session_data&#39;</span><span class="p">,</span>
                <span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">24</span><span class="p">),</span>  <span class="c1"># 24 hours</span>
                <span class="s1">&#39;Legitimate interest - service delivery&#39;</span>
            <span class="p">),</span>
            <span class="s1">&#39;support_tickets&#39;</span><span class="p">:</span> <span class="n">RetentionPolicy</span><span class="p">(</span>
                <span class="s1">&#39;support_001&#39;</span><span class="p">,</span>
                <span class="s1">&#39;support_tickets&#39;</span><span class="p">,</span>
                <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1095</span><span class="p">),</span>  <span class="c1"># 3 years</span>
                <span class="s1">&#39;Legitimate interest - customer service&#39;</span>
            <span class="p">)</span>
        <span class="p">}</span>

        <span class="c1"># Track data collection and purposes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_inventory</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">record_data_collection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
                             <span class="n">purpose</span><span class="p">:</span> <span class="n">PurposeLimitation</span><span class="p">,</span> <span class="n">data_content</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Record when data is collected and for what purpose&quot;&quot;&quot;</span>

        <span class="n">record_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">data_type</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">timestamp</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="n">user_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_inventory</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_inventory</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">collection_record</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;record_id&#39;</span><span class="p">:</span> <span class="n">record_id</span><span class="p">,</span>
            <span class="s1">&#39;user_id&#39;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
            <span class="s1">&#39;data_type&#39;</span><span class="p">:</span> <span class="n">data_type</span><span class="p">,</span>
            <span class="s1">&#39;purpose&#39;</span><span class="p">:</span> <span class="n">purpose</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="s1">&#39;collection_date&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
            <span class="s1">&#39;data_fields&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">data_content</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
            <span class="s1">&#39;retention_policy&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">retention_policies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">data_type</span><span class="p">),</span>
            <span class="s1">&#39;deletion_scheduled&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;deleted&#39;</span><span class="p">:</span> <span class="kc">False</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data_inventory</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">collection_record</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">record_id</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">check_purpose_compliance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data_type</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
                               <span class="n">requested_purpose</span><span class="p">:</span> <span class="n">PurposeLimitation</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if data can be used for the requested purpose&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">user_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_inventory</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;compliant&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;reason&#39;</span><span class="p">:</span> <span class="s1">&#39;No data records found for user&#39;</span>
            <span class="p">}</span>

        <span class="n">user_records</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_inventory</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span>
        <span class="n">relevant_records</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">user_records</span> <span class="k">if</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;data_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">data_type</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;deleted&#39;</span><span class="p">]]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">relevant_records</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;compliant&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;reason&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;No active </span><span class="si">{</span><span class="n">data_type</span><span class="si">}</span><span class="s1"> records found&#39;</span>
            <span class="p">}</span>

        <span class="c1"># Check if any record allows this purpose</span>
        <span class="n">allowed_purposes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">relevant_records</span><span class="p">:</span>
            <span class="n">original_purpose</span> <span class="o">=</span> <span class="n">PurposeLimitation</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="s1">&#39;purpose&#39;</span><span class="p">])</span>
            <span class="n">allowed_purposes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">original_purpose</span><span class="p">)</span>

            <span class="c1"># Define compatible purposes</span>
            <span class="n">compatible_purposes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_compatible_purposes</span><span class="p">(</span><span class="n">original_purpose</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">requested_purpose</span> <span class="ow">in</span> <span class="n">compatible_purposes</span><span class="p">:</span>
                <span class="k">return</span> <span class="p">{</span>
                    <span class="s1">&#39;compliant&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
                    <span class="s1">&#39;original_purpose&#39;</span><span class="p">:</span> <span class="n">original_purpose</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                    <span class="s1">&#39;requested_purpose&#39;</span><span class="p">:</span> <span class="n">requested_purpose</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                    <span class="s1">&#39;record_id&#39;</span><span class="p">:</span> <span class="n">record</span><span class="p">[</span><span class="s1">&#39;record_id&#39;</span><span class="p">]</span>
                <span class="p">}</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;compliant&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;reason&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Purpose </span><span class="si">{</span><span class="n">requested_purpose</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s1"> not compatible with collection purposes: </span><span class="si">{</span><span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">value</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">p</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">allowed_purposes</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">schedule_data_deletion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Schedule data for deletion based on retention policies&quot;&quot;&quot;</span>

        <span class="n">deletion_schedule</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="n">users_to_check</span> <span class="o">=</span> <span class="p">[</span><span class="n">user_id</span><span class="p">]</span> <span class="k">if</span> <span class="n">user_id</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_inventory</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">uid</span> <span class="ow">in</span> <span class="n">users_to_check</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">uid</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_inventory</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="n">user_records</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_inventory</span><span class="p">[</span><span class="n">uid</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">user_records</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">record</span><span class="p">[</span><span class="s1">&#39;deleted&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="n">record</span><span class="p">[</span><span class="s1">&#39;deletion_scheduled&#39;</span><span class="p">]:</span>
                    <span class="k">continue</span>

                <span class="n">retention_policy</span> <span class="o">=</span> <span class="n">record</span><span class="p">[</span><span class="s1">&#39;retention_policy&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">retention_policy</span> <span class="ow">and</span> <span class="n">retention_policy</span><span class="o">.</span><span class="n">is_deletion_due</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="s1">&#39;collection_date&#39;</span><span class="p">]):</span>
                    <span class="n">record</span><span class="p">[</span><span class="s1">&#39;deletion_scheduled&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

                    <span class="n">deletion_schedule</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                        <span class="s1">&#39;user_id&#39;</span><span class="p">:</span> <span class="n">uid</span><span class="p">,</span>
                        <span class="s1">&#39;record_id&#39;</span><span class="p">:</span> <span class="n">record</span><span class="p">[</span><span class="s1">&#39;record_id&#39;</span><span class="p">],</span>
                        <span class="s1">&#39;data_type&#39;</span><span class="p">:</span> <span class="n">record</span><span class="p">[</span><span class="s1">&#39;data_type&#39;</span><span class="p">],</span>
                        <span class="s1">&#39;collection_date&#39;</span><span class="p">:</span> <span class="n">record</span><span class="p">[</span><span class="s1">&#39;collection_date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
                        <span class="s1">&#39;deletion_due_date&#39;</span><span class="p">:</span> <span class="n">retention_policy</span><span class="o">.</span><span class="n">calculate_deletion_date</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="s1">&#39;collection_date&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
                        <span class="s1">&#39;legal_basis&#39;</span><span class="p">:</span> <span class="n">retention_policy</span><span class="o">.</span><span class="n">legal_basis</span>
                    <span class="p">})</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;deletion_scheduled_count&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">deletion_schedule</span><span class="p">),</span>
            <span class="s1">&#39;deletion_schedule&#39;</span><span class="p">:</span> <span class="n">deletion_schedule</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">execute_data_deletion</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record_ids</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Execute scheduled data deletions&quot;&quot;&quot;</span>

        <span class="n">deleted_records</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">not_found_records</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">record_id</span> <span class="ow">in</span> <span class="n">record_ids</span><span class="p">:</span>
            <span class="n">found</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="k">for</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">user_records</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_inventory</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">user_records</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">record</span><span class="p">[</span><span class="s1">&#39;record_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">record_id</span> <span class="ow">and</span> <span class="n">record</span><span class="p">[</span><span class="s1">&#39;deletion_scheduled&#39;</span><span class="p">]:</span>
                        <span class="n">record</span><span class="p">[</span><span class="s1">&#39;deleted&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="n">record</span><span class="p">[</span><span class="s1">&#39;deletion_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

                        <span class="n">deleted_records</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
                            <span class="s1">&#39;record_id&#39;</span><span class="p">:</span> <span class="n">record_id</span><span class="p">,</span>
                            <span class="s1">&#39;user_id&#39;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
                            <span class="s1">&#39;data_type&#39;</span><span class="p">:</span> <span class="n">record</span><span class="p">[</span><span class="s1">&#39;data_type&#39;</span><span class="p">],</span>
                            <span class="s1">&#39;deletion_date&#39;</span><span class="p">:</span> <span class="n">record</span><span class="p">[</span><span class="s1">&#39;deletion_date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
                        <span class="p">})</span>

                        <span class="n">found</span> <span class="o">=</span> <span class="kc">True</span>
                        <span class="k">break</span>

                <span class="k">if</span> <span class="n">found</span><span class="p">:</span>
                    <span class="k">break</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
                <span class="n">not_found_records</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">record_id</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;deleted_count&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">deleted_records</span><span class="p">),</span>
            <span class="s1">&#39;deleted_records&#39;</span><span class="p">:</span> <span class="n">deleted_records</span><span class="p">,</span>
            <span class="s1">&#39;not_found_records&#39;</span><span class="p">:</span> <span class="n">not_found_records</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_data_inventory_report</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate data inventory report for user&quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">user_id</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_inventory</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;user_id&#39;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
                <span class="s1">&#39;total_records&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s1">&#39;active_records&#39;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s1">&#39;scheduled_deletions&#39;</span><span class="p">:</span> <span class="p">[],</span>
                <span class="s1">&#39;deleted_records&#39;</span><span class="p">:</span> <span class="p">[]</span>
            <span class="p">}</span>

        <span class="n">user_records</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_inventory</span><span class="p">[</span><span class="n">user_id</span><span class="p">]</span>

        <span class="n">active_records</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">scheduled_deletions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">deleted_records</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">user_records</span><span class="p">:</span>
            <span class="n">record_summary</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;record_id&#39;</span><span class="p">:</span> <span class="n">record</span><span class="p">[</span><span class="s1">&#39;record_id&#39;</span><span class="p">],</span>
                <span class="s1">&#39;data_type&#39;</span><span class="p">:</span> <span class="n">record</span><span class="p">[</span><span class="s1">&#39;data_type&#39;</span><span class="p">],</span>
                <span class="s1">&#39;purpose&#39;</span><span class="p">:</span> <span class="n">record</span><span class="p">[</span><span class="s1">&#39;purpose&#39;</span><span class="p">],</span>
                <span class="s1">&#39;collection_date&#39;</span><span class="p">:</span> <span class="n">record</span><span class="p">[</span><span class="s1">&#39;collection_date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
                <span class="s1">&#39;data_fields&#39;</span><span class="p">:</span> <span class="n">record</span><span class="p">[</span><span class="s1">&#39;data_fields&#39;</span><span class="p">]</span>
            <span class="p">}</span>

            <span class="k">if</span> <span class="n">record</span><span class="p">[</span><span class="s1">&#39;deleted&#39;</span><span class="p">]:</span>
                <span class="n">record_summary</span><span class="p">[</span><span class="s1">&#39;deletion_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;deletion_date&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span> <span class="k">if</span> <span class="n">record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;deletion_date&#39;</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;&#39;</span>
                <span class="n">deleted_records</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">record_summary</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">record</span><span class="p">[</span><span class="s1">&#39;deletion_scheduled&#39;</span><span class="p">]:</span>
                <span class="n">retention_policy</span> <span class="o">=</span> <span class="n">record</span><span class="p">[</span><span class="s1">&#39;retention_policy&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">retention_policy</span><span class="p">:</span>
                    <span class="n">record_summary</span><span class="p">[</span><span class="s1">&#39;scheduled_deletion_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">retention_policy</span><span class="o">.</span><span class="n">calculate_deletion_date</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="s1">&#39;collection_date&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
                <span class="n">scheduled_deletions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">record_summary</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">retention_policy</span> <span class="o">=</span> <span class="n">record</span><span class="p">[</span><span class="s1">&#39;retention_policy&#39;</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">retention_policy</span><span class="p">:</span>
                    <span class="n">record_summary</span><span class="p">[</span><span class="s1">&#39;retention_until&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">retention_policy</span><span class="o">.</span><span class="n">calculate_deletion_date</span><span class="p">(</span><span class="n">record</span><span class="p">[</span><span class="s1">&#39;collection_date&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
                    <span class="n">record_summary</span><span class="p">[</span><span class="s1">&#39;retention_policy&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">retention_policy</span><span class="o">.</span><span class="n">legal_basis</span>
                <span class="n">active_records</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">record_summary</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;user_id&#39;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
            <span class="s1">&#39;total_records&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">user_records</span><span class="p">),</span>
            <span class="s1">&#39;active_records&#39;</span><span class="p">:</span> <span class="n">active_records</span><span class="p">,</span>
            <span class="s1">&#39;scheduled_deletions&#39;</span><span class="p">:</span> <span class="n">scheduled_deletions</span><span class="p">,</span>
            <span class="s1">&#39;deleted_records&#39;</span><span class="p">:</span> <span class="n">deleted_records</span><span class="p">,</span>
            <span class="s1">&#39;report_generated&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_get_compatible_purposes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">original_purpose</span><span class="p">:</span> <span class="n">PurposeLimitation</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">PurposeLimitation</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Define which purposes are compatible with each other&quot;&quot;&quot;</span>

        <span class="c1"># Define purpose compatibility matrix</span>
        <span class="n">compatibility_matrix</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">PurposeLimitation</span><span class="o">.</span><span class="n">ACCOUNT_MANAGEMENT</span><span class="p">:</span> <span class="p">[</span>
                <span class="n">PurposeLimitation</span><span class="o">.</span><span class="n">ACCOUNT_MANAGEMENT</span><span class="p">,</span>
                <span class="n">PurposeLimitation</span><span class="o">.</span><span class="n">SECURITY</span>
            <span class="p">],</span>
            <span class="n">PurposeLimitation</span><span class="o">.</span><span class="n">SERVICE_DELIVERY</span><span class="p">:</span> <span class="p">[</span>
                <span class="n">PurposeLimitation</span><span class="o">.</span><span class="n">SERVICE_DELIVERY</span><span class="p">,</span>
                <span class="n">PurposeLimitation</span><span class="o">.</span><span class="n">SECURITY</span>
            <span class="p">],</span>
            <span class="n">PurposeLimitation</span><span class="o">.</span><span class="n">SECURITY</span><span class="p">:</span> <span class="p">[</span>
                <span class="n">PurposeLimitation</span><span class="o">.</span><span class="n">SECURITY</span><span class="p">,</span>
                <span class="n">PurposeLimitation</span><span class="o">.</span><span class="n">LEGAL_COMPLIANCE</span>
            <span class="p">],</span>
            <span class="n">PurposeLimitation</span><span class="o">.</span><span class="n">ANALYTICS</span><span class="p">:</span> <span class="p">[</span>
                <span class="n">PurposeLimitation</span><span class="o">.</span><span class="n">ANALYTICS</span>
            <span class="p">],</span>
            <span class="n">PurposeLimitation</span><span class="o">.</span><span class="n">MARKETING</span><span class="p">:</span> <span class="p">[</span>
                <span class="n">PurposeLimitation</span><span class="o">.</span><span class="n">MARKETING</span>
            <span class="p">],</span>
            <span class="n">PurposeLimitation</span><span class="o">.</span><span class="n">LEGAL_COMPLIANCE</span><span class="p">:</span> <span class="p">[</span>
                <span class="n">PurposeLimitation</span><span class="o">.</span><span class="n">LEGAL_COMPLIANCE</span><span class="p">,</span>
                <span class="n">PurposeLimitation</span><span class="o">.</span><span class="n">SECURITY</span>
            <span class="p">]</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">compatibility_matrix</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">original_purpose</span><span class="p">,</span> <span class="p">[</span><span class="n">original_purpose</span><span class="p">])</span>

<span class="c1"># Demonstration of purpose limitation and retention</span>
<span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_purpose_limitation_and_retention</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Demonstrate purpose limitation and data retention management&quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Purpose Limitation and Data Retention Demo ===&quot;</span><span class="p">)</span>

    <span class="n">retention_manager</span> <span class="o">=</span> <span class="n">DataRetentionManager</span><span class="p">()</span>
    <span class="n">user_id</span> <span class="o">=</span> <span class="s2">&quot;student_67890&quot;</span>

    <span class="c1"># Step 1: Record data collection for different purposes</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;1. Recording data collection for different purposes...&quot;</span><span class="p">)</span>

    <span class="c1"># Collect account data</span>
    <span class="n">account_record_id</span> <span class="o">=</span> <span class="n">retention_manager</span><span class="o">.</span><span class="n">record_data_collection</span><span class="p">(</span>
        <span class="n">user_id</span><span class="p">,</span>
        <span class="s1">&#39;account_data&#39;</span><span class="p">,</span>
        <span class="n">PurposeLimitation</span><span class="o">.</span><span class="n">ACCOUNT_MANAGEMENT</span><span class="p">,</span>
        <span class="p">{</span><span class="s1">&#39;username&#39;</span><span class="p">:</span> <span class="s1">&#39;student67890&#39;</span><span class="p">,</span> <span class="s1">&#39;email&#39;</span><span class="p">:</span> <span class="s1">&#39;student@school.edu&#39;</span><span class="p">,</span> <span class="s1">&#39;password_hash&#39;</span><span class="p">:</span> <span class="s1">&#39;hashed&#39;</span><span class="p">}</span>
    <span class="p">)</span>

    <span class="c1"># Collect analytics data</span>
    <span class="n">analytics_record_id</span> <span class="o">=</span> <span class="n">retention_manager</span><span class="o">.</span><span class="n">record_data_collection</span><span class="p">(</span>
        <span class="n">user_id</span><span class="p">,</span>
        <span class="s1">&#39;usage_analytics&#39;</span><span class="p">,</span>
        <span class="n">PurposeLimitation</span><span class="o">.</span><span class="n">ANALYTICS</span><span class="p">,</span>
        <span class="p">{</span><span class="s1">&#39;page_views&#39;</span><span class="p">:</span> <span class="mi">150</span><span class="p">,</span> <span class="s1">&#39;feature_usage&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;login&#39;</span><span class="p">:</span> <span class="mi">45</span><span class="p">,</span> <span class="s1">&#39;homework&#39;</span><span class="p">:</span> <span class="mi">30</span><span class="p">}}</span>
    <span class="p">)</span>

    <span class="c1"># Collect marketing data</span>
    <span class="n">marketing_record_id</span> <span class="o">=</span> <span class="n">retention_manager</span><span class="o">.</span><span class="n">record_data_collection</span><span class="p">(</span>
        <span class="n">user_id</span><span class="p">,</span>
        <span class="s1">&#39;marketing_data&#39;</span><span class="p">,</span>
        <span class="n">PurposeLimitation</span><span class="o">.</span><span class="n">MARKETING</span><span class="p">,</span>
        <span class="p">{</span><span class="s1">&#39;email_preferences&#39;</span><span class="p">:</span> <span class="s1">&#39;weekly&#39;</span><span class="p">,</span> <span class="s1">&#39;interests&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;math&#39;</span><span class="p">,</span> <span class="s1">&#39;science&#39;</span><span class="p">]}</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Recorded account data: </span><span class="si">{</span><span class="n">account_record_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Recorded analytics data: </span><span class="si">{</span><span class="n">analytics_record_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Recorded marketing data: </span><span class="si">{</span><span class="n">marketing_record_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Step 2: Test purpose limitation compliance</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">2. Testing purpose limitation compliance...&quot;</span><span class="p">)</span>

    <span class="n">test_scenarios</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s1">&#39;account_data&#39;</span><span class="p">,</span> <span class="n">PurposeLimitation</span><span class="o">.</span><span class="n">ACCOUNT_MANAGEMENT</span><span class="p">,</span> <span class="s2">&quot;User profile display&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;account_data&#39;</span><span class="p">,</span> <span class="n">PurposeLimitation</span><span class="o">.</span><span class="n">SECURITY</span><span class="p">,</span> <span class="s2">&quot;Security audit&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;account_data&#39;</span><span class="p">,</span> <span class="n">PurposeLimitation</span><span class="o">.</span><span class="n">MARKETING</span><span class="p">,</span> <span class="s2">&quot;Email promotion&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;usage_analytics&#39;</span><span class="p">,</span> <span class="n">PurposeLimitation</span><span class="o">.</span><span class="n">ANALYTICS</span><span class="p">,</span> <span class="s2">&quot;Service improvement&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;usage_analytics&#39;</span><span class="p">,</span> <span class="n">PurposeLimitation</span><span class="o">.</span><span class="n">MARKETING</span><span class="p">,</span> <span class="s2">&quot;Behavioral targeting&quot;</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="k">for</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">purpose</span><span class="p">,</span> <span class="n">description</span> <span class="ow">in</span> <span class="n">test_scenarios</span><span class="p">:</span>
        <span class="n">compliance_check</span> <span class="o">=</span> <span class="n">retention_manager</span><span class="o">.</span><span class="n">check_purpose_compliance</span><span class="p">(</span><span class="n">user_id</span><span class="p">,</span> <span class="n">data_type</span><span class="p">,</span> <span class="n">purpose</span><span class="p">)</span>
        <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;✅ COMPLIANT&quot;</span> <span class="k">if</span> <span class="n">compliance_check</span><span class="p">[</span><span class="s1">&#39;compliant&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="s2">&quot;❌ NON-COMPLIANT&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">description</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">compliance_check</span><span class="p">[</span><span class="s1">&#39;compliant&#39;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Reason: </span><span class="si">{</span><span class="n">compliance_check</span><span class="p">[</span><span class="s1">&#39;reason&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Step 3: Generate data inventory report</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">3. Data inventory report...&quot;</span><span class="p">)</span>

    <span class="n">inventory_report</span> <span class="o">=</span> <span class="n">retention_manager</span><span class="o">.</span><span class="n">get_data_inventory_report</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Total records: </span><span class="si">{</span><span class="n">inventory_report</span><span class="p">[</span><span class="s1">&#39;total_records&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Active records:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">record</span> <span class="ow">in</span> <span class="n">inventory_report</span><span class="p">[</span><span class="s1">&#39;active_records&#39;</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">record</span><span class="p">[</span><span class="s1">&#39;data_type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> (Purpose: </span><span class="si">{</span><span class="n">record</span><span class="p">[</span><span class="s1">&#39;purpose&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Collected: </span><span class="si">{</span><span class="n">record</span><span class="p">[</span><span class="s1">&#39;collection_date&#39;</span><span class="p">][:</span><span class="mi">10</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Retention until: </span><span class="si">{</span><span class="n">record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;retention_until&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;N/A&#39;</span><span class="p">)[:</span><span class="mi">10</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Legal basis: </span><span class="si">{</span><span class="n">record</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;retention_policy&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Not specified&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Step 4: Simulate passage of time and check deletions</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">4. Simulating data retention and deletion...&quot;</span><span class="p">)</span>

    <span class="c1"># For demo purposes, let&#39;s manually trigger deletion check</span>
    <span class="n">deletion_schedule</span> <span class="o">=</span> <span class="n">retention_manager</span><span class="o">.</span><span class="n">schedule_data_deletion</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Records scheduled for deletion: </span><span class="si">{</span><span class="n">deletion_schedule</span><span class="p">[</span><span class="s1">&#39;deletion_scheduled_count&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">deletion_schedule</span><span class="p">[</span><span class="s1">&#39;deletion_schedule&#39;</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Deletion schedule:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">deletion_schedule</span><span class="p">[</span><span class="s1">&#39;deletion_schedule&#39;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;data_type&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">: Due </span><span class="si">{</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;deletion_due_date&#39;</span><span class="p">][:</span><span class="mi">10</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Legal basis: </span><span class="si">{</span><span class="n">item</span><span class="p">[</span><span class="s1">&#39;legal_basis&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre>
</div>
<h3 id="4-privacy-impact-assessments">4. Privacy Impact Assessments<a class="headerlink" href="#4-privacy-impact-assessments" title="Permanent link">&para;</a></h3>
<p><strong>Privacy Impact Assessments (PIAs)</strong> systematically evaluate how personal data processing activities affect individual privacy.</p>
<div class="highlight python-template" data-fence-type="template" data-language="python">
<pre><code class="language-python"><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Set</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">enum</span><span class="w"> </span><span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">json</span>

<span class="k">class</span><span class="w"> </span><span class="nc">RiskLevel</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">LOW</span> <span class="o">=</span> <span class="s2">&quot;low&quot;</span>
    <span class="n">MEDIUM</span> <span class="o">=</span> <span class="s2">&quot;medium&quot;</span>
    <span class="n">HIGH</span> <span class="o">=</span> <span class="s2">&quot;high&quot;</span>
    <span class="n">CRITICAL</span> <span class="o">=</span> <span class="s2">&quot;critical&quot;</span>

<span class="k">class</span><span class="w"> </span><span class="nc">DataSensitivity</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">PUBLIC</span> <span class="o">=</span> <span class="s2">&quot;public&quot;</span>
    <span class="n">INTERNAL</span> <span class="o">=</span> <span class="s2">&quot;internal&quot;</span>
    <span class="n">CONFIDENTIAL</span> <span class="o">=</span> <span class="s2">&quot;confidential&quot;</span>
    <span class="n">RESTRICTED</span> <span class="o">=</span> <span class="s2">&quot;restricted&quot;</span>

<span class="k">class</span><span class="w"> </span><span class="nc">PrivacyRisk</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">risk_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">description</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">likelihood</span><span class="p">:</span> <span class="n">RiskLevel</span><span class="p">,</span> 
                 <span class="n">impact</span><span class="p">:</span> <span class="n">RiskLevel</span><span class="p">,</span> <span class="n">data_types_affected</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">risk_id</span> <span class="o">=</span> <span class="n">risk_id</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">description</span> <span class="o">=</span> <span class="n">description</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span> <span class="o">=</span> <span class="n">likelihood</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">impact</span> <span class="o">=</span> <span class="n">impact</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_types_affected</span> <span class="o">=</span> <span class="n">data_types_affected</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">overall_risk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calculate_overall_risk</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mitigation_measures</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">residual_risk</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">overall_risk</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_calculate_overall_risk</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">RiskLevel</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculate overall risk based on likelihood and impact&quot;&quot;&quot;</span>
        <span class="n">risk_matrix</span> <span class="o">=</span> <span class="p">{</span>
            <span class="p">(</span><span class="n">RiskLevel</span><span class="o">.</span><span class="n">LOW</span><span class="p">,</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">LOW</span><span class="p">):</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">LOW</span><span class="p">,</span>
            <span class="p">(</span><span class="n">RiskLevel</span><span class="o">.</span><span class="n">LOW</span><span class="p">,</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">):</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">LOW</span><span class="p">,</span>
            <span class="p">(</span><span class="n">RiskLevel</span><span class="o">.</span><span class="n">LOW</span><span class="p">,</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">HIGH</span><span class="p">):</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>
            <span class="p">(</span><span class="n">RiskLevel</span><span class="o">.</span><span class="n">LOW</span><span class="p">,</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">):</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>
            <span class="p">(</span><span class="n">RiskLevel</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">LOW</span><span class="p">):</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">LOW</span><span class="p">,</span>
            <span class="p">(</span><span class="n">RiskLevel</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">):</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>
            <span class="p">(</span><span class="n">RiskLevel</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">HIGH</span><span class="p">):</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
            <span class="p">(</span><span class="n">RiskLevel</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">):</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
            <span class="p">(</span><span class="n">RiskLevel</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">LOW</span><span class="p">):</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>
            <span class="p">(</span><span class="n">RiskLevel</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">):</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
            <span class="p">(</span><span class="n">RiskLevel</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">HIGH</span><span class="p">):</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
            <span class="p">(</span><span class="n">RiskLevel</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">):</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">,</span>
            <span class="p">(</span><span class="n">RiskLevel</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">,</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">LOW</span><span class="p">):</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>
            <span class="p">(</span><span class="n">RiskLevel</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">,</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">):</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
            <span class="p">(</span><span class="n">RiskLevel</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">,</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">HIGH</span><span class="p">):</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">,</span>
            <span class="p">(</span><span class="n">RiskLevel</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">,</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">):</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="n">risk_matrix</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">likelihood</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">impact</span><span class="p">),</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">HIGH</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_mitigation_measure</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">measure</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">risk_reduction</span><span class="p">:</span> <span class="n">RiskLevel</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add mitigation measure and update residual risk&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mitigation_measures</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;measure&#39;</span><span class="p">:</span> <span class="n">measure</span><span class="p">,</span>
            <span class="s1">&#39;risk_reduction&#39;</span><span class="p">:</span> <span class="n">risk_reduction</span><span class="p">,</span>
            <span class="s1">&#39;implemented&#39;</span><span class="p">:</span> <span class="kc">False</span>
        <span class="p">})</span>

        <span class="c1"># Simplified residual risk calculation</span>
        <span class="k">if</span> <span class="n">risk_reduction</span> <span class="o">==</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">HIGH</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">residual_risk</span> <span class="ow">in</span> <span class="p">[</span><span class="n">RiskLevel</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">]:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">residual_risk</span> <span class="o">==</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">residual_risk</span> <span class="o">=</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">HIGH</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">residual_risk</span> <span class="o">=</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">MEDIUM</span>

<span class="k">class</span><span class="w"> </span><span class="nc">PrivacyImpactAssessment</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">project_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">assessor</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assessment_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;PIA_</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">_%H%M%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span> <span class="o">=</span> <span class="n">project_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assessor</span> <span class="o">=</span> <span class="n">assessor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assessment_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_processing_activities</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">identified_risks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stakeholders</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">legal_basis_analysis</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">consultation_required</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_data_processing_activity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">activity_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">purpose</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                   <span class="n">data_types</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">data_subjects</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                                   <span class="n">data_sources</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">data_recipients</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
                                   <span class="n">retention_period</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">data_sensitivity</span><span class="p">:</span> <span class="n">DataSensitivity</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add data processing activity to assessment&quot;&quot;&quot;</span>

        <span class="n">activity</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;activity_id&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;DPA_</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_processing_activities</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">:</span><span class="s2">03d</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s1">&#39;activity_name&#39;</span><span class="p">:</span> <span class="n">activity_name</span><span class="p">,</span>
            <span class="s1">&#39;purpose&#39;</span><span class="p">:</span> <span class="n">purpose</span><span class="p">,</span>
            <span class="s1">&#39;data_types&#39;</span><span class="p">:</span> <span class="n">data_types</span><span class="p">,</span>
            <span class="s1">&#39;data_subjects&#39;</span><span class="p">:</span> <span class="n">data_subjects</span><span class="p">,</span>
            <span class="s1">&#39;data_sources&#39;</span><span class="p">:</span> <span class="n">data_sources</span><span class="p">,</span>
            <span class="s1">&#39;data_recipients&#39;</span><span class="p">:</span> <span class="n">data_recipients</span><span class="p">,</span>
            <span class="s1">&#39;retention_period&#39;</span><span class="p">:</span> <span class="n">retention_period</span><span class="p">,</span>
            <span class="s1">&#39;data_sensitivity&#39;</span><span class="p">:</span> <span class="n">data_sensitivity</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="s1">&#39;cross_border_transfers&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s1">&#39;automated_decision_making&#39;</span><span class="p">:</span> <span class="kc">False</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data_processing_activities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">activity</span><span class="p">)</span>

        <span class="c1"># Automatically assess basic risks</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_assess_activity_risks</span><span class="p">(</span><span class="n">activity</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">activity</span><span class="p">[</span><span class="s1">&#39;activity_id&#39;</span><span class="p">]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_assess_activity_risks</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">activity</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Automatically assess privacy risks for processing activity&quot;&quot;&quot;</span>

        <span class="c1"># Risk 1: Data breach exposure</span>
        <span class="k">if</span> <span class="n">activity</span><span class="p">[</span><span class="s1">&#39;data_sensitivity&#39;</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;confidential&#39;</span><span class="p">,</span> <span class="s1">&#39;restricted&#39;</span><span class="p">]:</span>
            <span class="n">breach_risk</span> <span class="o">=</span> <span class="n">PrivacyRisk</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;BREACH_</span><span class="si">{</span><span class="n">activity</span><span class="p">[</span><span class="s1">&#39;activity_id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;Risk of data breach exposing </span><span class="si">{</span><span class="n">activity</span><span class="p">[</span><span class="s1">&#39;data_sensitivity&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> data in </span><span class="si">{</span><span class="n">activity</span><span class="p">[</span><span class="s1">&#39;activity_name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">RiskLevel</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>
                <span class="n">RiskLevel</span><span class="o">.</span><span class="n">HIGH</span> <span class="k">if</span> <span class="n">activity</span><span class="p">[</span><span class="s1">&#39;data_sensitivity&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;restricted&#39;</span> <span class="k">else</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>
                <span class="n">activity</span><span class="p">[</span><span class="s1">&#39;data_types&#39;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">identified_risks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">breach_risk</span><span class="p">)</span>

        <span class="c1"># Risk 2: Unauthorized access</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">activity</span><span class="p">[</span><span class="s1">&#39;data_recipients&#39;</span><span class="p">])</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">access_risk</span> <span class="o">=</span> <span class="n">PrivacyRisk</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;ACCESS_</span><span class="si">{</span><span class="n">activity</span><span class="p">[</span><span class="s1">&#39;activity_id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;Risk of unauthorized access due to multiple data recipients in </span><span class="si">{</span><span class="n">activity</span><span class="p">[</span><span class="s1">&#39;activity_name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">RiskLevel</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>
                <span class="n">RiskLevel</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>
                <span class="n">activity</span><span class="p">[</span><span class="s1">&#39;data_types&#39;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">identified_risks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">access_risk</span><span class="p">)</span>

        <span class="c1"># Risk 3: Data retention</span>
        <span class="k">if</span> <span class="s1">&#39;indefinite&#39;</span> <span class="ow">in</span> <span class="n">activity</span><span class="p">[</span><span class="s1">&#39;retention_period&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="n">retention_risk</span> <span class="o">=</span> <span class="n">PrivacyRisk</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;RETENTION_</span><span class="si">{</span><span class="n">activity</span><span class="p">[</span><span class="s1">&#39;activity_id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;Risk of excessive data retention in </span><span class="si">{</span><span class="n">activity</span><span class="p">[</span><span class="s1">&#39;activity_name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">RiskLevel</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span>
                <span class="n">RiskLevel</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>
                <span class="n">activity</span><span class="p">[</span><span class="s1">&#39;data_types&#39;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">identified_risks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">retention_risk</span><span class="p">)</span>

        <span class="c1"># Risk 4: Purpose creep</span>
        <span class="k">if</span> <span class="s1">&#39;marketing&#39;</span> <span class="ow">in</span> <span class="n">activity</span><span class="p">[</span><span class="s1">&#39;purpose&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">and</span> <span class="nb">any</span><span class="p">(</span><span class="s1">&#39;personal&#39;</span> <span class="ow">in</span> <span class="n">dt</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">dt</span> <span class="ow">in</span> <span class="n">activity</span><span class="p">[</span><span class="s1">&#39;data_types&#39;</span><span class="p">]):</span>
            <span class="n">purpose_risk</span> <span class="o">=</span> <span class="n">PrivacyRisk</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;PURPOSE_</span><span class="si">{</span><span class="n">activity</span><span class="p">[</span><span class="s1">&#39;activity_id&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;Risk of purpose creep in marketing activities for </span><span class="si">{</span><span class="n">activity</span><span class="p">[</span><span class="s1">&#39;activity_name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">RiskLevel</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>
                <span class="n">RiskLevel</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">,</span>
                <span class="n">activity</span><span class="p">[</span><span class="s1">&#39;data_types&#39;</span><span class="p">]</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">identified_risks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">purpose_risk</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">assess_legal_basis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">activity_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">proposed_legal_basis</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                          <span class="n">justification</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Assess legal basis for processing activity&quot;&quot;&quot;</span>

        <span class="n">valid_legal_bases</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;consent&#39;</span><span class="p">,</span>
            <span class="s1">&#39;contract&#39;</span><span class="p">,</span>
            <span class="s1">&#39;legal_obligation&#39;</span><span class="p">,</span>
            <span class="s1">&#39;vital_interests&#39;</span><span class="p">,</span>
            <span class="s1">&#39;public_task&#39;</span><span class="p">,</span>
            <span class="s1">&#39;legitimate_interests&#39;</span>
        <span class="p">]</span>

        <span class="k">if</span> <span class="n">proposed_legal_basis</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">valid_legal_bases</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;valid&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Invalid legal basis. Must be one of: </span><span class="si">{</span><span class="n">valid_legal_bases</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">}</span>

        <span class="c1"># Find the activity</span>
        <span class="n">activity</span> <span class="o">=</span> <span class="nb">next</span><span class="p">((</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_processing_activities</span> <span class="k">if</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;activity_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">activity_id</span><span class="p">),</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">activity</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;valid&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Activity </span><span class="si">{</span><span class="n">activity_id</span><span class="si">}</span><span class="s2"> not found&quot;</span>
            <span class="p">}</span>

        <span class="c1"># Assess appropriateness of legal basis</span>
        <span class="n">assessment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluate_legal_basis_appropriateness</span><span class="p">(</span><span class="n">activity</span><span class="p">,</span> <span class="n">proposed_legal_basis</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">legal_basis_analysis</span><span class="p">[</span><span class="n">activity_id</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;proposed_legal_basis&#39;</span><span class="p">:</span> <span class="n">proposed_legal_basis</span><span class="p">,</span>
            <span class="s1">&#39;justification&#39;</span><span class="p">:</span> <span class="n">justification</span><span class="p">,</span>
            <span class="s1">&#39;assessment&#39;</span><span class="p">:</span> <span class="n">assessment</span><span class="p">,</span>
            <span class="s1">&#39;assessed_date&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">()</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;valid&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;assessment&#39;</span><span class="p">:</span> <span class="n">assessment</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_evaluate_legal_basis_appropriateness</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">activity</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">],</span> 
                                            <span class="n">legal_basis</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Evaluate if proposed legal basis is appropriate&quot;&quot;&quot;</span>

        <span class="n">appropriateness</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;appropriate&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;concerns&#39;</span><span class="p">:</span> <span class="p">[],</span>
            <span class="s1">&#39;recommendations&#39;</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">}</span>

        <span class="c1"># Check for high-risk scenarios</span>
        <span class="k">if</span> <span class="n">activity</span><span class="p">[</span><span class="s1">&#39;data_sensitivity&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;restricted&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">legal_basis</span> <span class="o">==</span> <span class="s1">&#39;legitimate_interests&#39;</span><span class="p">:</span>
                <span class="n">appropriateness</span><span class="p">[</span><span class="s1">&#39;concerns&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="s2">&quot;Legitimate interests may not be sufficient for restricted data&quot;</span>
                <span class="p">)</span>
                <span class="n">appropriateness</span><span class="p">[</span><span class="s1">&#39;recommendations&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="s2">&quot;Consider explicit consent or legal obligation&quot;</span>
                <span class="p">)</span>

        <span class="c1"># Check marketing activities</span>
        <span class="k">if</span> <span class="s1">&#39;marketing&#39;</span> <span class="ow">in</span> <span class="n">activity</span><span class="p">[</span><span class="s1">&#39;purpose&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">legal_basis</span> <span class="o">!=</span> <span class="s1">&#39;consent&#39;</span><span class="p">:</span>
                <span class="n">appropriateness</span><span class="p">[</span><span class="s1">&#39;concerns&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="s2">&quot;Marketing activities typically require explicit consent&quot;</span>
                <span class="p">)</span>
                <span class="n">appropriateness</span><span class="p">[</span><span class="s1">&#39;recommendations&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                    <span class="s2">&quot;Use consent as legal basis for marketing&quot;</span>
                <span class="p">)</span>

        <span class="c1"># Check sensitive data types</span>
        <span class="n">sensitive_indicators</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;health&#39;</span><span class="p">,</span> <span class="s1">&#39;medical&#39;</span><span class="p">,</span> <span class="s1">&#39;financial&#39;</span><span class="p">,</span> <span class="s1">&#39;biometric&#39;</span><span class="p">,</span> <span class="s1">&#39;religious&#39;</span><span class="p">,</span> <span class="s1">&#39;political&#39;</span><span class="p">]</span>
        <span class="n">has_sensitive_data</span> <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">indicator</span> <span class="ow">in</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">activity</span><span class="p">[</span><span class="s1">&#39;data_types&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> 
                               <span class="k">for</span> <span class="n">indicator</span> <span class="ow">in</span> <span class="n">sensitive_indicators</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">has_sensitive_data</span> <span class="ow">and</span> <span class="n">legal_basis</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;consent&#39;</span><span class="p">,</span> <span class="s1">&#39;legal_obligation&#39;</span><span class="p">,</span> <span class="s1">&#39;vital_interests&#39;</span><span class="p">]:</span>
            <span class="n">appropriateness</span><span class="p">[</span><span class="s1">&#39;concerns&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="s2">&quot;Sensitive personal data typically requires explicit consent or legal obligation&quot;</span>
            <span class="p">)</span>
            <span class="n">appropriateness</span><span class="p">[</span><span class="s1">&#39;recommendations&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="s2">&quot;Review legal basis for sensitive data processing&quot;</span>
            <span class="p">)</span>

        <span class="n">appropriateness</span><span class="p">[</span><span class="s1">&#39;appropriate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">appropriateness</span><span class="p">[</span><span class="s1">&#39;concerns&#39;</span><span class="p">])</span> <span class="o">==</span> <span class="mi">0</span>

        <span class="k">return</span> <span class="n">appropriateness</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">add_mitigation_measures</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Add standard mitigation measures for identified risks&quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">risk</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">identified_risks</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;BREACH&#39;</span> <span class="ow">in</span> <span class="n">risk</span><span class="o">.</span><span class="n">risk_id</span><span class="p">:</span>
                <span class="n">risk</span><span class="o">.</span><span class="n">add_mitigation_measure</span><span class="p">(</span><span class="s2">&quot;Implement end-to-end encryption&quot;</span><span class="p">,</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">HIGH</span><span class="p">)</span>
                <span class="n">risk</span><span class="o">.</span><span class="n">add_mitigation_measure</span><span class="p">(</span><span class="s2">&quot;Regular security audits&quot;</span><span class="p">,</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">)</span>
                <span class="n">risk</span><span class="o">.</span><span class="n">add_mitigation_measure</span><span class="p">(</span><span class="s2">&quot;Access controls and authentication&quot;</span><span class="p">,</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">)</span>

            <span class="k">elif</span> <span class="s1">&#39;ACCESS&#39;</span> <span class="ow">in</span> <span class="n">risk</span><span class="o">.</span><span class="n">risk_id</span><span class="p">:</span>
                <span class="n">risk</span><span class="o">.</span><span class="n">add_mitigation_measure</span><span class="p">(</span><span class="s2">&quot;Role-based access controls&quot;</span><span class="p">,</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">HIGH</span><span class="p">)</span>
                <span class="n">risk</span><span class="o">.</span><span class="n">add_mitigation_measure</span><span class="p">(</span><span class="s2">&quot;Audit logging of data access&quot;</span><span class="p">,</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">)</span>
                <span class="n">risk</span><span class="o">.</span><span class="n">add_mitigation_measure</span><span class="p">(</span><span class="s2">&quot;Regular access reviews&quot;</span><span class="p">,</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">)</span>

            <span class="k">elif</span> <span class="s1">&#39;RETENTION&#39;</span> <span class="ow">in</span> <span class="n">risk</span><span class="o">.</span><span class="n">risk_id</span><span class="p">:</span>
                <span class="n">risk</span><span class="o">.</span><span class="n">add_mitigation_measure</span><span class="p">(</span><span class="s2">&quot;Implement automated data deletion&quot;</span><span class="p">,</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">HIGH</span><span class="p">)</span>
                <span class="n">risk</span><span class="o">.</span><span class="n">add_mitigation_measure</span><span class="p">(</span><span class="s2">&quot;Regular data retention reviews&quot;</span><span class="p">,</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">)</span>
                <span class="n">risk</span><span class="o">.</span><span class="n">add_mitigation_measure</span><span class="p">(</span><span class="s2">&quot;Data minimization policies&quot;</span><span class="p">,</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">)</span>

            <span class="k">elif</span> <span class="s1">&#39;PURPOSE&#39;</span> <span class="ow">in</span> <span class="n">risk</span><span class="o">.</span><span class="n">risk_id</span><span class="p">:</span>
                <span class="n">risk</span><span class="o">.</span><span class="n">add_mitigation_measure</span><span class="p">(</span><span class="s2">&quot;Clear purpose documentation&quot;</span><span class="p">,</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">)</span>
                <span class="n">risk</span><span class="o">.</span><span class="n">add_mitigation_measure</span><span class="p">(</span><span class="s2">&quot;Staff training on purpose limitation&quot;</span><span class="p">,</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">)</span>
                <span class="n">risk</span><span class="o">.</span><span class="n">add_mitigation_measure</span><span class="p">(</span><span class="s2">&quot;Technical controls to prevent purpose creep&quot;</span><span class="p">,</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">HIGH</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">determine_consultation_requirement</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Determine if consultation with privacy authority is required&quot;&quot;&quot;</span>

        <span class="n">high_risk_indicators</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Check for high/critical risks</span>
        <span class="n">critical_risks</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">identified_risks</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">residual_risk</span> <span class="o">==</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">]</span>
        <span class="n">high_risks</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">identified_risks</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">residual_risk</span> <span class="o">==</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">HIGH</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">critical_risks</span><span class="p">:</span>
            <span class="n">high_risk_indicators</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">critical_risks</span><span class="p">)</span><span class="si">}</span><span class="s2"> critical privacy risks identified&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">high_risks</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">3</span><span class="p">:</span>
            <span class="n">high_risk_indicators</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">high_risks</span><span class="p">)</span><span class="si">}</span><span class="s2"> high privacy risks identified&quot;</span><span class="p">)</span>

        <span class="c1"># Check for sensitive data processing</span>
        <span class="n">sensitive_activities</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">activity</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_processing_activities</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">activity</span><span class="p">[</span><span class="s1">&#39;data_sensitivity&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;restricted&#39;</span><span class="p">:</span>
                <span class="n">sensitive_activities</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">activity</span><span class="p">[</span><span class="s1">&#39;activity_name&#39;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">sensitive_activities</span><span class="p">:</span>
            <span class="n">high_risk_indicators</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing restricted data: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sensitive_activities</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Check for automated decision making</span>
        <span class="n">automated_activities</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_processing_activities</span> <span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;automated_decision_making&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">automated_activities</span><span class="p">:</span>
            <span class="n">high_risk_indicators</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Automated decision making identified&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">consultation_required</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">high_risk_indicators</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;consultation_required&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">consultation_required</span><span class="p">,</span>
            <span class="s1">&#39;risk_indicators&#39;</span><span class="p">:</span> <span class="n">high_risk_indicators</span><span class="p">,</span>
            <span class="s1">&#39;recommendation&#39;</span><span class="p">:</span> <span class="s1">&#39;Consult privacy authority before proceeding&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">consultation_required</span> <span class="k">else</span> <span class="s1">&#39;No consultation required&#39;</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_assessment_report</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate comprehensive PIA report&quot;&quot;&quot;</span>

        <span class="c1"># Calculate risk summary</span>
        <span class="n">risk_summary</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;total_risks&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">identified_risks</span><span class="p">),</span>
            <span class="s1">&#39;critical_risks&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">([</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">identified_risks</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">residual_risk</span> <span class="o">==</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">]),</span>
            <span class="s1">&#39;high_risks&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">([</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">identified_risks</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">residual_risk</span> <span class="o">==</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">HIGH</span><span class="p">]),</span>
            <span class="s1">&#39;medium_risks&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">([</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">identified_risks</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">residual_risk</span> <span class="o">==</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">MEDIUM</span><span class="p">]),</span>
            <span class="s1">&#39;low_risks&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">([</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">identified_risks</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">residual_risk</span> <span class="o">==</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">LOW</span><span class="p">])</span>
        <span class="p">}</span>

        <span class="c1"># Generate recommendations</span>
        <span class="n">recommendations</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">risk_summary</span><span class="p">[</span><span class="s1">&#39;critical_risks&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">recommendations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Address critical privacy risks before project implementation&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">risk_summary</span><span class="p">[</span><span class="s1">&#39;high_risks&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">recommendations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Implement comprehensive risk mitigation program&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">consultation_required</span><span class="p">:</span>
            <span class="n">recommendations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Consult with privacy authority before proceeding&quot;</span><span class="p">)</span>

        <span class="c1"># Check legal basis coverage</span>
        <span class="n">activities_without_legal_basis</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_processing_activities</span> 
            <span class="k">if</span> <span class="n">a</span><span class="p">[</span><span class="s1">&#39;activity_id&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">legal_basis_analysis</span>
        <span class="p">]</span>

        <span class="k">if</span> <span class="n">activities_without_legal_basis</span><span class="p">:</span>
            <span class="n">recommendations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Complete legal basis analysis for all processing activities&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;assessment_summary&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;assessment_id&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">assessment_id</span><span class="p">,</span>
                <span class="s1">&#39;project_name&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">project_name</span><span class="p">,</span>
                <span class="s1">&#39;assessor&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">assessor</span><span class="p">,</span>
                <span class="s1">&#39;assessment_date&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">assessment_date</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
                <span class="s1">&#39;activities_assessed&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_processing_activities</span><span class="p">),</span>
                <span class="s1">&#39;consultation_required&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">consultation_required</span>
            <span class="p">},</span>
            <span class="s1">&#39;risk_summary&#39;</span><span class="p">:</span> <span class="n">risk_summary</span><span class="p">,</span>
            <span class="s1">&#39;processing_activities&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_processing_activities</span><span class="p">,</span>
            <span class="s1">&#39;identified_risks&#39;</span><span class="p">:</span> <span class="p">[</span>
                <span class="p">{</span>
                    <span class="s1">&#39;risk_id&#39;</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">risk_id</span><span class="p">,</span>
                    <span class="s1">&#39;description&#39;</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">description</span><span class="p">,</span>
                    <span class="s1">&#39;likelihood&#39;</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">likelihood</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                    <span class="s1">&#39;impact&#39;</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">impact</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                    <span class="s1">&#39;overall_risk&#39;</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">overall_risk</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                    <span class="s1">&#39;residual_risk&#39;</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">residual_risk</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
                    <span class="s1">&#39;data_types_affected&#39;</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">data_types_affected</span><span class="p">,</span>
                    <span class="s1">&#39;mitigation_measures&#39;</span><span class="p">:</span> <span class="n">r</span><span class="o">.</span><span class="n">mitigation_measures</span>
                <span class="p">}</span>
                <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">identified_risks</span>
            <span class="p">],</span>
            <span class="s1">&#39;legal_basis_analysis&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">legal_basis_analysis</span><span class="p">,</span>
            <span class="s1">&#39;recommendations&#39;</span><span class="p">:</span> <span class="n">recommendations</span><span class="p">,</span>
            <span class="s1">&#39;next_steps&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_next_steps</span><span class="p">()</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_next_steps</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate recommended next steps&quot;&quot;&quot;</span>

        <span class="n">next_steps</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Risk mitigation</span>
        <span class="n">high_priority_risks</span> <span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">identified_risks</span> <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">residual_risk</span> <span class="ow">in</span> <span class="p">[</span><span class="n">RiskLevel</span><span class="o">.</span><span class="n">HIGH</span><span class="p">,</span> <span class="n">RiskLevel</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">]]</span>
        <span class="k">if</span> <span class="n">high_priority_risks</span><span class="p">:</span>
            <span class="n">next_steps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Implement mitigation measures for high-priority privacy risks&quot;</span><span class="p">)</span>

        <span class="c1"># Legal basis</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">legal_basis_analysis</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_processing_activities</span><span class="p">):</span>
            <span class="n">next_steps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Complete legal basis assessment for all processing activities&quot;</span><span class="p">)</span>

        <span class="c1"># Consultation</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">consultation_required</span><span class="p">:</span>
            <span class="n">next_steps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Schedule consultation with privacy authority&quot;</span><span class="p">)</span>

        <span class="c1"># Implementation</span>
        <span class="n">next_steps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Update project design based on PIA findings&quot;</span><span class="p">)</span>
        <span class="n">next_steps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Establish privacy monitoring and review procedures&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">next_steps</span>

<span class="c1"># Demonstration of Privacy Impact Assessment</span>
<span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_privacy_impact_assessment</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Demonstrate comprehensive Privacy Impact Assessment&quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== Privacy Impact Assessment Demo ===&quot;</span><span class="p">)</span>

    <span class="c1"># Create PIA for student information system</span>
    <span class="n">pia</span> <span class="o">=</span> <span class="n">PrivacyImpactAssessment</span><span class="p">(</span><span class="s2">&quot;Student Information System v2.0&quot;</span><span class="p">,</span> <span class="s2">&quot;Privacy Officer&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Assessment ID: </span><span class="si">{</span><span class="n">pia</span><span class="o">.</span><span class="n">assessment_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Project: </span><span class="si">{</span><span class="n">pia</span><span class="o">.</span><span class="n">project_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Add data processing activities</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">1. Adding data processing activities...&quot;</span><span class="p">)</span>

    <span class="c1"># Activity 1: Student registration</span>
    <span class="n">activity1_id</span> <span class="o">=</span> <span class="n">pia</span><span class="o">.</span><span class="n">add_data_processing_activity</span><span class="p">(</span>
        <span class="s2">&quot;Student Registration&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Create and manage student accounts for educational services&quot;</span><span class="p">,</span>
        <span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;email&quot;</span><span class="p">,</span> <span class="s2">&quot;date_of_birth&quot;</span><span class="p">,</span> <span class="s2">&quot;student_id&quot;</span><span class="p">,</span> <span class="s2">&quot;emergency_contact&quot;</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;students&quot;</span><span class="p">,</span> <span class="s2">&quot;parents&quot;</span><span class="p">,</span> <span class="s2">&quot;guardians&quot;</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;online_registration_form&quot;</span><span class="p">,</span> <span class="s2">&quot;school_records&quot;</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;teachers&quot;</span><span class="p">,</span> <span class="s2">&quot;administrators&quot;</span><span class="p">,</span> <span class="s2">&quot;IT_support&quot;</span><span class="p">],</span>
        <span class="s2">&quot;7 years after graduation&quot;</span><span class="p">,</span>
        <span class="n">DataSensitivity</span><span class="o">.</span><span class="n">CONFIDENTIAL</span>
    <span class="p">)</span>

    <span class="c1"># Activity 2: Learning analytics</span>
    <span class="n">activity2_id</span> <span class="o">=</span> <span class="n">pia</span><span class="o">.</span><span class="n">add_data_processing_activity</span><span class="p">(</span>
        <span class="s2">&quot;Learning Analytics&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Analyze student performance and engagement for educational improvement&quot;</span><span class="p">,</span>
        <span class="p">[</span><span class="s2">&quot;assignment_scores&quot;</span><span class="p">,</span> <span class="s2">&quot;time_spent&quot;</span><span class="p">,</span> <span class="s2">&quot;interaction_patterns&quot;</span><span class="p">,</span> <span class="s2">&quot;learning_preferences&quot;</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;students&quot;</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;learning_management_system&quot;</span><span class="p">,</span> <span class="s2">&quot;assessment_tools&quot;</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;teachers&quot;</span><span class="p">,</span> <span class="s2">&quot;education_researchers&quot;</span><span class="p">,</span> <span class="s2">&quot;analytics_team&quot;</span><span class="p">],</span>
        <span class="s2">&quot;3 years&quot;</span><span class="p">,</span>
        <span class="n">DataSensitivity</span><span class="o">.</span><span class="n">INTERNAL</span>
    <span class="p">)</span>

    <span class="c1"># Activity 3: Marketing communications</span>
    <span class="n">activity3_id</span> <span class="o">=</span> <span class="n">pia</span><span class="o">.</span><span class="n">add_data_processing_activity</span><span class="p">(</span>
        <span class="s2">&quot;Alumni Communications&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Send promotional materials and fundraising communications to alumni&quot;</span><span class="p">,</span>
        <span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span> <span class="s2">&quot;email&quot;</span><span class="p">,</span> <span class="s2">&quot;graduation_year&quot;</span><span class="p">,</span> <span class="s2">&quot;donation_history&quot;</span><span class="p">,</span> <span class="s2">&quot;contact_preferences&quot;</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;alumni&quot;</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;student_records&quot;</span><span class="p">,</span> <span class="s2">&quot;alumni_surveys&quot;</span><span class="p">],</span>
        <span class="p">[</span><span class="s2">&quot;marketing_team&quot;</span><span class="p">,</span> <span class="s2">&quot;external_fundraising_consultants&quot;</span><span class="p">],</span>
        <span class="s2">&quot;indefinite (until consent withdrawn)&quot;</span><span class="p">,</span>
        <span class="n">DataSensitivity</span><span class="o">.</span><span class="n">INTERNAL</span>
    <span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Added activities: </span><span class="si">{</span><span class="n">activity1_id</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">activity2_id</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">activity3_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Assess legal basis</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">2. Assessing legal basis...&quot;</span><span class="p">)</span>

    <span class="n">legal_assessments</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="n">activity1_id</span><span class="p">,</span> <span class="s2">&quot;contract&quot;</span><span class="p">,</span> <span class="s2">&quot;Necessary for providing educational services under enrollment contract&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">activity2_id</span><span class="p">,</span> <span class="s2">&quot;legitimate_interests&quot;</span><span class="p">,</span> <span class="s2">&quot;Legitimate interest in improving educational outcomes&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">activity3_id</span><span class="p">,</span> <span class="s2">&quot;consent&quot;</span><span class="p">,</span> <span class="s2">&quot;Marketing communications require explicit consent&quot;</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="k">for</span> <span class="n">activity_id</span><span class="p">,</span> <span class="n">legal_basis</span><span class="p">,</span> <span class="n">justification</span> <span class="ow">in</span> <span class="n">legal_assessments</span><span class="p">:</span>
        <span class="n">assessment</span> <span class="o">=</span> <span class="n">pia</span><span class="o">.</span><span class="n">assess_legal_basis</span><span class="p">(</span><span class="n">activity_id</span><span class="p">,</span> <span class="n">legal_basis</span><span class="p">,</span> <span class="n">justification</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">assessment</span><span class="p">[</span><span class="s1">&#39;valid&#39;</span><span class="p">]:</span>
            <span class="n">status</span> <span class="o">=</span> <span class="s2">&quot;✅ APPROPRIATE&quot;</span> <span class="k">if</span> <span class="n">assessment</span><span class="p">[</span><span class="s1">&#39;assessment&#39;</span><span class="p">][</span><span class="s1">&#39;appropriate&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="s2">&quot;⚠️ CONCERNS&quot;</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">activity_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">legal_basis</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">assessment</span><span class="p">[</span><span class="s1">&#39;assessment&#39;</span><span class="p">][</span><span class="s1">&#39;appropriate&#39;</span><span class="p">]:</span>
                <span class="k">for</span> <span class="n">concern</span> <span class="ow">in</span> <span class="n">assessment</span><span class="p">[</span><span class="s1">&#39;assessment&#39;</span><span class="p">][</span><span class="s1">&#39;concerns&#39;</span><span class="p">]:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Concern: </span><span class="si">{</span><span class="n">concern</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">activity_id</span><span class="si">}</span><span class="s2">: ❌ INVALID - </span><span class="si">{</span><span class="n">assessment</span><span class="p">[</span><span class="s1">&#39;error&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Add mitigation measures</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">3. Adding mitigation measures...&quot;</span><span class="p">)</span>
    <span class="n">pia</span><span class="o">.</span><span class="n">add_mitigation_measures</span><span class="p">()</span>

    <span class="n">mitigation_count</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">risk</span><span class="o">.</span><span class="n">mitigation_measures</span><span class="p">)</span> <span class="k">for</span> <span class="n">risk</span> <span class="ow">in</span> <span class="n">pia</span><span class="o">.</span><span class="n">identified_risks</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Added </span><span class="si">{</span><span class="n">mitigation_count</span><span class="si">}</span><span class="s2"> mitigation measures across </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">pia</span><span class="o">.</span><span class="n">identified_risks</span><span class="p">)</span><span class="si">}</span><span class="s2"> identified risks&quot;</span><span class="p">)</span>

    <span class="c1"># Check consultation requirement</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">4. Checking consultation requirements...&quot;</span><span class="p">)</span>
    <span class="n">consultation_result</span> <span class="o">=</span> <span class="n">pia</span><span class="o">.</span><span class="n">determine_consultation_requirement</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Consultation required: </span><span class="si">{</span><span class="n">consultation_result</span><span class="p">[</span><span class="s1">&#39;consultation_required&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">consultation_result</span><span class="p">[</span><span class="s1">&#39;risk_indicators&#39;</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Risk indicators:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">indicator</span> <span class="ow">in</span> <span class="n">consultation_result</span><span class="p">[</span><span class="s1">&#39;risk_indicators&#39;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  - </span><span class="si">{</span><span class="n">indicator</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Recommendation: </span><span class="si">{</span><span class="n">consultation_result</span><span class="p">[</span><span class="s1">&#39;recommendation&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Generate assessment report</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">5. Generating assessment report...&quot;</span><span class="p">)</span>

    <span class="n">report</span> <span class="o">=</span> <span class="n">pia</span><span class="o">.</span><span class="n">generate_assessment_report</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Assessment Summary:&quot;</span><span class="p">)</span>
    <span class="n">summary</span> <span class="o">=</span> <span class="n">report</span><span class="p">[</span><span class="s1">&#39;assessment_summary&#39;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Project: </span><span class="si">{</span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;project_name&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Activities assessed: </span><span class="si">{</span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;activities_assessed&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Consultation required: </span><span class="si">{</span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;consultation_required&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Risk Summary:&quot;</span><span class="p">)</span>
    <span class="n">risk_summary</span> <span class="o">=</span> <span class="n">report</span><span class="p">[</span><span class="s1">&#39;risk_summary&#39;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Total risks: </span><span class="si">{</span><span class="n">risk_summary</span><span class="p">[</span><span class="s1">&#39;total_risks&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Critical: </span><span class="si">{</span><span class="n">risk_summary</span><span class="p">[</span><span class="s1">&#39;critical_risks&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, High: </span><span class="si">{</span><span class="n">risk_summary</span><span class="p">[</span><span class="s1">&#39;high_risks&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Medium: </span><span class="si">{</span><span class="n">risk_summary</span><span class="p">[</span><span class="s1">&#39;medium_risks&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">, Low: </span><span class="si">{</span><span class="n">risk_summary</span><span class="p">[</span><span class="s1">&#39;low_risks&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Key Recommendations:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">rec</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;recommendations&#39;</span><span class="p">][:</span><span class="mi">3</span><span class="p">],</span> <span class="mi">1</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">rec</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Next Steps:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">report</span><span class="p">[</span><span class="s1">&#39;next_steps&#39;</span><span class="p">][:</span><span class="mi">3</span><span class="p">],</span> <span class="mi">1</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">step</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre>
</div>
<h2 id="gdpr-and-privacy-law-fundamentals">GDPR and Privacy Law Fundamentals<a class="headerlink" href="#gdpr-and-privacy-law-fundamentals" title="Permanent link">&para;</a></h2>
<p>The General Data Protection Regulation (GDPR) provides a comprehensive <span class="glossary-term" data-glossary-category="Web Development" data-glossary-definition="A pre-built structure providing a foundation and tools for developing software applications more efficiently." data-glossary-term="Framework">framework</span> for data protection that influences privacy design worldwide.</p>
<div class="highlight python-template" data-fence-type="template" data-language="python">
<pre><code class="language-python"><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Optional</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">datetime</span><span class="w"> </span><span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">enum</span><span class="w"> </span><span class="kn">import</span> <span class="n">Enum</span>

<span class="k">class</span><span class="w"> </span><span class="nc">GDPRRights</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">ACCESS</span> <span class="o">=</span> <span class="s2">&quot;access&quot;</span>  <span class="c1"># Right to access personal data</span>
    <span class="n">RECTIFICATION</span> <span class="o">=</span> <span class="s2">&quot;rectification&quot;</span>  <span class="c1"># Right to correct inaccurate data</span>
    <span class="n">ERASURE</span> <span class="o">=</span> <span class="s2">&quot;erasure&quot;</span>  <span class="c1"># Right to be forgotten</span>
    <span class="n">RESTRICT_PROCESSING</span> <span class="o">=</span> <span class="s2">&quot;restrict_processing&quot;</span>  <span class="c1"># Right to restrict processing</span>
    <span class="n">DATA_PORTABILITY</span> <span class="o">=</span> <span class="s2">&quot;data_portability&quot;</span>  <span class="c1"># Right to data portability</span>
    <span class="n">OBJECT</span> <span class="o">=</span> <span class="s2">&quot;object&quot;</span>  <span class="c1"># Right to object to processing</span>
    <span class="n">WITHDRAW_CONSENT</span> <span class="o">=</span> <span class="s2">&quot;withdraw_consent&quot;</span>  <span class="c1"># Right to withdraw consent</span>

<span class="k">class</span><span class="w"> </span><span class="nc">RequestStatus</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="n">RECEIVED</span> <span class="o">=</span> <span class="s2">&quot;received&quot;</span>
    <span class="n">UNDER_REVIEW</span> <span class="o">=</span> <span class="s2">&quot;under_review&quot;</span>
    <span class="n">COMPLETED</span> <span class="o">=</span> <span class="s2">&quot;completed&quot;</span>
    <span class="n">REJECTED</span> <span class="o">=</span> <span class="s2">&quot;rejected&quot;</span>
    <span class="n">PARTIALLY_COMPLETED</span> <span class="o">=</span> <span class="s2">&quot;partially_completed&quot;</span>

<span class="k">class</span><span class="w"> </span><span class="nc">GDPRComplianceManager</span><span class="p">:</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_subject_requests</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processing_records</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">consent_records</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1"># Define response timeframes (GDPR requirements)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response_timeframes</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">GDPRRights</span><span class="o">.</span><span class="n">ACCESS</span><span class="p">:</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">30</span><span class="p">),</span>
            <span class="n">GDPRRights</span><span class="o">.</span><span class="n">RECTIFICATION</span><span class="p">:</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">30</span><span class="p">),</span>
            <span class="n">GDPRRights</span><span class="o">.</span><span class="n">ERASURE</span><span class="p">:</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">30</span><span class="p">),</span>
            <span class="n">GDPRRights</span><span class="o">.</span><span class="n">RESTRICT_PROCESSING</span><span class="p">:</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">30</span><span class="p">),</span>
            <span class="n">GDPRRights</span><span class="o">.</span><span class="n">DATA_PORTABILITY</span><span class="p">:</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">30</span><span class="p">),</span>
            <span class="n">GDPRRights</span><span class="o">.</span><span class="n">OBJECT</span><span class="p">:</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">30</span><span class="p">),</span>
            <span class="n">GDPRRights</span><span class="o">.</span><span class="n">WITHDRAW_CONSENT</span><span class="p">:</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Immediate</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">handle_data_subject_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">request_type</span><span class="p">:</span> <span class="n">GDPRRights</span><span class="p">,</span>
                                  <span class="n">details</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">identity_verified</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Handle data subject rights requests under GDPR&quot;&quot;&quot;</span>

        <span class="n">request_id</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;DSR_</span><span class="si">{</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y%m</span><span class="si">%d</span><span class="s1">_%H%M%S&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">identity_verified</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;error&#39;</span><span class="p">:</span> <span class="s1">&#39;Identity verification required for data subject requests&#39;</span><span class="p">,</span>
                <span class="s1">&#39;next_steps&#39;</span><span class="p">:</span> <span class="s1">&#39;Please provide identity verification documents&#39;</span>
            <span class="p">}</span>

        <span class="c1"># Calculate response deadline</span>
        <span class="n">response_deadline</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">response_timeframes</span><span class="p">[</span><span class="n">request_type</span><span class="p">]</span>

        <span class="n">request_record</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;request_id&#39;</span><span class="p">:</span> <span class="n">request_id</span><span class="p">,</span>
            <span class="s1">&#39;user_id&#39;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
            <span class="s1">&#39;request_type&#39;</span><span class="p">:</span> <span class="n">request_type</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
            <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="n">details</span><span class="p">,</span>
            <span class="s1">&#39;received_date&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">(),</span>
            <span class="s1">&#39;response_deadline&#39;</span><span class="p">:</span> <span class="n">response_deadline</span><span class="p">,</span>
            <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="n">RequestStatus</span><span class="o">.</span><span class="n">RECEIVED</span><span class="p">,</span>
            <span class="s1">&#39;identity_verified&#39;</span><span class="p">:</span> <span class="n">identity_verified</span><span class="p">,</span>
            <span class="s1">&#39;processing_log&#39;</span><span class="p">:</span> <span class="p">[]</span>
        <span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data_subject_requests</span><span class="p">[</span><span class="n">request_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">request_record</span>

        <span class="c1"># Process the request based on type</span>
        <span class="k">if</span> <span class="n">request_type</span> <span class="o">==</span> <span class="n">GDPRRights</span><span class="o">.</span><span class="n">ACCESS</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_access_request</span><span class="p">(</span><span class="n">request_record</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">request_type</span> <span class="o">==</span> <span class="n">GDPRRights</span><span class="o">.</span><span class="n">RECTIFICATION</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_rectification_request</span><span class="p">(</span><span class="n">request_record</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">request_type</span> <span class="o">==</span> <span class="n">GDPRRights</span><span class="o">.</span><span class="n">ERASURE</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_erasure_request</span><span class="p">(</span><span class="n">request_record</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">request_type</span> <span class="o">==</span> <span class="n">GDPRRights</span><span class="o">.</span><span class="n">DATA_PORTABILITY</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_portability_request</span><span class="p">(</span><span class="n">request_record</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">request_type</span> <span class="o">==</span> <span class="n">GDPRRights</span><span class="o">.</span><span class="n">WITHDRAW_CONSENT</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_consent_withdrawal</span><span class="p">(</span><span class="n">request_record</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_process_generic_request</span><span class="p">(</span><span class="n">request_record</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_process_access_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_record</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process subject access request (Article 15)&quot;&quot;&quot;</span>

        <span class="n">user_id</span> <span class="o">=</span> <span class="n">request_record</span><span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">]</span>

        <span class="c1"># Simulate gathering user data from various systems</span>
        <span class="n">collected_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;account_information&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;user_id&#39;</span><span class="p">:</span> <span class="n">user_id</span><span class="p">,</span>
                <span class="s1">&#39;registration_date&#39;</span><span class="p">:</span> <span class="s1">&#39;2023-09-01&#39;</span><span class="p">,</span>
                <span class="s1">&#39;last_login&#39;</span><span class="p">:</span> <span class="s1">&#39;2024-09-17&#39;</span><span class="p">,</span>
                <span class="s1">&#39;account_status&#39;</span><span class="p">:</span> <span class="s1">&#39;active&#39;</span>
            <span class="p">},</span>
            <span class="s1">&#39;processing_purposes&#39;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s1">&#39;Account management&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Service delivery&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Security monitoring&#39;</span>
            <span class="p">],</span>
            <span class="s1">&#39;data_categories&#39;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s1">&#39;Identity data (name, email)&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Usage data (login history, preferences)&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Security data (IP addresses, device info)&#39;</span>
            <span class="p">],</span>
            <span class="s1">&#39;data_recipients&#39;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s1">&#39;Internal staff (teachers, administrators)&#39;</span><span class="p">,</span>
                <span class="s1">&#39;IT service providers&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Security monitoring services&#39;</span>
            <span class="p">],</span>
            <span class="s1">&#39;retention_periods&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;account_data&#39;</span><span class="p">:</span> <span class="s1">&#39;7 years after account closure&#39;</span><span class="p">,</span>
                <span class="s1">&#39;usage_data&#39;</span><span class="p">:</span> <span class="s1">&#39;1 year&#39;</span><span class="p">,</span>
                <span class="s1">&#39;security_logs&#39;</span><span class="p">:</span> <span class="s1">&#39;6 months&#39;</span>
            <span class="p">},</span>
            <span class="s1">&#39;data_sources&#39;</span><span class="p">:</span> <span class="p">[</span>
                <span class="s1">&#39;Direct collection (registration form)&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Automated collection (system logs)&#39;</span><span class="p">,</span>
                <span class="s1">&#39;Third-party integration (single sign-on)&#39;</span>
            <span class="p">]</span>
        <span class="p">}</span>

        <span class="c1"># Update request status</span>
        <span class="n">request_record</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">RequestStatus</span><span class="o">.</span><span class="n">COMPLETED</span>
        <span class="n">request_record</span><span class="p">[</span><span class="s1">&#39;completion_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">request_record</span><span class="p">[</span><span class="s1">&#39;response_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">collected_data</span>

        <span class="c1"># Log processing</span>
        <span class="n">request_record</span><span class="p">[</span><span class="s1">&#39;processing_log&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
            <span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;Data compiled for access request&#39;</span><span class="p">,</span>
            <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Collected data from </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">collected_data</span><span class="p">)</span><span class="si">}</span><span class="s2"> data categories&quot;</span>
        <span class="p">})</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;request_id&#39;</span><span class="p">:</span> <span class="n">request_record</span><span class="p">[</span><span class="s1">&#39;request_id&#39;</span><span class="p">],</span>
            <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;completed&#39;</span><span class="p">,</span>
            <span class="s1">&#39;response_data&#39;</span><span class="p">:</span> <span class="n">collected_data</span><span class="p">,</span>
            <span class="s1">&#39;completion_date&#39;</span><span class="p">:</span> <span class="n">request_record</span><span class="p">[</span><span class="s1">&#39;completion_date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
            <span class="s1">&#39;delivery_method&#39;</span><span class="p">:</span> <span class="s1">&#39;secure_download_link&#39;</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_process_erasure_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_record</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process right to be forgotten request (Article 17)&quot;&quot;&quot;</span>

        <span class="n">user_id</span> <span class="o">=</span> <span class="n">request_record</span><span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">]</span>

        <span class="c1"># Check if erasure is possible</span>
        <span class="n">erasure_assessment</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_assess_erasure_eligibility</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">erasure_assessment</span><span class="p">[</span><span class="s1">&#39;eligible&#39;</span><span class="p">]:</span>
            <span class="n">request_record</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">RequestStatus</span><span class="o">.</span><span class="n">REJECTED</span>
            <span class="n">request_record</span><span class="p">[</span><span class="s1">&#39;rejection_reason&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">erasure_assessment</span><span class="p">[</span><span class="s1">&#39;reason&#39;</span><span class="p">]</span>

            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;request_id&#39;</span><span class="p">:</span> <span class="n">request_record</span><span class="p">[</span><span class="s1">&#39;request_id&#39;</span><span class="p">],</span>
                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;rejected&#39;</span><span class="p">,</span>
                <span class="s1">&#39;reason&#39;</span><span class="p">:</span> <span class="n">erasure_assessment</span><span class="p">[</span><span class="s1">&#39;reason&#39;</span><span class="p">],</span>
                <span class="s1">&#39;explanation&#39;</span><span class="p">:</span> <span class="n">erasure_assessment</span><span class="p">[</span><span class="s1">&#39;explanation&#39;</span><span class="p">]</span>
            <span class="p">}</span>

        <span class="c1"># Perform erasure</span>
        <span class="n">erasure_results</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;account_data&#39;</span><span class="p">:</span> <span class="s1">&#39;deleted&#39;</span><span class="p">,</span>
            <span class="s1">&#39;usage_history&#39;</span><span class="p">:</span> <span class="s1">&#39;deleted&#39;</span><span class="p">,</span>
            <span class="s1">&#39;comments_posts&#39;</span><span class="p">:</span> <span class="s1">&#39;anonymized&#39;</span><span class="p">,</span>  <span class="c1"># May need to retain for others</span>
            <span class="s1">&#39;legal_records&#39;</span><span class="p">:</span> <span class="s1">&#39;retained&#39;</span><span class="p">,</span>     <span class="c1"># Legal obligation</span>
            <span class="s1">&#39;security_logs&#39;</span><span class="p">:</span> <span class="s1">&#39;anonymized&#39;</span>    <span class="c1"># Security purposes</span>
        <span class="p">}</span>

        <span class="n">request_record</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">RequestStatus</span><span class="o">.</span><span class="n">PARTIALLY_COMPLETED</span>
        <span class="n">request_record</span><span class="p">[</span><span class="s1">&#39;completion_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">request_record</span><span class="p">[</span><span class="s1">&#39;erasure_results&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">erasure_results</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;request_id&#39;</span><span class="p">:</span> <span class="n">request_record</span><span class="p">[</span><span class="s1">&#39;request_id&#39;</span><span class="p">],</span>
            <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;partially_completed&#39;</span><span class="p">,</span>
            <span class="s1">&#39;erasure_results&#39;</span><span class="p">:</span> <span class="n">erasure_results</span><span class="p">,</span>
            <span class="s1">&#39;explanation&#39;</span><span class="p">:</span> <span class="s1">&#39;Some data retained due to legal obligations or legitimate interests&#39;</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_process_portability_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_record</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process data portability request (Article 20)&quot;&quot;&quot;</span>

        <span class="n">user_id</span> <span class="o">=</span> <span class="n">request_record</span><span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">]</span>

        <span class="c1"># Extract portable data (data provided by user or generated through use)</span>
        <span class="n">portable_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;personal_information&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="s1">&#39;Student Name&#39;</span><span class="p">,</span>
                <span class="s1">&#39;email&#39;</span><span class="p">:</span> <span class="s1">&#39;student@example.com&#39;</span><span class="p">,</span>
                <span class="s1">&#39;preferences&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;language&#39;</span><span class="p">:</span> <span class="s1">&#39;en&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;timezone&#39;</span><span class="p">:</span> <span class="s1">&#39;UTC&#39;</span><span class="p">,</span>
                    <span class="s1">&#39;notifications&#39;</span><span class="p">:</span> <span class="kc">True</span>
                <span class="p">}</span>
            <span class="p">},</span>
            <span class="s1">&#39;user_generated_content&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;assignments&#39;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Math Assignment 1&#39;</span><span class="p">,</span> <span class="s1">&#39;submitted_date&#39;</span><span class="p">:</span> <span class="s1">&#39;2024-01-15&#39;</span><span class="p">,</span> <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="mi">85</span><span class="p">},</span>
                    <span class="p">{</span><span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="s1">&#39;Science Project&#39;</span><span class="p">,</span> <span class="s1">&#39;submitted_date&#39;</span><span class="p">:</span> <span class="s1">&#39;2024-02-20&#39;</span><span class="p">,</span> <span class="s1">&#39;score&#39;</span><span class="p">:</span> <span class="mi">92</span><span class="p">}</span>
                <span class="p">],</span>
                <span class="s1">&#39;forum_posts&#39;</span><span class="p">:</span> <span class="p">[</span>
                    <span class="p">{</span><span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="s1">&#39;2024-03-01&#39;</span><span class="p">,</span> <span class="s1">&#39;content&#39;</span><span class="p">:</span> <span class="s1">&#39;Great lesson on quantum physics!&#39;</span><span class="p">}</span>
                <span class="p">]</span>
            <span class="p">},</span>
            <span class="s1">&#39;usage_data&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;course_completions&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;Mathematics 101&#39;</span><span class="p">,</span> <span class="s1">&#39;Physics 201&#39;</span><span class="p">],</span>
                <span class="s1">&#39;login_history&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;2024-09-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2024-09-15&#39;</span><span class="p">,</span> <span class="s1">&#39;2024-09-17&#39;</span><span class="p">],</span>
                <span class="s1">&#39;feature_usage&#39;</span><span class="p">:</span> <span class="p">{</span>
                    <span class="s1">&#39;assignments&#39;</span><span class="p">:</span> <span class="mi">45</span><span class="p">,</span>
                    <span class="s1">&#39;forums&#39;</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span>
                    <span class="s1">&#39;grades&#39;</span><span class="p">:</span> <span class="mi">38</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="c1"># Generate portable format (JSON)</span>
        <span class="kn">import</span><span class="w"> </span><span class="nn">json</span>
        <span class="n">portable_json</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">portable_data</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="nb">str</span><span class="p">)</span>

        <span class="n">request_record</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">RequestStatus</span><span class="o">.</span><span class="n">COMPLETED</span>
        <span class="n">request_record</span><span class="p">[</span><span class="s1">&#39;completion_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">request_record</span><span class="p">[</span><span class="s1">&#39;portable_data&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">portable_data</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;request_id&#39;</span><span class="p">:</span> <span class="n">request_record</span><span class="p">[</span><span class="s1">&#39;request_id&#39;</span><span class="p">],</span>
            <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;completed&#39;</span><span class="p">,</span>
            <span class="s1">&#39;format&#39;</span><span class="p">:</span> <span class="s1">&#39;JSON&#39;</span><span class="p">,</span>
            <span class="s1">&#39;size_bytes&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">portable_json</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)),</span>
            <span class="s1">&#39;download_instructions&#39;</span><span class="p">:</span> <span class="s1">&#39;Data package will be available via secure link for 30 days&#39;</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_process_consent_withdrawal</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_record</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process consent withdrawal (Article 7)&quot;&quot;&quot;</span>

        <span class="n">user_id</span> <span class="o">=</span> <span class="n">request_record</span><span class="p">[</span><span class="s1">&#39;user_id&#39;</span><span class="p">]</span>

        <span class="c1"># Find all consent-based processing</span>
        <span class="n">consent_processing</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;marketing_emails&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;withdrawn&#39;</span><span class="p">,</span> <span class="s1">&#39;processing_stopped&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
            <span class="s1">&#39;analytics_tracking&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;withdrawn&#39;</span><span class="p">,</span> <span class="s1">&#39;processing_stopped&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
            <span class="s1">&#39;personalization&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;withdrawn&#39;</span><span class="p">,</span> <span class="s1">&#39;processing_stopped&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">}</span>
        <span class="p">}</span>

        <span class="c1"># Immediate processing (no delay allowed)</span>
        <span class="n">request_record</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">RequestStatus</span><span class="o">.</span><span class="n">COMPLETED</span>
        <span class="n">request_record</span><span class="p">[</span><span class="s1">&#39;completion_date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">request_record</span><span class="p">[</span><span class="s1">&#39;processing_stopped&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">consent_processing</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;request_id&#39;</span><span class="p">:</span> <span class="n">request_record</span><span class="p">[</span><span class="s1">&#39;request_id&#39;</span><span class="p">],</span>
            <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;completed&#39;</span><span class="p">,</span>
            <span class="s1">&#39;processing_stopped&#39;</span><span class="p">:</span> <span class="nb">list</span><span class="p">(</span><span class="n">consent_processing</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span>
            <span class="s1">&#39;effective_immediately&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;data_retention&#39;</span><span class="p">:</span> <span class="s1">&#39;Consent-based data will be deleted within 30 days&#39;</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_assess_erasure_eligibility</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Assess whether data can be erased under GDPR Article 17&quot;&quot;&quot;</span>

        <span class="c1"># Check grounds for retaining data</span>
        <span class="n">retention_grounds</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Check for legal obligations</span>
        <span class="n">legal_obligations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_legal_obligations</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">legal_obligations</span><span class="p">:</span>
            <span class="n">retention_grounds</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">legal_obligations</span><span class="p">)</span>

        <span class="c1"># Check for legitimate interests</span>
        <span class="n">legitimate_interests</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_legitimate_interests</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">legitimate_interests</span><span class="p">:</span>
            <span class="n">retention_grounds</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">legitimate_interests</span><span class="p">)</span>

        <span class="c1"># Check for public interest</span>
        <span class="n">public_interest</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_public_interest</span><span class="p">(</span><span class="n">user_id</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">public_interest</span><span class="p">:</span>
            <span class="n">retention_grounds</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">public_interest</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">retention_grounds</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">{</span>
                <span class="s1">&#39;eligible&#39;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
                <span class="s1">&#39;reason&#39;</span><span class="p">:</span> <span class="s1">&#39;Data retention required&#39;</span><span class="p">,</span>
                <span class="s1">&#39;explanation&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Data must be retained due to: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">retention_grounds</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="s1">&#39;grounds&#39;</span><span class="p">:</span> <span class="n">retention_grounds</span>
            <span class="p">}</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;eligible&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;reason&#39;</span><span class="p">:</span> <span class="s1">&#39;No grounds for retention&#39;</span><span class="p">,</span>
            <span class="s1">&#39;explanation&#39;</span><span class="p">:</span> <span class="s1">&#39;Data can be erased as requested&#39;</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_check_legal_obligations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check for legal obligations to retain data&quot;&quot;&quot;</span>
        <span class="n">obligations</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Example: Educational records retention</span>
        <span class="n">obligations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Educational records retention (7 years)&quot;</span><span class="p">)</span>

        <span class="c1"># Example: Financial records</span>
        <span class="n">obligations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Financial transaction records (tax law)&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">obligations</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_check_legitimate_interests</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check for legitimate interests in retaining data&quot;&quot;&quot;</span>
        <span class="n">interests</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Example: Fraud prevention</span>
        <span class="n">interests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Fraud prevention and security&quot;</span><span class="p">)</span>

        <span class="c1"># Example: Academic integrity</span>
        <span class="n">interests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Academic integrity enforcement&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">interests</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_check_public_interest</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check for public interest in retaining data&quot;&quot;&quot;</span>
        <span class="c1"># For educational institutions, limited public interest grounds</span>
        <span class="k">return</span> <span class="p">[]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_process_generic_request</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">request_record</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Process other types of requests&quot;&quot;&quot;</span>

        <span class="n">request_record</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">RequestStatus</span><span class="o">.</span><span class="n">UNDER_REVIEW</span>
        <span class="n">request_record</span><span class="p">[</span><span class="s1">&#39;processing_log&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
            <span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
            <span class="s1">&#39;action&#39;</span><span class="p">:</span> <span class="s1">&#39;Request under review&#39;</span><span class="p">,</span>
            <span class="s1">&#39;details&#39;</span><span class="p">:</span> <span class="s1">&#39;Manual review required for this request type&#39;</span>
        <span class="p">})</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;success&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
            <span class="s1">&#39;request_id&#39;</span><span class="p">:</span> <span class="n">request_record</span><span class="p">[</span><span class="s1">&#39;request_id&#39;</span><span class="p">],</span>
            <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;under_review&#39;</span><span class="p">,</span>
            <span class="s1">&#39;estimated_completion&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">+</span> <span class="n">timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">15</span><span class="p">))</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
            <span class="s1">&#39;next_steps&#39;</span><span class="p">:</span> <span class="s1">&#39;Request is being reviewed by privacy team&#39;</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">generate_gdpr_compliance_report</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate GDPR compliance status report&quot;&quot;&quot;</span>

        <span class="n">total_requests</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_subject_requests</span><span class="p">)</span>
        <span class="n">completed_requests</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_subject_requests</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="k">if</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">RequestStatus</span><span class="o">.</span><span class="n">COMPLETED</span><span class="p">])</span>

        <span class="c1"># Calculate response times</span>
        <span class="n">response_times</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">request</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_subject_requests</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">request</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">RequestStatus</span><span class="o">.</span><span class="n">COMPLETED</span><span class="p">:</span>
                <span class="n">response_time</span> <span class="o">=</span> <span class="p">(</span><span class="n">request</span><span class="p">[</span><span class="s1">&#39;completion_date&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">request</span><span class="p">[</span><span class="s1">&#39;received_date&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">days</span>
                <span class="n">response_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">response_time</span><span class="p">)</span>

        <span class="n">avg_response_time</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">response_times</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">response_times</span><span class="p">)</span> <span class="k">if</span> <span class="n">response_times</span> <span class="k">else</span> <span class="mi">0</span>

        <span class="c1"># Check for overdue requests</span>
        <span class="n">overdue_requests</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">request</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_subject_requests</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">request</span><span class="p">[</span><span class="s1">&#39;status&#39;</span><span class="p">]</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">RequestStatus</span><span class="o">.</span><span class="n">COMPLETED</span><span class="p">,</span> <span class="n">RequestStatus</span><span class="o">.</span><span class="n">REJECTED</span><span class="p">]</span> <span class="ow">and</span> 
                <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">request</span><span class="p">[</span><span class="s1">&#39;response_deadline&#39;</span><span class="p">]):</span>
                <span class="n">overdue_requests</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">request</span><span class="p">[</span><span class="s1">&#39;request_id&#39;</span><span class="p">])</span>

        <span class="k">return</span> <span class="p">{</span>
            <span class="s1">&#39;report_date&#39;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">isoformat</span><span class="p">(),</span>
            <span class="s1">&#39;request_statistics&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;total_requests&#39;</span><span class="p">:</span> <span class="n">total_requests</span><span class="p">,</span>
                <span class="s1">&#39;completed_requests&#39;</span><span class="p">:</span> <span class="n">completed_requests</span><span class="p">,</span>
                <span class="s1">&#39;completion_rate&#39;</span><span class="p">:</span> <span class="p">(</span><span class="n">completed_requests</span> <span class="o">/</span> <span class="n">total_requests</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> <span class="k">if</span> <span class="n">total_requests</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s1">&#39;average_response_days&#39;</span><span class="p">:</span> <span class="nb">round</span><span class="p">(</span><span class="n">avg_response_time</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
                <span class="s1">&#39;overdue_requests&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">overdue_requests</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="s1">&#39;request_types&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="n">request_type</span><span class="o">.</span><span class="n">value</span><span class="p">:</span> <span class="nb">len</span><span class="p">([</span><span class="n">r</span> <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_subject_requests</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> 
                                       <span class="k">if</span> <span class="n">r</span><span class="p">[</span><span class="s1">&#39;request_type&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">request_type</span><span class="o">.</span><span class="n">value</span><span class="p">])</span>
                <span class="k">for</span> <span class="n">request_type</span> <span class="ow">in</span> <span class="n">GDPRRights</span>
            <span class="p">},</span>
            <span class="s1">&#39;compliance_status&#39;</span><span class="p">:</span> <span class="p">{</span>
                <span class="s1">&#39;gdpr_compliant&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">overdue_requests</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">,</span>
                <span class="s1">&#39;areas_of_concern&#39;</span><span class="p">:</span> <span class="n">overdue_requests</span><span class="p">,</span>
                <span class="s1">&#39;recommendations&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_generate_compliance_recommendations</span><span class="p">(</span><span class="n">overdue_requests</span><span class="p">,</span> <span class="n">avg_response_time</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">_generate_compliance_recommendations</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">overdue_requests</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> 
                                           <span class="n">avg_response_time</span><span class="p">:</span> <span class="nb">float</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Generate recommendations for improving GDPR compliance&quot;&quot;&quot;</span>

        <span class="n">recommendations</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">overdue_requests</span><span class="p">:</span>
            <span class="n">recommendations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Address overdue data subject requests immediately&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">avg_response_time</span> <span class="o">&gt;</span> <span class="mi">25</span><span class="p">:</span>  <span class="c1"># Close to 30-day limit</span>
            <span class="n">recommendations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Improve response time for data subject requests&quot;</span><span class="p">)</span>

        <span class="n">recommendations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Regular staff training on GDPR procedures&quot;</span><span class="p">)</span>
        <span class="n">recommendations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Automated monitoring of request deadlines&quot;</span><span class="p">)</span>
        <span class="n">recommendations</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Regular privacy impact assessments for new projects&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">recommendations</span>

<span class="c1"># Demonstration of GDPR compliance</span>
<span class="k">def</span><span class="w"> </span><span class="nf">demonstrate_gdpr_compliance</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Demonstrate GDPR compliance management&quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;=== GDPR Compliance Demo ===&quot;</span><span class="p">)</span>

    <span class="n">gdpr_manager</span> <span class="o">=</span> <span class="n">GDPRComplianceManager</span><span class="p">()</span>

    <span class="c1"># Simulate various data subject requests</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;1. Processing data subject requests...&quot;</span><span class="p">)</span>

    <span class="n">test_requests</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;user_001&quot;</span><span class="p">,</span> <span class="n">GDPRRights</span><span class="o">.</span><span class="n">ACCESS</span><span class="p">,</span> <span class="s2">&quot;Request copy of all my personal data&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;user_002&quot;</span><span class="p">,</span> <span class="n">GDPRRights</span><span class="o">.</span><span class="n">ERASURE</span><span class="p">,</span> <span class="s2">&quot;Please delete my account and all associated data&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;user_003&quot;</span><span class="p">,</span> <span class="n">GDPRRights</span><span class="o">.</span><span class="n">DATA_PORTABILITY</span><span class="p">,</span> <span class="s2">&quot;Export my data to transfer to another service&quot;</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;user_004&quot;</span><span class="p">,</span> <span class="n">GDPRRights</span><span class="o">.</span><span class="n">WITHDRAW_CONSENT</span><span class="p">,</span> <span class="s2">&quot;Withdraw consent for marketing emails&quot;</span><span class="p">)</span>
    <span class="p">]</span>

    <span class="k">for</span> <span class="n">user_id</span><span class="p">,</span> <span class="n">request_type</span><span class="p">,</span> <span class="n">details</span> <span class="ow">in</span> <span class="n">test_requests</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">gdpr_manager</span><span class="o">.</span><span class="n">handle_data_subject_request</span><span class="p">(</span>
            <span class="n">user_id</span><span class="p">,</span> <span class="n">request_type</span><span class="p">,</span> <span class="n">details</span><span class="p">,</span> <span class="n">identity_verified</span><span class="o">=</span><span class="kc">True</span>
        <span class="p">)</span>

        <span class="n">status_icon</span> <span class="o">=</span> <span class="s2">&quot;✅&quot;</span> <span class="k">if</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="s2">&quot;❌&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">status_icon</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">request_type</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s2"> for </span><span class="si">{</span><span class="n">user_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;status&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;failed&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">[</span><span class="s1">&#39;success&#39;</span><span class="p">]:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Error: </span><span class="si">{</span><span class="n">result</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span><span class="w"> </span><span class="s1">&#39;Unknown error&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Generate compliance report</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">2. GDPR compliance report...&quot;</span><span class="p">)</span>

    <span class="n">compliance_report</span> <span class="o">=</span> <span class="n">gdpr_manager</span><span class="o">.</span><span class="n">generate_gdpr_compliance_report</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Request Statistics:&quot;</span><span class="p">)</span>
    <span class="n">stats</span> <span class="o">=</span> <span class="n">compliance_report</span><span class="p">[</span><span class="s1">&#39;request_statistics&#39;</span><span class="p">]</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Total requests: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;total_requests&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Completion rate: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;completion_rate&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">%&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Average response time: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;average_response_days&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2"> days&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Overdue requests: </span><span class="si">{</span><span class="n">stats</span><span class="p">[</span><span class="s1">&#39;overdue_requests&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Request Types:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">request_type</span><span class="p">,</span> <span class="n">count</span> <span class="ow">in</span> <span class="n">compliance_report</span><span class="p">[</span><span class="s1">&#39;request_types&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">request_type</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">compliance_status</span> <span class="o">=</span> <span class="n">compliance_report</span><span class="p">[</span><span class="s1">&#39;compliance_status&#39;</span><span class="p">]</span>
    <span class="n">compliance_icon</span> <span class="o">=</span> <span class="s2">&quot;✅&quot;</span> <span class="k">if</span> <span class="n">compliance_status</span><span class="p">[</span><span class="s1">&#39;gdpr_compliant&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="s2">&quot;⚠️&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">GDPR Compliant: </span><span class="si">{</span><span class="n">compliance_icon</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">compliance_status</span><span class="p">[</span><span class="s1">&#39;gdpr_compliant&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">compliance_status</span><span class="p">[</span><span class="s1">&#39;recommendations&#39;</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Recommendations:&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">rec</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">compliance_status</span><span class="p">[</span><span class="s1">&#39;recommendations&#39;</span><span class="p">][:</span><span class="mi">3</span><span class="p">],</span> <span class="mi">1</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">. </span><span class="si">{</span><span class="n">rec</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre>
</div>
<h2 id="summary">Summary<a class="headerlink" href="#summary" title="Permanent link">&para;</a></h2>
<p><strong>Privacy by Design creates sustainable, trustworthy systems through proactive privacy protection:</strong></p>
<p><strong>Data Minimization:</strong></p>
<ul>
<li>
<p><strong>Collect only necessary data</strong> for specified purposes</p>
</li>
<li>
<p><strong>Reject excessive data collection</strong> during system design</p>
</li>
<li>
<p><strong>Categorize data by sensitivity</strong> and apply appropriate protections</p>
</li>
<li>
<p><strong><span class="glossary-term" data-glossary-category="Programming Fundamentals" data-glossary-definition="Written text or illustrations that accompany software, explaining how it works and how to use it, including comments, docstrings, and user guides." data-glossary-term="Documentation">Document</span> collection rationale</strong> for transparency and compliance</p>
</li>
</ul>
<p><strong>Consent Management:</strong></p>
<ul>
<li>
<p><strong>Obtain explicit consent</strong> for non-essential processing</p>
</li>
<li>
<p><strong>Provide clear information</strong> about data use and rights</p>
</li>
<li>
<p><strong>Enable easy consent withdrawal</strong> without service penalties</p>
</li>
<li>
<p><strong>Maintain detailed consent records</strong> for accountability</p>
</li>
</ul>
<p><strong>Purpose Limitation and Retention:</strong></p>
<ul>
<li>
<p><strong>Use data only for declared purposes</strong> to prevent scope creep</p>
</li>
<li>
<p><strong>Implement automated deletion</strong> based on retention policies</p>
</li>
<li>
<p><strong>Regular review and cleanup</strong> of unnecessary data</p>
</li>
<li>
<p><strong>Legal basis assessment</strong> for all processing activities</p>
</li>
</ul>
<p><strong>Privacy Impact Assessments:</strong></p>
<ul>
<li>
<p><strong>Systematic privacy risk evaluation</strong> for new projects</p>
</li>
<li>
<p><strong>Early identification and mitigation</strong> of privacy risks</p>
</li>
<li>
<p><strong><span class="glossary-term" data-glossary-category="Programming Fundamentals" data-glossary-definition="Written text or illustrations that accompany software, explaining how it works and how to use it, including comments, docstrings, and user guides." data-glossary-term="Documentation">Documentation</span> of design decisions</strong> and their privacy implications</p>
</li>
<li>
<p><strong>Stakeholder consultation</strong> when high risks are identified</p>
</li>
</ul>
<p><strong>GDPR Compliance:</strong></p>
<ul>
<li>
<p><strong>Robust data subject rights <span class="glossary-term" data-glossary-category="Programming Fundamentals" data-glossary-definition="A reusable block of code that performs a specific task but does not return a value, similar to a void function." data-glossary-term="Procedure">procedures</span></strong> with defined response times</p>
</li>
<li>
<p><strong>Clear legal basis</strong> for all processing activities</p>
</li>
<li>
<p><strong>Comprehensive <span class="glossary-term" data-glossary-category="Programming Fundamentals" data-glossary-definition="Written text or illustrations that accompany software, explaining how it works and how to use it, including comments, docstrings, and user guides." data-glossary-term="Documentation">documentation</span></strong> of processing activities</p>
</li>
<li>
<p><strong>Regular compliance monitoring</strong> and improvement</p>
</li>
</ul>
<p><strong>Implementation best practices:</strong></p>
<ul>
<li>
<p><strong>Privacy by default</strong>: Most privacy-friendly settings as standard</p>
</li>
<li>
<p><strong>Technical and organizational measures</strong>: Both code and <span class="glossary-term" data-glossary-category="Programming Fundamentals" data-glossary-definition="A reusable block of code that performs a specific task but does not return a value, similar to a void function." data-glossary-term="Procedure">procedures</span> matter</p>
</li>
<li>
<p><strong>Regular training</strong>: Keep staff updated on privacy requirements</p>
</li>
<li>
<p><strong>Continuous improvement</strong>: Regular review and enhancement of privacy protections</p>
</li>
</ul>
<p>Understanding and implementing Privacy by Design principles creates software systems that respect user privacy, comply with legal requirements, and build lasting trust with users while maintaining functional excellence.</p>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1zM12.5 7v5.2l4 2.4-1 1L11 13V7zM11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date" title="October 18, 2025 03:48:47 UTC">October 18, 2025</span>
  </span>

    
    
    
    
  </aside>


  



  <form class="md-feedback" name="feedback" hidden>
    <fieldset>
      <legend class="md-feedback__title">
        Was this page helpful?
      </legend>
      <div class="md-feedback__inner">
        <div class="md-feedback__list">
          
            <button class="md-feedback__icon md-icon" type="submit" title="This page was helpful" data-md-value="1">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m7 0c0 .8-.7 1.5-1.5 1.5S14 10.3 14 9.5 14.7 8 15.5 8s1.5.7 1.5 1.5m-5 7.73c-1.75 0-3.29-.73-4.19-1.81L9.23 14c.45.72 1.52 1.23 2.77 1.23s2.32-.51 2.77-1.23l1.42 1.42c-.9 1.08-2.44 1.81-4.19 1.81"/></svg>
            </button>
          
            <button class="md-feedback__icon md-icon" type="submit" title="This page could be improved" data-md-value="0">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 12a8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8 8 8 0 0 0 8-8m2 0a10 10 0 0 1-10 10A10 10 0 0 1 2 12 10 10 0 0 1 12 2a10 10 0 0 1 10 10m-6.5-4c.8 0 1.5.7 1.5 1.5s-.7 1.5-1.5 1.5-1.5-.7-1.5-1.5.7-1.5 1.5-1.5M10 9.5c0 .8-.7 1.5-1.5 1.5S7 10.3 7 9.5 7.7 8 8.5 8s1.5.7 1.5 1.5m2 4.5c1.75 0 3.29.72 4.19 1.81l-1.42 1.42C14.32 16.5 13.25 16 12 16s-2.32.5-2.77 1.23l-1.42-1.42C8.71 14.72 10.25 14 12 14"/></svg>
            </button>
          
        </div>
        <div class="md-feedback__note">
          
            <div data-md-value="1" hidden>
              
              
                
              
              
              
                
                
              
              Thanks for your feedback!
            </div>
          
            <div data-md-value="0" hidden>
              
              
                
              
              
              
                
                
              
              Thanks for your feedback! Help us improve this page by creating an <a href="https://github.com/Eatham532/Software-Engineering-HSC-Textbook/issues/new/choose" target="_blank" rel="noopener">issue</a> on github.
            </div>
          
        </div>
      </div>
    </fieldset>
  </form>


                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        

<!-- Footer -->
<footer class="md-footer">
  
    <!-- Custom footer with left/right layout -->
    <div class="md-footer__inner md-grid">
      <!-- Left side: Copyright and cookie settings -->
      <div class="md-footer__left">
        <div class="md-footer__copyright">
          
            Copyright &copy; 2025 Eatham532 – <a href="#__consent">Change cookie settings</a>

          
        </div>
      </div>

      <!-- Right side: Page name and BETA -->
      <div class="md-footer__right">
        <div class="md-footer__page-info">
          <span class="md-footer__page-title">Content</span>
          
            <span class="md-footer__beta-badge">BETA</span>
          
        </div>
      </div>
    </div>
  
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            



<h4>Cookie consent</h4>
<p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of the textbook. With your consent, you're helping us to make software engineering education better for everyone.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
    
    
      
        
  
  
    
    
  
  <li class="task-list-item">
    <label class="task-list-control">
      <input type="checkbox" name="github" checked>
      <span class="task-list-indicator"></span>
      GitHub
    </label>
  </li>

      
    
    
      
        
  
  
    
    
  
  <li class="task-list-item">
    <label class="task-list-control">
      <input type="checkbox" name="analytics" checked>
      <span class="task-list-indicator"></span>
      Google Analytics
    </label>
  </li>

      
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Accept</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Manage settings</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout((function(){document.querySelector("[data-md-component=consent]").hidden=!1}),250);var form=document.forms.consent;for(var action of["submit","reset"])form.addEventListener(action,(function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map((function(e){return[e,!0]})))),location.hash="",location.reload()}))</script>
    
    
      
      <script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.tabs", "navigation.top", "navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.prune", "search.highlight", "search.suggest", "content.code.annotate", "content.code.copy", "content.code.select", "content.tabs.link", "content.action.edit", "content.action.view", "toc.follow"], "search": "../../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="../../../../assets/diagram-modal.js"></script>
      
        <script src="../../../../assets/quiz.js"></script>
      
        <script src="../../../../assets/ide-utils.js"></script>
      
        <script src="../../../../assets/code-blocks.js"></script>
      
        <script src="../../../../assets/glossary.js"></script>
      
    
  </body>
</html>